var egret;!function(e){var t;!function(t){function r(r){if(!s){s=!0,r||(r={}),i(r.renderMode);try{e.Capabilities.$setNativeCapabilities(egret_native.getVersion())}catch(a){}var n=e.sys.$ticker,h=function(){n.update()};egret_native.setOnUpdate(h,n),e.sys.screenAdapter||(r.screenAdapter?e.sys.screenAdapter=r.screenAdapter:e.sys.screenAdapter=new e.sys.DefaultScreenAdapter);var u=new t.NativePlayer;o.push(u),u.$stage.dirtyRegionPolicy=e.DirtyRegionPolicy.OFF,e.sys.DisplayList.prototype.setDirtyRegionPolicy=function(){}}}function i(r){e.sys.CanvasRenderBuffer=t.WebGLRenderBuffer,e.sys.RenderBuffer=t.WebGLRenderBuffer,e.sys.systemRenderer=new t.WebGLRenderer,e.sys.canvasRenderer=new t.WebGLRenderer,e.sys.customHitTestBuffer=new t.WebGLRenderBuffer(3,3),e.sys.canvasHitTestBuffer=new t.WebGLRenderBuffer(3,3),e.Capabilities.$renderMode="webgl"}function a(){for(var e=o.length,t=0;e>t;t++)o[t].updateScreenSize()}function n(e){for(var t=[],r=0;r<e.length;r++)t.push(e[r]);return t}t.$supportCanvas=egret_native.Canvas?!0:!1;var s=!1,o=[];e.warn=function(){console.warn.apply(console,n(arguments))},e.error=function(){console.error.apply(console,n(arguments))},e.assert=function(){console.assert.apply(console,n(arguments))},e.log=function(){console.log.apply(console,n(arguments))},e.runEgret=r,e.updateAllScreens=a}(t=e.native2||(e.native2={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){t.$supportCanvas=!0,e["native"].$supportCanvas=e.native2.$supportCanvas}(t=e["native"]||(e["native"]={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var r=function(t){function r(r,i,a,n,s){t.call(this),this.arrFps=[],this.arrLog=[],(i||a)&&(this.panelX=void 0===s.x?0:parseInt(s.x),this.panelY=void 0===s.y?0:parseInt(s.y),this._stage=r,this.showFps=i,this.showLog=a,this.fontColor=void 0===s.textColor?16777215:parseInt(s.textColor),this.fontSize=void 0===s.size?24:parseInt(s.size),this.bgAlpha=s.bgAlpha||.9,this.shape=new e.Shape,this.addChild(this.shape),i&&this.addFps(),a&&this.addLog())}__extends(r,t);var i=(__define,r),a=i.prototype;return a.addFps=function(){var t=new e.TextField;t.x=t.y=4,this.textFps=t,this.addChild(t),t.lineSpacing=2,t.size=this.fontSize,t.textColor=this.fontColor,t.textFlow=[{text:"0 FPS "+e.Capabilities.renderMode+"\n"},{text:"Draw: 0\nDirty: 0%\n"},{text:"Cost: "},{text:"0 ",style:{textColor:1638142}},{text:"0 ",style:{textColor:16776960}},{text:"0 ",style:{textColor:16711680}}]},a.addLog=function(){var t=new e.TextField;t.size=this.fontSize,t.textColor=this.fontColor,t.x=4,this.addChild(t),this.textLog=t},a.update=function(t){this.arrFps.push(t.fps);var r=0,i=this.arrFps.length;i>101&&(i=101,this.arrFps.shift());for(var a=this.arrFps[0],n=this.arrFps[0],s=0;i>s;s++){var o=this.arrFps[s];r+=o,a>o?a=o:o>n&&(n=o)}this.textFps.textFlow=[{text:t.fps+" FPS "+e.Capabilities.renderMode+"\n"},{text:"min"+a+" max"+n+" avg"+Math.floor(r/i)+"\n"},{text:"Draw: "+t.draw+"\nDirty: "+t.dirty+"%\n"},{text:"Cost: "},{text:t.costTicker+" ",style:{textColor:1638142}},{text:t.costDirty+" ",style:{textColor:16776960}},{text:t.costRender+" ",style:{textColor:16711680}}],this.updateLayout()},a.updateInfo=function(e){var t=0;if(this.showFps&&(t=this.textFps.height,this.textLog.y=t+4),this.arrLog.push(e),this.textLog.text=this.arrLog.join("\n"),this._stage.stageHeight>0)for(this.textLog.textWidth>this._stage.stageWidth-20-this.panelX&&(this.textLog.width=this._stage.stageWidth-20-this.panelX);this.textLog.textHeight>this._stage.stageHeight-t-20-this.panelY;)this.arrLog.shift(),this.textLog.text=this.arrLog.join("\n");this.updateLayout()},a.updateLayout=function(){if(e.Capabilities.runtimeType!=e.RuntimeType.NATIVE){var t=this.shape.$graphics;t.clear(),t.beginFill(0,this.bgAlpha),t.drawRect(0,0,this.width+8,this.height+8),t.endFill()}},r}(e.Sprite);t.NativeFps=r,e.registerClass(r,"egret.native2.NativeFps",["egret.FPSDisplay"]),e.FPSDisplay=r}(t=e.native2||(e.native2={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var r=function(t){function r(r){t.call(this),egret_native.pauseApp=function(){r.dispatchEvent(new e.Event(e.Event.DEACTIVATE)),egret_native.Audio.pauseBackgroundMusic(),egret_native.Audio.pauseAllEffects()},egret_native.resumeApp=function(){r.dispatchEvent(new e.Event(e.Event.ACTIVATE)),egret_native.Audio.resumeBackgroundMusic(),egret_native.Audio.resumeAllEffects()}}__extends(r,t);var i=(__define,r);i.prototype;return r}(e.HashObject);t.NativeHideHandler=r,e.registerClass(r,"egret.native2.NativeHideHandler")}(t=e.native2||(e.native2={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var r=function(r){function i(){r.call(this),this.init(i.option)}__extends(i,r);var a=(__define,i),n=a.prototype;return n.init=function(r){r.showPaintRect=!1;var i=new e.Stage;i.$screen=this,i.$scaleMode=r.scaleMode,i.$maxTouches=r.maxTouches,i.textureScaleFactor=r.textureScaleFactor,i.frameRate=r.frameRate;var a=new e.sys.RenderBuffer(void 0,void 0,!0),n=a.surface;this.attachCanvas(n);var s=new t.NativeTouchHandler(i),o=new e.sys.Player(a,i,r.entryClassName);if(new t.NativeHideHandler(i),o.showPaintRect(r.showPaintRect),r.showFPS||r.showLog){for(var h=r.fpsStyles||"",u=h.split(","),c={},l=0;l<u.length;l++){var d=u[l].split(":");c[d[0]]=d[1]}r.fpsStyles=c,o.displayFPS(r.showFPS,r.showLog,r.logFilter,r.fpsStyles)}this.playerOption=r,this.$stage=i,this.player=o,this.nativeTouch=s,this.updateScreenSize(),this.updateMaxTouches(),o.start()},n.updateScreenSize=function(){var t=this.playerOption,r=egret_native.getDeviceWidth(),i=egret_native.getDeviceHeight();e.Capabilities.$boundingClientWidth=r,e.Capabilities.$boundingClientHeight=i;var a=e.sys.screenAdapter.calculateStageSize(this.$stage.$scaleMode,r,i,t.contentWidth,t.contentHeight),n=a.stageWidth,s=a.stageHeight,o=a.displayWidth,h=a.displayHeight,u=(i-h)/2,c=(r-o)/2;egret_native.setVisibleRect(c,u,o,h),egret_native.setDesignSize(n,s),this.player.updateStageSize(n,s)},n.setContentSize=function(e,t){var r=this.playerOption;r.contentWidth=e,r.contentHeight=t,this.updateScreenSize()},n.attachCanvas=function(e){egret_native.setScreenCanvas(e)},n.updateMaxTouches=function(){this.nativeTouch.$updateMaxTouches()},i}(e.HashObject);t.NativePlayer=r,e.registerClass(r,"egret.native2.NativePlayer",["egret.sys.Screen"])}(t=e.native2||(e.native2={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var r=function(t){function r(){t.apply(this,arguments),this._downCount=0,this._path=null,this._bytesTotal=0}__extends(r,t);var i=(__define,r),a=i.prototype;return a.load=function(e,t){this._downCount=0,this._path=e,this._bytesTotal=t,this.reload()},a.reload=function(){if(this._downCount>=3)return void this.downloadFileError();this._downCount++;var t=e.PromiseObject.create(),r=this;t.onSuccessFunc=function(){r.loadOver()},t.onErrorFunc=function(){r.reload()},t.downloadingSizeFunc=function(e){r.downloadingProgress(e)},egret_native.download(this._path,this._path,t)},a.downloadingProgress=function(t){e.ProgressEvent.dispatchProgressEvent(this,e.ProgressEvent.PROGRESS,t,this._bytesTotal)},a.downloadFileError=function(){this.dispatchEvent(new e.Event(e.IOErrorEvent.IO_ERROR))},a.loadOver=function(){this.dispatchEvent(new e.Event(e.Event.COMPLETE))},r}(e.EventDispatcher);t.NativeResourceLoader=r,e.registerClass(r,"egret.native2.NativeResourceLoader"),e.NativeResourceLoader=r}(t=e.native2||(e.native2={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){function r(t,r){var i=e.sys.canvasHitTestBuffer,a=i.surface;return a}function i(t,i){try{var a=r(this,i),n=a.toDataURL(t);return n}catch(s){return e.$error(1033),null}}function a(t,i,a){try{var n=r(this,a);n.saveToFile(t,i)}catch(s){e.$error(1033)}}function n(t,r){return e.$error(1035),null}e.Texture.prototype.toDataURL=i,e.Texture.prototype.saveToFile=a,e.Texture.prototype.getPixel32=n}(t=e.native2||(e.native2={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var r=function(t){function r(r){t.call(this),this.$touch=new e.sys.TouchHandler(r);var i=this;egret_native.touchDown=function(e,t,r,a){i.$executeTouchCallback(e,t,r,a,i.$touch.onTouchBegin)},egret_native.touchMove=function(e,t,r,a){i.$executeTouchCallback(e,t,r,a,i.$touch.onTouchMove)},egret_native.touchUp=function(e,t,r,a){i.$executeTouchCallback(e,t,r,a,i.$touch.onTouchEnd)},egret_native.touchCancel=function(e,t,r,i){}}__extends(r,t);var i=(__define,r),a=i.prototype;return a.$executeTouchCallback=function(e,t,r,i,a){for(var n=0;e>n;n++){var s=t[n],o=r[n],h=i[n];a.call(this.$touch,o,h,s)}},a.$updateMaxTouches=function(){this.$touch.$initMaxTouches()},r}(e.HashObject);t.NativeTouchHandler=r,e.registerClass(r,"egret.native2.NativeTouchHandler")}(t=e.native2||(e.native2={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){function r(e){var t=egret_native.xmlStr2JsonStr(e),r=JSON.parse(t);return i(r,null)}function i(e,t){if("parsererror"==e.localName)throw new Error(e.textContent);var r=new n(e.localName,t,e.prefix,e.namespace,e.name),a=e.attributes,o=r.attributes;for(var h in a)o[h]=a[h];for(var u=e.children,c=u.length,l=r.children,d=0;c>d;d++){var f=u[d],v=f.nodeType,g=null;if(1==v)g=i(f,r);else if(3==v){var p=f.text.trim();p&&(g=new s(p,r))}g&&l.push(g)}return r}var a=function(){function e(e,t){this.nodeType=e,this.parent=t}var t=(__define,e);t.prototype;return e}();t.XMLNode=a,e.registerClass(a,"egret.native2.XMLNode");var n=function(e){function t(t,r,i,a,n){e.call(this,1,r),this.attributes={},this.children=[],this.localName=t,this.prefix=i,this.namespace=a,this.name=n}__extends(t,e);var r=(__define,t);r.prototype;return t}(a);t.XML=n,e.registerClass(n,"egret.native2.XML");var s=function(e){function t(t,r){e.call(this,3,r),this.text=t}__extends(t,e);var r=(__define,t);r.prototype;return t}(a);t.XMLText=s,e.registerClass(s,"egret.native2.XMLText"),e.XML={parse:r}}(t=e.native2||(e.native2={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var r=function(){function t(){this.onSuccessFunc=null,this.onSuccessThisObject=null,this.onErrorFunc=null,this.onErrorThisObject=null,this.downloadingSizeFunc=null,this.downloadingSizeThisObject=null,this.onResponseHeaderFunc=null,this.onResponseHeaderThisObject=null}var r=(__define,t),i=r.prototype;return t.create=function(){return t.promiseObjectList.length?t.promiseObjectList.pop():new e.PromiseObject},i.onSuccess=function(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];this.onSuccessFunc&&this.onSuccessFunc.apply(this.onSuccessThisObject,e),this.destroy()},i.onError=function(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];this.onErrorFunc&&this.onErrorFunc.apply(this.onErrorThisObject,e),this.destroy()},i.downloadingSize=function(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];this.downloadingSizeFunc&&this.downloadingSizeFunc.apply(this.downloadingSizeThisObject,e)},i.onResponseHeader=function(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];this.onResponseHeaderFunc&&this.onResponseHeaderFunc.apply(this.onResponseHeaderThisObject,e)},i.destroy=function(){this.onSuccessFunc=void 0,this.onSuccessThisObject=void 0,this.onErrorFunc=void 0,this.onErrorThisObject=void 0,this.downloadingSizeFunc=void 0,this.downloadingSizeThisObject=void 0,this.onResponseHeaderFunc=void 0,this.onResponseHeaderThisObject=void 0,t.promiseObjectList.push(this)},t.promiseObjectList=[],t}();t.PromiseObject=r,e.registerClass(r,"egret.native2.PromiseObject"),e.PromiseObject=r}(t=e.native2||(e.native2={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){function r(t){var r=JSON.parse(t),a=r.functionName,n=i[a];if(n){var s=r.value;n.call(null,s)}else e.$warn(1004,a)}var i={},a=function(){function e(){}var t=(__define,e);t.prototype;return e.call=function(e,t){var r={};r.functionName=e,r.value=t,egret_native.sendInfoToPlugin(JSON.stringify(r))},e.addCallback=function(e,t){i[e]=t},e}();t.NativeExternalInterface=a,e.registerClass(a,"egret.native2.NativeExternalInterface",["egret.ExternalInterface"]),e.ExternalInterface=a,egret_native.receivedPluginInfo=r}(t=e.native2||(e.native2={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var r;!function(r){function i(e){return u[e]}function a(t,r){r=void 0===r?"undefined":null===r?"null":r.toString(),u[t]=r;try{return o(),!0}catch(i){return e.$warn(1018,t,r),!1}}function n(e){delete u[e],o()}function s(){for(var e in u)delete u[e];o()}function o(){}var h="LocalStorage.local",u={};if(egret_native.isRecordExists(h)){var c=egret_native.loadRecord(h);try{u=JSON.parse(c)}catch(l){u={}}}else u={};t.getItem=i,t.setItem=a,t.removeItem=n,t.clear=s}(r=t.native2||(t.native2={}))}(t=e.localStorage||(e.localStorage={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var r=function(r){function i(){r.call(this),this.loaded=!1}__extends(i,r);var a=__define,n=i,s=n.prototype;return a(s,"length",function(){throw new Error("sound length not supported")}),s.load=function(r){function i(){var i=t.PromiseObject.create();i.onSuccessFunc=a,i.onErrorFunc=function(){e.IOErrorEvent.dispatchIOErrorEvent(n)},egret_native.download(r,r,i)}function a(){n.loaded=!0,n.preload()}var n=this;this.url=r,egret_native.isFileExists(r)?__global.setTimeout?__global.setTimeout(a,0):e.$callAsync(a,n):i()},s.preload=function(){var t=this;if(t.type==e.Sound.EFFECT){var r=new e.PromiseObject;r.onSuccessFunc=function(r){t.dispatchEventWith(e.Event.COMPLETE)},egret_native.Audio.preloadEffectAsync(t.url,r)}else t.dispatchEventWith(e.Event.COMPLETE)},s.play=function(r,i){r=+r||0,i=+i||0;var a=new t.NaSoundChannel;return a.$url=this.url,a.$loops=i,a.$type=this.type,a.$startTime=r,a.$play(),e.sys.$pushSoundChannel(a),a},s.close=function(){},i.MUSIC="music",i.EFFECT="effect",i}(e.EventDispatcher);t.NaSound=r,e.registerClass(r,"egret.native2.NaSound",["egret.Sound"]),__global.Audio||(e.Sound=r)}(t=e.native2||(e.native2={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var r=function(t){function r(){t.call(this),this.$startTime=0,this.isStopped=!1,this._startTime=0}__extends(r,t);var i=__define,a=r,n=a.prototype;return n.$play=function(){this.isStopped=!1,this.$type==e.Sound.EFFECT?this._effectId=egret_native.Audio.playEffect(this.$url,1!=this.$loops):(r.currentPath=this.$url,egret_native.Audio.playBackgroundMusic(this.$url,1!=this.$loops)),this._startTime=Date.now()},n.stop=function(){this.isStopped||e.sys.$popSoundChannel(this),this.isStopped=!0,this.$type==e.Sound.EFFECT?this._effectId&&(egret_native.Audio.stopEffect(this._effectId),this._effectId=null):this.$url==r.currentPath&&egret_native.Audio.stopBackgroundMusic(!1)},i(n,"volume",function(){return this.$type==e.Sound.EFFECT?egret_native.Audio.getEffectsVolume():egret_native.Audio.getBackgroundMusicVolume()},function(t){this.$type==e.Sound.EFFECT?egret_native.Audio.setEffectsVolume(t):egret_native.Audio.setBackgroundMusicVolume(t)}),i(n,"position",function(){return(Date.now()-this._startTime)/1e3}),r}(e.EventDispatcher);t.NaSoundChannel=r,e.registerClass(r,"egret.native2.NaSoundChannel",["egret.SoundChannel","egret.IEventDispatcher"])}(t=e.native2||(e.native2={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var r=function(r){function i(){r.call(this),this.loaded=!1}__extends(i,r);var a=__define,n=i,s=n.prototype;return a(s,"length",function(){if(this.originAudio)return this.originAudio.duration;throw new Error("sound not loaded!")}),s.load=function(t){var r=this;return r.loaded=!0,void r.dispatchEventWith(e.Event.COMPLETE);var r,r},s.play=function(r,a){r=+r||0,a=+a||0;var n=i.$pop(this.url);null==n&&(n=new Audio(this.url)),n.autoplay=!0;var s=new t.NativeSoundChannel(n);return s.$url=this.url,s.$loops=a,s.$startTime=r,s.$play(),e.sys.$pushSoundChannel(s),s},s.close=function(){0==this.loaded&&this.originAudio&&(this.originAudio.src=""),this.originAudio&&(this.originAudio=null),i.$clear(this.url)},i.$clear=function(e){var t=i.audios[e];t&&(t.length=0)},i.$pop=function(e){var t=i.audios[e];return t&&t.length>0?t.pop():null},i.$recycle=function(e,t){var r=i.audios[e];null==i.audios[e]&&(r=i.audios[e]=[]),r.push(t)},i.MUSIC="music",i.EFFECT="effect",i.audios={},i}(e.EventDispatcher);t.NativeSound=r,e.registerClass(r,"egret.native2.NativeSound",["egret.Sound"]),__global.Audio&&(e.Sound=r)}(t=e.native2||(e.native2={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var r=function(t){function r(r){var i=this;t.call(this),this.$startTime=0,this.audio=null,this.isStopped=!1,this.onPlayEnd=function(){return 1==i.$loops?(i.stop(),void i.dispatchEventWith(e.Event.SOUND_COMPLETE)):(i.$loops>0&&i.$loops--,void i.$play())},r.addEventListener("ended",this.onPlayEnd),this.audio=r}__extends(r,t);var i=__define,a=r,n=a.prototype;return n.$play=function(){},n.stop=function(){return},i(n,"volume",function(){return 1},function(e){}),i(n,"position",function(){return 0}),r}(e.EventDispatcher);t.NativeSoundChannel=r,e.registerClass(r,"egret.native2.NativeSoundChannel",["egret.SoundChannel","egret.IEventDispatcher"])}(t=e.native2||(e.native2={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var r=function(r){function i(t,i){void 0===i&&(i=!0),r.call(this),this.loaded=!1,this.loading=!1,this.loop=!1,this.isPlayed=!1,this.firstPlay=!0,this.src="",this._fullscreen=!0,this._bitmapData=null,this.paused=!1,this.isAddToStage=!1,this.heightSet=0,this.widthSet=0,this.$renderNode=new e.sys.BitmapNode,this.cache=i,__global.Video||e.$error(1044),t&&this.load(t,i)}__extends(i,r);var a=__define,n=i,s=n.prototype;return s.load=function(t,r){if(void 0===r&&(r=!0),!this.loading)if(0==t.indexOf("/")&&(t=t.slice(1,t.length)),this.src=t,this.loading=!0,this.loaded=!1,r&&!egret_native.isFileExists(t)){var i=this,a=e.PromiseObject.create();a.onSuccessFunc=function(){i.loadEnd()},a.onErrorFunc=function(){e.$warn(1048),i.dispatchEventWith(e.IOErrorEvent.IO_ERROR)},egret_native.download(t,t,a)}else this.loadEnd()},s.loadEnd=function(){function t(){n.setVideoRect(0,0,1,1),n.play()}function r(){n.setVideoRect(0,0,1,1),__global.setTimeout(function(){n.pause(),s._fullscreen&&(n.fullScreen=!0),n.currentTime=0,s.originVideo=n,s.loaded=!0,s.loading=!1,a(),s.dispatchEventWith(e.Event.COMPLETE),n.addEventListener("pause",function(){s.paused=!0}),n.addEventListener("playing",function(){s.paused=!1}),n.addEventListener("ended",function(){s.dispatchEventWith(e.Event.ENDED),s.loop&&s.play(0,!0)})},1)}function i(){a(),s.dispatchEventWith(e.IOErrorEvent.IO_ERROR)}function a(){n.removeEventListener("canplaythrough",t),n.removeEventListener("error",i),n.removeEventListener("playing",r)}var n=new __global.Video(this.src);n.setVideoRect(0,0,1,1),n.setKeepRatio(!1),n.addEventListener("canplaythrough",t),n.addEventListener("error",i),n.addEventListener("playing",r),n.load();var s=this},s.play=function(t,r){var i=this;if(void 0===r&&(r=!1),this.loop=r,!this.loaded)return this.load(this.src),void this.once(e.Event.COMPLETE,function(e){return i.play(t,r)},this);var a=!1;void 0!=t&&t!=this.originVideo.currentTime&&(this.originVideo.currentTime=t||0,a=!0),this.startPlay(a)},s.startPlay=function(t){void 0===t&&(t=!1),this.isAddToStage&&this.loaded&&(this.firstPlay=!1,this.setVideoSize(),this.isPlayed=!0,!t&&this.paused&&0!=this.position?this.originVideo.resume():this.originVideo.play(),e.startTick(this.markDirty,this))},s.stopPlay=function(){e.stopTick(this.markDirty,this),this.isPlayed&&(this.isPlayed=!1,this.originVideo.pause())},s.close=function(){this.originVideo&&this.originVideo.destroy(),this.loaded=!1,this.loading=!1,this.originVideo=null,this.loop=!1,this.src=null},a(s,"poster",function(){return this.posterUrl},function(r){var i=this;this.posterUrl=r;var a=new t.NativeImageLoader;a.load(r),a.addEventListener(e.Event.COMPLETE,function(){i.posterData=a.data,i.markDirty(),i.$invalidateContentBounds()},this)}),a(s,"fullscreen",function(){return this.originVideo?this.originVideo.fullScreen:this._fullscreen},function(e){this._fullscreen=e,this.originVideo&&(this.originVideo.fullScreen=e)}),a(s,"volume",function(){return this.loaded?this.originVideo.volume:0},function(e){this.loaded&&(this.originVideo.volume=e)}),a(s,"position",function(){return this.originVideo.currentTime},function(e){this.loaded&&(this.originVideo.currentTime=e)}),s.pause=function(){this.originVideo.pause()},a(s,"bitmapData",function(){return this._bitmapData}),a(s,"length",function(){if(this.loaded)return this.originVideo.duration;throw new Error("Video not loaded!")}),s.$onAddToStage=function(e,t){this.isAddToStage=!0,this.originVideo&&this.originVideo.setVideoVisible(!0),this.$invalidate(),this.$invalidateContentBounds(),r.prototype.$onAddToStage.call(this,e,t)},s.$onRemoveFromStage=function(){this.isAddToStage=!1,this.originVideo&&(this.stopPlay(),this.originVideo.setVideoVisible(!1)),r.prototype.$onRemoveFromStage.call(this)},s.getPlayWidth=function(){return isNaN(this.widthSet)?this.bitmapData?this.bitmapData.width:this.posterData?this.posterData.width:0/0:this.widthSet},s.getPlayHeight=function(){return isNaN(this.heightSet)?this.bitmapData?this.bitmapData.height:this.posterData?this.posterData.height:0/0:this.heightSet},s.$setHeight=function(e){return this.heightSet=+e||0,this.setVideoSize(),this.$invalidate(),this.$invalidateContentBounds(),r.prototype.$setHeight.call(this,e)},s.$setWidth=function(e){return this.widthSet=+e||0,this.setVideoSize(),this.$invalidate(),this.$invalidateContentBounds(),r.prototype.$setWidth.call(this,e)},s.$setX=function(e){var t=r.prototype.$setX.call(this,e);return this.setVideoSize(),t},s.$setY=function(e){var t=r.prototype.$setY.call(this,e);return this.setVideoSize(),t},s.setVideoSize=function(){var e=this.originVideo;e&&!this.fullscreen&&(this.firstPlay?e.setVideoRect(this.x,this.y,0,0):e.setVideoRect(this.x,this.y,this.widthSet,this.heightSet))},s.$measureContentBounds=function(e){var t=this.posterData;t?e.setTo(0,0,this.getPlayWidth(),this.getPlayHeight()):e.setEmpty()},s.$render=function(){var e=this.$renderNode,t=this.posterData,r=this.getPlayWidth(),i=this.getPlayHeight();0>=r||0>=i||(!this.isPlayed&&t?(e.image=t,e.drawImage(0,0,t.width,t.height,0,0,r,i)):this.isPlayed&&this.setVideoSize())},s.markDirty=function(){return this.$invalidate(),!0},i}(e.DisplayObject);t.NativeVideo=r,e.registerClass(r,"egret.native2.NativeVideo",["egret.Video"])}(t=e.native2||(e.native2={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var r=function(r){function i(){r.call(this),this._url="",this._method="",this.urlData={},this.responseHeader=""}__extends(i,r);var a=__define,n=i,s=n.prototype;return a(s,"response",function(){return this._response}),a(s,"responseType",function(){return this._responseType},function(e){this._responseType=e}),a(s,"withCredentials",function(){return this._withCredentials},function(e){this._withCredentials=e}),s.open=function(e,t){void 0===t&&(t="GET"),this._url=e,this._method=t},s.send=function(r){function i(){var t=new e.PromiseObject;t.onSuccessFunc=function(t){n._response=t,e.Event.dispatchEvent(n,e.Event.COMPLETE)},t.onErrorFunc=function(){e.Event.dispatchEvent(n,e.IOErrorEvent.IO_ERROR)},n._responseType==e.HttpResponseType.ARRAY_BUFFER?egret_native.readFileAsync(n._url,t,"ArrayBuffer"):egret_native.readFileAsync(n._url,t)}function a(){var r=t.PromiseObject.create();r.onSuccessFunc=i,r.onErrorFunc=function(){e.Event.dispatchEvent(n,e.IOErrorEvent.IO_ERROR)},r.onResponseHeaderFunc=this.onResponseHeader,r.onResponseHeaderThisObject=this,egret_native.download(n._url,n._url,r)}var n=this;if(n.isNetUrl(n._url)){n.urlData.type=n._method,n._method==e.HttpMethod.POST&&r?r instanceof ArrayBuffer?n.urlData.data=r:n.urlData.data=r.toString():delete n.urlData.data,n._responseType==e.HttpResponseType.ARRAY_BUFFER?n.urlData.binary=!0:n.urlData.header=!1,this.headerObj?n.urlData.header=JSON.stringify(this.headerObj):delete n.urlData.header;var s=t.PromiseObject.create();s.onSuccessFunc=function(t){n._response=t,e.callLater(e.Event.dispatchEvent,e.Event,n,e.Event.COMPLETE)},s.onErrorFunc=function(t){e.$warn(1019,t),e.Event.dispatchEvent(n,e.IOErrorEvent.IO_ERROR)},s.onResponseHeaderFunc=this.onResponseHeader,s.onResponseHeaderThisObject=this,egret_native.requireHttp(n._url,n.urlData,s)}else egret_native.isFileExists(n._url)?i():a()},s.isNetUrl=function(e){return-1!=e.indexOf("http://")||-1!=e.indexOf("HTTP://")},s.abort=function(){},s.onResponseHeader=function(e){this.responseHeader=e},s.getAllResponseHeaders=function(){return this.responseHeader},s.setRequestHeader=function(e,t){this.headerObj||(this.headerObj={}),this.headerObj[e]=t},s.getResponseHeader=function(e){return""},i}(e.EventDispatcher);t.NativeHttpRequest=r,e.registerClass(r,"egret.native2.NativeHttpRequest",["egret.HttpRequest"]),e.HttpRequest=r}(t=e.native2||(e.native2={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var r=function(t){function r(){t.apply(this,arguments),this.data=null,this._crossOrigin=null}__extends(r,t);var i=__define,a=r,n=a.prototype;return i(n,"crossOrigin",function(){return this._crossOrigin},function(e){this._crossOrigin=e}),n.load=function(e){this.check(e)},n.check=function(e){var t=this;t.isNetUrl(e)?t.download(e):egret_native.isFileExists(e)?t.loadTexture(e):t.download(e)},n.download=function(t){var r=this,i=e.PromiseObject.create();i.onSuccessFunc=function(){r.loadTexture(t)},i.onErrorFunc=function(){r.dispatchEventWith(e.IOErrorEvent.IO_ERROR)},egret_native.download(t,t,i)},n.loadTexture=function(t){var r=this,i=new e.PromiseObject;i.onSuccessFunc=function(t){r.data=new e.BitmapData(t),r.dispatchEventWith(e.Event.COMPLETE)},i.onErrorFunc=function(){r.dispatchEventWith(e.IOErrorEvent.IO_ERROR)},egret_native.createRawImage(t,i)},n.isNetUrl=function(e){return-1!=e.indexOf("http://")||-1!=e.indexOf("HTTP://")},r.crossOrigin=null,r}(e.EventDispatcher);t.NativeImageLoader=r,e.registerClass(r,"egret.native2.NativeImageLoader",["egret.ImageLoader"]),e.ImageLoader=r}(t=e.native2||(e.native2={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var r=function(t){function r(){t.call(this),this.textValue="",this.colorValue=16777215,this.isFinishDown=!1,this.textValue=""}__extends(r,t);var i=(__define,r),a=i.prototype;return a.$getText=function(){return this.textValue||(this.textValue=""),this.textValue},a.$setText=function(e){return this.textValue=e,!0},a.$setColor=function(e){return this.colorValue=e,!0},a.$onBlur=function(){},a.showScreenKeyboard=function(){var t=this;t.dispatchEvent(new e.Event("focus")),e.Event.dispatchEvent(t,"focus",!1,{showing:!0}),egret_native.EGT_TextInput=function(r){t.$textfield.multiline?(t.textValue=r,t.dispatchEvent(new e.Event("updateText")),t.isFinishDown&&(t.isFinishDown=!1,t.dispatchEvent(new e.Event("blur")))):(t.textValue=r.replace(/[\n|\r]/,""),egret_native.TextInputOp.setKeybordOpen(!1),t.dispatchEvent(new e.Event("updateText")),t.dispatchEvent(new e.Event("blur")))},egret_native.EGT_keyboardFinish=function(){t.$textfield.multiline&&(t.isFinishDown=!0)}},a.$show=function(){var t=this;egret_native.TextInputOp.setKeybordOpen(!1),egret_native.EGT_getTextEditerContentText=function(){return t.$getText()},egret_native.EGT_keyboardDidShow=function(){t.showScreenKeyboard(),egret_native.EGT_keyboardDidShow=function(){}},egret_native.EGT_keyboardDidHide=function(){},egret_native.EGT_deleteBackward=function(){};var r=this.$textfield,i=r.$TextField,a=i[37],n=i[30]?0:6,s=-1;a==e.TextFieldInputType.PASSWORD?s=0:a==e.TextFieldInputType.TEL&&(n=3);var o=1,h=i[21]<=0?-1:i[21],u=r.$getRenderNode(),c=u.renderMatrix;egret_native.TextInputOp.setKeybordOpen(!0,JSON.stringify({inputMode:n,inputFlag:s,returnType:o,maxLength:h,x:c.tx,y:c.ty,width:r.width,height:r.height,font_size:i[0],font_color:i[2],textAlign:i[9],verticalAlign:i[10]}))},a.$hide=function(){egret_native.TextInputOp.setKeybordOpen(!1),this.dispatchEvent(new e.Event("blur"))},a.$resetStageText=function(){},a.$addToStage=function(){},a.$removeFromStage=function(){},a.$setTextField=function(e){return this.$textfield=e,!0},r}(e.EventDispatcher);t.NativeStageText=r,e.registerClass(r,"egret.native2.NativeStageText",["egret.StageText"]),e.StageText=r}(t=e.native2||(e.native2={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){function r(e,t,r,i,a){return 0}e.sys.measureText=r}(t=e.native2||(e.native2={}))}(egret||(egret={}));var egret;!function(e){var t;!function(e){}(t=e.native2||(e.native2={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){function r(e,t){e=isNaN(e)?480:e,t=isNaN(t)?800:t;var r=new egret_native.Canvas(e,t),i=r.getContext("2d");if(void 0===i.imageSmoothingEnabled){for(var a=["webkitImageSmoothingEnabled","mozImageSmoothingEnabled","msImageSmoothingEnabled"],n=a.length-1;n>=0;n--){var s=a[n];if(void 0!==i[s])break}try{Object.defineProperty(i,"imageSmoothingEnabled",{get:function(){return this[s]},set:function(e){this[s]=e}})}catch(o){i.imageSmoothingEnabled=i[s]}}return r}var i,a=function(){function e(e,t,r){}var t=__define,a=e,n=a.prototype;return t(n,"width",function(){return this.surface.width}),t(n,"height",function(){return this.surface.height}),n.resize=function(e,t,r){var i=this.surface;if(r){var a=!1;i.width<e&&(i.width=e,a=!0),i.height<t&&(i.height=t,a=!0),a||(this.context.globalCompositeOperation="source-over",this.context.setTransform(1,0,0,1,0,0),this.context.globalAlpha=1)}else i.width!=e&&(i.width=e),i.height!=t&&(i.height=t);this.clear()},n.resizeTo=function(e,t,a,n){i||(i=r());var s=(this.context,this.surface),o=i,h=o.getContext("2d");i=s,this.context=h,this.surface=o,o.width=Math.max(e,257),o.height=Math.max(t,257),h.setTransform(1,0,0,1,0,0),h.drawImage(s,a,n),s.height=1,s.width=1},n.setDirtyRegionPolicy=function(e){},n.beginClip=function(e,t,r){t=+t||0,r=+r||0;var i=this.context;i.save(),i.beginPath(),i.setTransform(1,0,0,1,t,r);for(var a=e.length,n=0;a>n;n++){var s=e[n];i.clearRect(s.minX,s.minY,s.width,s.height),i.rect(s.minX,s.minY,s.width,s.height)}i.clip()},n.endClip=function(){this.context.restore()},n.getPixel=function(e,t){return this.context.getImageData(e,t,1,1).data},n.toDataURL=function(e,t){return this.surface.toDataURL(e,t)},n.clear=function(){this.context.setTransform(1,0,0,1,0,0),this.context.clearRect(0,0,this.surface.width,this.surface.height)},n.destroy=function(){this.surface.width=this.surface.height=0},e}();t.CanvasRenderBuffer=a,e.registerClass(a,"egret.native2.CanvasRenderBuffer",["egret.sys.RenderBuffer"])}(t=e.native2||(e.native2={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var r=function(){function e(){this.drawData=[],this.drawDataLen=0}var t=(__define,e),r=t.prototype;return r.pushDrawRect=function(){if(0==this.drawDataLen||1!=this.drawData[this.drawDataLen-1].type){var e=this.drawData[this.drawDataLen]||{};e.type=1,e.count=0,this.drawData[this.drawDataLen]=e,this.drawDataLen++}this.drawData[this.drawDataLen-1].count+=2},r.pushDrawTexture=function(e,t,r,i,a){if(void 0===t&&(t=2),r){var n=this.drawData[this.drawDataLen]||{};n.type=0,n.texture=e,n.filter=r,n.count=t,n.textureWidth=i,n.textureHeight=a,this.drawData[this.drawDataLen]=n,this.drawDataLen++}else{if(0==this.drawDataLen||0!=this.drawData[this.drawDataLen-1].type||e!=this.drawData[this.drawDataLen-1].texture||this.drawData[this.drawDataLen-1].filter){var n=this.drawData[this.drawDataLen]||{};n.type=0,n.texture=e,n.count=0,this.drawData[this.drawDataLen]=n,this.drawDataLen++}this.drawData[this.drawDataLen-1].count+=t}},r.pushPushMask=function(e){void 0===e&&(e=1);var t=this.drawData[this.drawDataLen]||{};t.type=2,t.count=2*e,this.drawData[this.drawDataLen]=t,this.drawDataLen++},r.pushPopMask=function(e){void 0===e&&(e=1);var t=this.drawData[this.drawDataLen]||{};t.type=3,t.count=2*e,this.drawData[this.drawDataLen]=t,this.drawDataLen++},r.pushSetBlend=function(e){for(var t=this.drawDataLen,r=!1,i=t-1;i>=0;i--){var a=this.drawData[i];if(a){if((0==a.type||1==a.type)&&(r=!0),!r&&4==a.type){this.drawData.splice(i,1),this.drawDataLen--;continue}if(4==a.type){if(a.value==e)return;
break}}}var n=this.drawData[this.drawDataLen]||{};n.type=4,n.value=e,this.drawData[this.drawDataLen]=n,this.drawDataLen++},r.pushResize=function(e,t,r){var i=this.drawData[this.drawDataLen]||{};i.type=5,i.buffer=e,i.width=t,i.height=r,this.drawData[this.drawDataLen]=i,this.drawDataLen++},r.pushClearColor=function(){var e=this.drawData[this.drawDataLen]||{};e.type=6,this.drawData[this.drawDataLen]=e,this.drawDataLen++},r.pushActivateBuffer=function(e){for(var t=this.drawDataLen,r=!1,i=t-1;i>=0;i--){var a=this.drawData[i];!a||(4!=a.type&&7!=a.type&&(r=!0),r||7!=a.type)||(this.drawData.splice(i,1),this.drawDataLen--)}var n=this.drawData[this.drawDataLen]||{};n.type=7,n.buffer=e,n.width=e.rootRenderTarget.width,n.height=e.rootRenderTarget.height,this.drawData[this.drawDataLen]=n,this.drawDataLen++},r.pushEnableScissor=function(e,t,r,i){var a=this.drawData[this.drawDataLen]||{};a.type=8,a.x=e,a.y=t,a.width=r,a.height=i,this.drawData[this.drawDataLen]=a,this.drawDataLen++},r.pushDisableScissor=function(){var e=this.drawData[this.drawDataLen]||{};e.type=9,this.drawData[this.drawDataLen]=e,this.drawDataLen++},r.clear=function(){for(var e=0;e<this.drawDataLen;e++){var t=this.drawData[e];t.type=0,t.count=0,t.texture=null,t.filter=null,t.uv=null,t.value="",t.buffer=null,t.width=0,t.height=0}this.drawDataLen=0},e}();t.WebGLDrawCmdManager=r,e.registerClass(r,"egret.native2.WebGLDrawCmdManager")}(t=e.native2||(e.native2={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var r=function(){function r(r,i,a){if(this.globalAlpha=1,this.stencilState=!1,this.$stencilList=[],this.stencilHandleCount=0,this.$scissorState=!1,this.scissorRect=new e.Rectangle,this.$hasScissor=!0,this.dirtyRegionPolicy=!0,this._dirtyRegionPolicy=!0,this.$drawCalls=0,this.$computeDrawCall=!1,this.globalMatrix=new e.Matrix,this.savedGlobalMatrix=new e.Matrix,this.context=t.WebGLRenderContext.getInstance(r,i),this.rootRenderTarget=new t.WebGLRenderTarget(this.context.context,3,3),r&&i&&this.resize(r,i),this.root=a,this.root)this.context.pushBuffer(this),this.surface=this.context.surface;else{var n=this.context.activatedBuffer;n&&n.rootRenderTarget.activate(),this.surface=this.rootRenderTarget}}var a=__define,n=r,s=n.prototype;return s.enableStencil=function(){this.stencilState||(this.context.enableStencilTest(),this.stencilState=!0)},s.disableStencil=function(){this.stencilState&&(this.context.disableStencilTest(),this.stencilState=!1)},s.restoreStencil=function(){this.stencilState?this.context.enableStencilTest():this.context.disableStencilTest()},s.enableScissor=function(e,t,r,i){this.$scissorState||(this.$scissorState=!0,this.scissorRect.setTo(e,t,r,i),this.context.enableScissorTest(this.scissorRect))},s.disableScissor=function(){this.$scissorState&&(this.$scissorState=!1,this.scissorRect.setEmpty(),this.context.disableScissorTest())},s.restoreScissor=function(){this.$scissorState?this.context.enableScissorTest(this.scissorRect):this.context.disableScissorTest()},a(s,"width",function(){return this.rootRenderTarget.width}),a(s,"height",function(){return this.rootRenderTarget.height}),s.resize=function(e,t,r){this.context.pushBuffer(this),e=e||1,t=t||1,(e!=this.rootRenderTarget.width||t!=this.rootRenderTarget.height)&&(this.context.drawCmdManager.pushResize(this,e,t),this.rootRenderTarget.width=e,this.rootRenderTarget.height=t),this.root&&this.context.resize(e,t,r),this.context.clear(),this.context.popBuffer()},s.resizeTo=function(e,t,i,a){this.context.pushBuffer(this);var n=this.rootRenderTarget.width,s=this.rootRenderTarget.height,o=r.create(n,s);this.context.pushBuffer(o),this.context.drawImage(this.rootRenderTarget,0,0,n,s,0,0,n,s,n,s),this.context.popBuffer(),this.resize(e,t),this.setTransform(1,0,0,1,0,0),this.context.drawImage(o.rootRenderTarget,0,0,n,s,i,a,n,s,n,s),r.release(o),this.context.popBuffer()},s.setDirtyRegionPolicy=function(e){this.dirtyRegionPolicy="on"==e},s.beginClip=function(e,t,r){this.context.pushBuffer(this),this.root&&(this._dirtyRegionPolicy?(this.rootRenderTarget.useFrameBuffer=!0,this.rootRenderTarget.activate()):(this.rootRenderTarget.useFrameBuffer=!1,this.rootRenderTarget.activate(),this.context.clear())),t=+t||0,r=+r||0,this.setTransform(1,0,0,1,t,r);var i=e.length;if(1==i&&0==e[0].minX&&0==e[0].minY&&e[0].width==this.rootRenderTarget.width&&e[0].height==this.rootRenderTarget.height)return this.maskPushed=!1,this.rootRenderTarget.useFrameBuffer&&this.context.clear(),void this.context.popBuffer();for(var a=0;i>a;a++){var n=e[a];this.context.clearRect(n.minX,n.minY,n.width,n.height)}if(i>0){if(this.$hasScissor||1!=i)this.scissorEnabled=!1;else{var n=e[0];e=e.slice(1);var s=n.minX+t,o=n.minY+r,h=n.width,u=n.height;this.context.enableScissor(s,-o-u+this.height,h,u),this.scissorEnabled=!0}e.length>0?(this.context.pushMask(e),this.maskPushed=!0):this.maskPushed=!1,this.offsetX=t,this.offsetY=r}else this.maskPushed=!1;this.context.popBuffer()},s.endClip=function(){(this.maskPushed||this.scissorEnabled)&&(this.context.pushBuffer(this),this.maskPushed&&(this.setTransform(1,0,0,1,this.offsetX,this.offsetY),this.context.popMask()),this.scissorEnabled&&this.context.disableScissor(),this.context.popBuffer())},s.getPixel=function(e,t){var r=new Uint8Array(4),i=this.rootRenderTarget.useFrameBuffer;return this.rootRenderTarget.useFrameBuffer=!0,this.rootRenderTarget.activate(),this.context.getPixels(e,t,1,1,r),this.rootRenderTarget.useFrameBuffer=i,this.rootRenderTarget.activate(),r},s.toDataURL=function(e,t){return this.context.surface.toDataURL(e,t)},s.destroy=function(){this.context.destroy()},s.onRenderFinish=function(){this.$drawCalls=0,this.root&&(!this._dirtyRegionPolicy&&this.dirtyRegionPolicy&&this.drawSurfaceToFrameBuffer(0,0,this.rootRenderTarget.width,this.rootRenderTarget.height,0,0,this.rootRenderTarget.width,this.rootRenderTarget.height,!0),this._dirtyRegionPolicy&&this.drawFrameBufferToSurface(0,0,this.rootRenderTarget.width,this.rootRenderTarget.height,0,0,this.rootRenderTarget.width,this.rootRenderTarget.height),this._dirtyRegionPolicy=this.dirtyRegionPolicy)},s.drawFrameBufferToSurface=function(e,t,r,i,a,n,s,o,h){void 0===h&&(h=!1),this.rootRenderTarget.useFrameBuffer=!1,this.rootRenderTarget.activate(),this.context.disableStencilTest(),this.context.disableScissorTest(),this.setTransform(1,0,0,1,0,0),this.globalAlpha=1,this.context.setGlobalCompositeOperation("source-over"),h&&this.context.clear(),this.context.drawImage(this.rootRenderTarget,e,t,r,i,a,n,s,o,r,i),this.context.$drawWebGL(),this.rootRenderTarget.useFrameBuffer=!0,this.rootRenderTarget.activate(),this.restoreStencil(),this.restoreScissor()},s.drawSurfaceToFrameBuffer=function(e,t,r,i,a,n,s,o,h){void 0===h&&(h=!1),this.rootRenderTarget.useFrameBuffer=!0,this.rootRenderTarget.activate(),this.context.disableStencilTest(),this.context.disableScissorTest(),this.setTransform(1,0,0,1,0,0),this.globalAlpha=1,this.context.setGlobalCompositeOperation("source-over"),h&&this.context.clear(),this.context.drawImage(this.context.surface,e,t,r,i,a,n,s,o,r,i),this.context.$drawWebGL(),this.rootRenderTarget.useFrameBuffer=!1,this.rootRenderTarget.activate(),this.restoreStencil(),this.restoreScissor()},s.clear=function(){this.context.clear()},s.setTransform=function(e,t,r,i,a,n){var s=this.globalMatrix;s.a=e,s.b=t,s.c=r,s.d=i,s.tx=a,s.ty=n},s.transform=function(e,t,r,i,a,n){var s=this.globalMatrix,o=s.a,h=s.b,u=s.c,c=s.d;(1!=e||0!=t||0!=r||1!=i)&&(s.a=e*o+t*u,s.b=e*h+t*c,s.c=r*o+i*u,s.d=r*h+i*c),s.tx=a*o+n*u+s.tx,s.ty=a*h+n*c+s.ty},s.translate=function(e,t){var r=this.globalMatrix;r.tx+=e,r.ty+=t},s.saveTransform=function(){var e=this.globalMatrix,t=this.savedGlobalMatrix;t.a=e.a,t.b=e.b,t.c=e.c,t.d=e.d,t.tx=e.tx,t.ty=e.ty},s.restoreTransform=function(){var e=this.globalMatrix,t=this.savedGlobalMatrix;e.a=t.a,e.b=t.b,e.c=t.c,e.d=t.d,e.tx=t.tx,e.ty=t.ty},r.create=function(e,t){var a=i.pop();return a?a.resize(e,t):(a=new r(e,t),a.$computeDrawCall=!1),a},r.release=function(e){i.push(e)},r}();t.WebGLRenderBuffer=r,e.registerClass(r,"egret.native2.WebGLRenderBuffer",["egret.sys.RenderBuffer"]);var i=[]}(t=e.native2||(e.native2={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){function r(e,t){e=isNaN(e)?480:e,t=isNaN(t)?800:t;var r=new egret_native.Canvas(e,t);return r}var i=function(){function i(e,i){this.glID=null,this.projectionX=0/0,this.projectionY=0/0,this.shaderManager=null,this.contextLost=!1,this.$scissorState=!1,this.vertSize=5,this.blurFilter=null,this.surface=r(e,i),this.initWebGL(),this.$bufferStack=[];var a=this.context;this.vertexBuffer=a.createBuffer(),this.indexBuffer=a.createBuffer(),a.bindBuffer(a.ARRAY_BUFFER,this.vertexBuffer),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this.indexBuffer),this.drawCmdManager=new t.WebGLDrawCmdManager,this.vao=new t.WebGLVertexArrayObject,this.setGlobalCompositeOperation("source-over")}var a=(__define,i),n=a.prototype;return i.getInstance=function(e,t){return this.instance?this.instance:(this.instance=new i(e,t),this.instance)},n.pushBuffer=function(e){this.$bufferStack.push(e),e!=this.currentBuffer&&(this.currentBuffer,this.drawCmdManager.pushActivateBuffer(e)),this.currentBuffer=e},n.popBuffer=function(){if(!(this.$bufferStack.length<=1)){var e=this.$bufferStack.pop(),t=this.$bufferStack[this.$bufferStack.length-1];e!=t&&this.drawCmdManager.pushActivateBuffer(t),this.currentBuffer=t}},n.activateBuffer=function(e){e.rootRenderTarget.activate(),this.bindIndices||(this.uploadIndicesArray(this.vao.getIndices()),this.bindIndices=!0),e.restoreStencil(),e.restoreScissor(),this.onResize(e.width,e.height)},n.uploadVerticesArray=function(e){var t=this.context;t.bufferData(t.ARRAY_BUFFER,e,t.STREAM_DRAW)},n.uploadIndicesArray=function(e){var t=this.context;t.bufferData(t.ELEMENT_ARRAY_BUFFER,e,t.STATIC_DRAW)},n.destroy=function(){this.surface.width=this.surface.height=0},n.onResize=function(e,t){var e=e||this.surface.width,t=t||this.surface.height;this.projectionX=e/2,this.projectionY=-t/2,this.context&&this.context.viewport(0,0,e,t)},n.resize=function(e,t,r){var i=this.surface;r?(i.width<e&&(i.width=e),i.height<t&&(i.height=t)):(i.width!=e&&(i.width=e),i.height!=t&&(i.height=t)),this.onResize()},n.initWebGL=function(){this.onResize(),this.getWebGLContext(),this.shaderManager=new t.WebGLShaderManager(this.context)},n.handleContextLost=function(){this.contextLost=!0},n.handleContextRestored=function(){this.initWebGL(),this.contextLost=!1},n.getWebGLContext=function(){for(var t,r={antialias:i.antialias,stencil:!0},a=["webgl","experimental-webgl"],n=0;n<a.length;n++){try{t=this.surface.getContext(a[n],r)}catch(s){}if(t)break}t||e.$error(1021),this.setContext(t)},n.setContext=function(e){this.context=e,e.id=i.glContextId++,this.glID=e.id,e.disable(e.DEPTH_TEST),e.disable(e.CULL_FACE),e.enable(e.BLEND),e.colorMask(!0,!0,!0,!0),e.activeTexture(e.TEXTURE0)},n.enableStencilTest=function(){var e=this.context;e.enable(e.STENCIL_TEST)},n.disableStencilTest=function(){var e=this.context;e.disable(e.STENCIL_TEST)},n.enableScissorTest=function(e){var t=this.context;t.enable(t.SCISSOR_TEST),t.scissor(e.x,e.y,e.width,e.height)},n.disableScissorTest=function(){var e=this.context;e.disable(e.SCISSOR_TEST)},n.getPixels=function(e,t,r,i,a){var n=this.context;n.readPixels(e,t,r,i,n.RGBA,n.UNSIGNED_BYTE,a)},n.createTexture=function(e){var t=this.context,r=t.createTexture();return r?(r.glContext=t,t.bindTexture(t.TEXTURE_2D,r),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),r):void(this.contextLost=!0)},n.createTextureFromCompressedData=function(e,t,r,i,a){return null},n.updateTexture=function(e,t){var r=this.context;r.bindTexture(r.TEXTURE_2D,e),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,t)},n.getWebGLTexture=function(e){return e.webGLTexture||("image"==e.format?e.webGLTexture=this.createTexture(e.source):"pvr"==e.format&&(e.webGLTexture=this.createTextureFromCompressedData(e.source.pvrtcData,e.width,e.height,e.source.mipmapsCount,e.source.format)),e.$deleteSource&&e.webGLTexture&&(e.source=null)),e.webGLTexture},n.clearRect=function(e,t,r,i){if(0!=e||0!=t||r!=this.surface.width||i!=this.surface.height){var a=this.currentBuffer;if(a.$hasScissor)this.setGlobalCompositeOperation("destination-out"),this.drawRect(e,t,r,i),this.setGlobalCompositeOperation("source-over");else{var n=a.globalMatrix;0==n.b&&0==n.c?(e=e*n.a+n.tx,t=t*n.d+n.ty,r*=n.a,i*=n.d,this.enableScissor(e,-t-i+a.height,r,i),this.clear(),this.disableScissor()):(this.setGlobalCompositeOperation("destination-out"),this.drawRect(e,t,r,i),this.setGlobalCompositeOperation("source-over"))}}else this.clear()},n.setGlobalCompositeOperation=function(e){this.drawCmdManager.pushSetBlend(e)},n.drawImage=function(e,t,r,i,a,n,s,o,h,u,c){var l=this.currentBuffer;if(!this.contextLost&&e&&l){var d;if(e.source&&e.source.texture)d=e.source.texture,l.saveTransform(),l.transform(1,0,0,-1,0,h+2*s);else{if(!e.source&&!e.webGLTexture)return;d=this.getWebGLTexture(e)}d&&(this.drawTexture(d,t,r,i,a,n,s,o,h,u,c),e.source&&e.source.texture&&l.restoreTransform())}},n.drawMesh=function(e,t,r,i,a,n,s,o,h,u,c,l,d,f,v){var g=this.currentBuffer;if(!this.contextLost&&e&&g){var p;if(e.source&&e.source.texture)p=e.source.texture,g.saveTransform(),g.transform(1,0,0,-1,0,h+2*s);else{if(!e.source&&!e.webGLTexture)return;p=this.getWebGLTexture(e)}p&&this.drawTexture(p,t,r,i,a,n,s,o,h,u,c,l,d,f,v)}},n.drawTexture=function(e,t,r,i,a,n,s,o,h,u,c,l,d,f,v){var g=this.currentBuffer;if(!this.contextLost&&e&&g){d&&f?this.vao.reachMaxSize(d.length/2,f.length)&&this.$drawWebGL():this.vao.reachMaxSize()&&this.$drawWebGL(),l&&this.vao.changeToMeshIndices();var p=g.globalMatrix,x=g.globalAlpha,m=f?f.length/3:2;this.drawCmdManager.pushDrawTexture(e,m,this.$filter),this.vao.cacheArrays(p,x,t,r,i,a,n,s,o,h,u,c,l,d,f)}},n.drawRect=function(e,t,r,i){var a=this.currentBuffer;!this.contextLost&&a&&(this.vao.reachMaxSize()&&this.$drawWebGL(),this.drawCmdManager.pushDrawRect(),this.vao.cacheArrays(a.globalMatrix,a.globalAlpha,0,0,r,i,e,t,r,i,r,i))},n.pushMask=function(e){var t=this.currentBuffer;if(!this.contextLost&&t){t.$stencilList.push(e),this.vao.reachMaxSize()&&this.$drawWebGL();var r=e.length;if(r){this.drawCmdManager.pushPushMask(r);for(var i=0;r>i;i++){var a=e[i];this.vao.cacheArrays(t.globalMatrix,t.globalAlpha,0,0,a.width,a.height,a.minX,a.minY,a.width,a.height,a.width,a.height)}}else this.drawCmdManager.pushPushMask(),this.vao.cacheArrays(t.globalMatrix,t.globalAlpha,0,0,e.width,e.height,e.x,e.y,e.width,e.height,e.width,e.height)}},n.popMask=function(){var e=this.currentBuffer;if(!this.contextLost&&e){var t=e.$stencilList.pop();this.vao.reachMaxSize()&&this.$drawWebGL();var r=t.length;if(r){this.drawCmdManager.pushPopMask(r);for(var i=0;r>i;i++){var a=t[i];this.vao.cacheArrays(e.globalMatrix,e.globalAlpha,0,0,a.width,a.height,a.minX,a.minY,a.width,a.height,a.width,a.height)}}else this.drawCmdManager.pushPopMask(),this.vao.cacheArrays(e.globalMatrix,e.globalAlpha,0,0,t.width,t.height,t.x,t.y,t.width,t.height,t.width,t.height)}},n.clear=function(){this.drawCmdManager.pushClearColor()},n.enableScissor=function(e,t,r,i){var a=this.currentBuffer;this.drawCmdManager.pushEnableScissor(e,t,r,i),a.$hasScissor=!0},n.disableScissor=function(){var e=this.currentBuffer;this.drawCmdManager.pushDisableScissor(),e.$hasScissor=!1},n.$drawWebGL=function(){if(0!=this.drawCmdManager.drawDataLen&&!this.contextLost){this.uploadVerticesArray(this.vao.getVertices()),this.vao.isMesh()&&this.uploadIndicesArray(this.vao.getMeshIndices());for(var e=this.drawCmdManager.drawDataLen,t=0,r=0;e>r;r++){var i=this.drawCmdManager.drawData[r];t=this.drawData(i,t),7==i.type&&(this.activatedBuffer=i.buffer),(0==i.type||1==i.type||2==i.type||3==i.type)&&this.activatedBuffer&&this.activatedBuffer.$computeDrawCall&&this.activatedBuffer.$drawCalls++}this.vao.isMesh()&&this.uploadIndicesArray(this.vao.getIndices()),this.drawCmdManager.clear(),this.vao.clear()}},n.drawData=function(e,t){if(e){switch(e.type){case 0:var r,i=e.filter;i?"colorTransform"==i.type?(r=this.shaderManager.colorTransformShader,r.setMatrix(i.$matrix)):"blur"==i.type?(r=this.shaderManager.blurShader,r.setBlur(i.$blurX,i.$blurY),r.setTextureSize(e.textureWidth,e.textureHeight)):"glow"==i.type&&(r=this.shaderManager.glowShader,r.setDistance(i.$distance||0),r.setAngle(i.$angle?i.$angle/180*Math.PI:0),r.setColor(i.$red/255,i.$green/255,i.$blue/255),r.setAlpha(i.$alpha),r.setBlurX(i.$blurX),r.setBlurY(i.$blurY),r.setStrength(i.$strength),r.setInner(i.$inner?1:0),r.setKnockout(i.$knockout?0:1),r.setHideObject(i.$hideObject?1:0),r.setTextureSize(e.textureWidth,e.textureHeight)):r=this.shaderManager.defaultShader,r.setProjection(this.projectionX,this.projectionY),this.shaderManager.activateShader(r,4*this.vertSize),r.syncUniforms(),t+=this.drawTextureElements(e,t);break;case 1:var r=this.shaderManager.primitiveShader;r.setProjection(this.projectionX,this.projectionY),this.shaderManager.activateShader(r,4*this.vertSize),r.syncUniforms(),t+=this.drawRectElements(e,t);break;case 2:var r=this.shaderManager.primitiveShader;r.setProjection(this.projectionX,this.projectionY),this.shaderManager.activateShader(r,4*this.vertSize),r.syncUniforms(),t+=this.drawPushMaskElements(e,t);break;case 3:var r=this.shaderManager.primitiveShader;r.setProjection(this.projectionX,this.projectionY),this.shaderManager.activateShader(r,4*this.vertSize),r.syncUniforms(),t+=this.drawPopMaskElements(e,t);break;case 4:this.setBlendMode(e.value);break;case 5:e.buffer.rootRenderTarget.resize(e.width,e.height),this.onResize(e.width,e.height);break;case 6:if(this.activatedBuffer){var a=this.activatedBuffer.rootRenderTarget;(0!=a.width||0!=a.height)&&a.clear()}break;case 7:this.activateBuffer(e.buffer);break;case 8:var n=this.activatedBuffer;n&&n.enableScissor(e.x,e.y,e.width,e.height);break;case 9:var n=this.activatedBuffer;n&&n.disableScissor()}return t}},n.drawTextureElements=function(e,t){var r=this.context;r.bindTexture(r.TEXTURE_2D,e.texture);var i=3*e.count;return r.drawElements(r.TRIANGLES,i,r.UNSIGNED_SHORT,2*t),i},n.drawRectElements=function(e,t){var r=this.context,i=3*e.count;return r.drawElements(r.TRIANGLES,i,r.UNSIGNED_SHORT,2*t),i},n.drawPushMaskElements=function(e,t){var r=this.context,i=3*e.count,a=this.activatedBuffer;if(a){0==a.stencilHandleCount&&(a.enableStencil(),r.clear(r.STENCIL_BUFFER_BIT));var n=a.stencilHandleCount;a.stencilHandleCount++,r.colorMask(!1,!1,!1,!1),r.stencilFunc(r.EQUAL,n,255),r.stencilOp(r.KEEP,r.KEEP,r.INCR),r.drawElements(r.TRIANGLES,i,r.UNSIGNED_SHORT,2*t),r.stencilFunc(r.EQUAL,n+1,255),r.colorMask(!0,!0,!0,!0),r.stencilOp(r.KEEP,r.KEEP,r.KEEP)}return i},n.drawPopMaskElements=function(e,t){var r=this.context,i=3*e.count,a=this.activatedBuffer;if(a)if(a.stencilHandleCount--,0==a.stencilHandleCount)a.disableStencil();else{var n=a.stencilHandleCount;r.colorMask(!1,!1,!1,!1),r.stencilFunc(r.EQUAL,n+1,255),r.stencilOp(r.KEEP,r.KEEP,r.DECR),r.drawElements(r.TRIANGLES,i,r.UNSIGNED_SHORT,2*t),r.stencilFunc(r.EQUAL,n,255),r.colorMask(!0,!0,!0,!0),r.stencilOp(r.KEEP,r.KEEP,r.KEEP)}return i},n.setBlendMode=function(e){var t=this.context,r=i.blendModesForGL[e];r&&t.blendFunc(r[0],r[1])},n.drawTargetWidthFilters=function(e,r){var i,a=r,n=e.length;if(n>1)for(var s=0;n-1>s;s++){var o=e[s],h=r.rootRenderTarget.width,u=r.rootRenderTarget.height;i=t.WebGLRenderBuffer.create(h,u),i.setTransform(1,0,0,1,0,0),i.globalAlpha=1,this.drawToRenderTarget(o,r,i),r!=a&&t.WebGLRenderBuffer.release(r),r=i}var o=e[n-1];this.drawToRenderTarget(o,r,this.currentBuffer),r!=a&&t.WebGLRenderBuffer.release(r)},n.drawToRenderTarget=function(r,i,a){if(!this.contextLost){this.vao.reachMaxSize()&&this.$drawWebGL(),this.pushBuffer(a);var n,s=i,o=i.rootRenderTarget.width,h=i.rootRenderTarget.height;"blur"==r.type&&(this.blurFilter||(this.blurFilter=new e.BlurFilter(2,2)),0!=r.blurX&&0!=r.blurY?(this.blurFilter.blurX=r.blurX,this.blurFilter.blurY=0,n=t.WebGLRenderBuffer.create(o,h),n.setTransform(1,0,0,1,0,0),n.globalAlpha=1,this.drawToRenderTarget(this.blurFilter,i,n),i!=s&&t.WebGLRenderBuffer.release(i),i=n,this.blurFilter.blurX=0,this.blurFilter.blurY=r.blurY):(this.blurFilter.blurX=r.blurX,this.blurFilter.blurY=r.blurY),r=this.blurFilter),a.saveTransform(),a.transform(1,0,0,-1,0,h),this.vao.cacheArrays(a.globalMatrix,a.globalAlpha,0,0,o,h,0,0,o,h,o,h),a.restoreTransform();var u;u="blur"==r.type?{type:"blur",$blurX:r.$blurX,$blurY:r.$blurY}:r,this.drawCmdManager.pushDrawTexture(i.rootRenderTarget.texture,2,u,o,h),i!=s&&t.WebGLRenderBuffer.release(i),this.popBuffer()}},i.initBlendMode=function(){i.blendModesForGL={},i.blendModesForGL["source-over"]=[1,771],i.blendModesForGL.lighter=[1,772],i.blendModesForGL["lighter-in"]=[770,771],i.blendModesForGL["destination-out"]=[0,771],i.blendModesForGL["destination-in"]=[0,770]},i.glContextId=0,i.blendModesForGL=null,i}();t.WebGLRenderContext=i,e.registerClass(i,"egret.native2.WebGLRenderContext"),i.initBlendMode()}(t=e.native2||(e.native2={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var r=function(){function e(e,t,r){this.clearColor=[0,0,0,0],this.useFrameBuffer=!0,this.gl=e,this.width=t||1,this.height=r||1,this.texture=this.createTexture(),this.frameBuffer=e.createFramebuffer(),e.bindFramebuffer(e.FRAMEBUFFER,this.frameBuffer),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,this.texture,0),this.stencilBuffer=e.createRenderbuffer(),e.bindRenderbuffer(e.RENDERBUFFER,this.stencilBuffer),e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_STENCIL,this.width,this.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.RENDERBUFFER,this.stencilBuffer)}var t=(__define,e),r=t.prototype;return r.resize=function(e,t){var r=this.gl;r.bindTexture(r.TEXTURE_2D,this.texture),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,e,t,0,r.RGBA,r.UNSIGNED_BYTE,null),r.bindFramebuffer(r.FRAMEBUFFER,this.frameBuffer),r.bindRenderbuffer(r.RENDERBUFFER,this.stencilBuffer),r.renderbufferStorage(r.RENDERBUFFER,r.DEPTH_STENCIL,e,t),this.width=e,this.height=t},r.activate=function(){var e=this.gl;e.bindFramebuffer(e.FRAMEBUFFER,this.getFrameBuffer())},r.getFrameBuffer=function(){return this.useFrameBuffer?this.frameBuffer:null},r.createTexture=function(){var e=this.gl,t=e.createTexture();return e.bindTexture(e.TEXTURE_2D,t),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,this.width,this.height,0,e.RGBA,e.UNSIGNED_BYTE,null),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),t},r.clear=function(e){var t=this.gl;e&&this.activate(),t.colorMask(!0,!0,!0,!0),t.clearColor(this.clearColor[0],this.clearColor[1],this.clearColor[2],this.clearColor[3]),t.clear(t.COLOR_BUFFER_BIT)},e}();t.WebGLRenderTarget=r,e.registerClass(r,"egret.native2.WebGLRenderTarget")}(t=e.native2||(e.native2={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var r=["source-over","lighter","destination-out"],i="source-over",a=[],n=function(){function n(){this.nestLevel=0}var s=(__define,n),o=s.prototype;return o.render=function(e,t,r,i,n){this.nestLevel++;var s=t,o=s.context,h=n?e:null;o.pushBuffer(s),this.drawDisplayObject(e,s,i,r,null,null,h),o.$drawWebGL();var u=s.$drawCalls;if(s.onRenderFinish(),o.popBuffer(),this.nestLevel--,0===this.nestLevel){a.length>6&&(a.length=6);for(var c=a.length,l=0;c>l;l++)a[l].resize(0,0)}return u},o.drawDisplayObject=function(t,r,i,a,n,s,o){var h,u=0;if(n&&!o?(n.isDirty&&(u+=n.drawToSurface()),h=n.$renderNode):h=t.$getRenderNode(),h){if(i){var c=h.renderRegion;if(s&&!s.intersects(c))h.needRedraw=!1;else if(!h.needRedraw)for(var l=i.length,d=0;l>d;d++)if(c.intersects(i[d])){h.needRedraw=!0;break}}else h.needRedraw=!0;if(h.needRedraw){u++;var f,v;o?(f=t.$getConcatenatedAlphaAt(o,t.$getConcatenatedAlpha()),v=e.Matrix.create().copyFrom(t.$getConcatenatedMatrix()),t.$getConcatenatedMatrixAt(o,v),a.$preMultiplyInto(v,v),r.setTransform(v.a,v.b,v.c,v.d,v.tx,v.ty),e.Matrix.release(v)):(f=h.renderAlpha,v=h.renderMatrix,r.setTransform(v.a,v.b,v.c,v.d,v.tx+a.tx,v.ty+a.ty)),r.globalAlpha=f,this.renderNode(h,r),h.needRedraw=!1}}if(n&&!o)return u;var g=t.$children;if(g)for(var p=g.length,x=0;p>x;x++){var m=g[x];if(!(!m.$visible||m.$alpha<=0||m.$maskedObject)){var b=m.$getFilters();b&&b.length>0?u+=this.drawWithFilter(m,r,i,a,s,o):0!==m.$blendMode||m.$mask&&(m.$mask.$parentDisplayList||o)?u+=this.drawWithClip(m,r,i,a,s,o):m.$scrollRect||m.$maskRect?u+=this.drawWithScrollRect(m,r,i,a,s,o):m.isFPS?(r.context.$drawWebGL(),r.$computeDrawCall=!1,this.drawDisplayObject(m,r,i,a,m.$displayList,s,o),r.context.$drawWebGL(),r.$computeDrawCall=!0):u+=this.drawDisplayObject(m,r,i,a,m.$displayList,s,o)}}return u},o.drawWithFilter=function(t,n,s,o,h,u){var c=0,l=t.$getFilters(),d=0!==t.$blendMode;if(d){var f=r[t.$blendMode];f||(f=i)}if(1==l.length&&"colorTransform"==l[0].type&&!t.$children)return d&&n.context.setGlobalCompositeOperation(f),n.context.$filter=l[0],c+=this.drawDisplayObject(t,n,s,o,t.$displayList,h,u),n.context.$filter=null,d&&n.context.setGlobalCompositeOperation(i),c;var v=e.Matrix.create();v.copyFrom(t.$getConcatenatedMatrix());var g;g=e.sys.Region.create();var p=t.$getOriginalBounds();g.updateRegion(p,v);var x=this.createRenderBuffer(g.width,g.height);x.context.pushBuffer(x),x.setTransform(1,0,0,1,-g.minX,-g.minY);var m=e.Matrix.create().setTo(1,0,0,1,-g.minX,-g.minY);return c+=this.drawDisplayObject(t,x,s,m,t.$displayList,g,u),e.Matrix.release(m),x.context.popBuffer(),c>0&&(d&&n.context.setGlobalCompositeOperation(f),c++,n.globalAlpha=1,n.setTransform(1,0,0,1,g.minX+o.tx,g.minY+o.ty),n.context.drawTargetWidthFilters(l,x),d&&n.context.setGlobalCompositeOperation(i)),a.push(x),e.sys.Region.release(g),e.Matrix.release(v),c},o.drawWithClip=function(t,n,s,o,h,u){var c=0,l=0!==t.$blendMode;if(l){var d=r[t.$blendMode];d||(d=i)}var f=t.$scrollRect?t.$scrollRect:t.$maskRect,v=t.$mask,v=t.$mask;if(v){var g=v.$getRenderNode();if(g){var p=g.renderMatrix;if(0==p.a&&0==p.b||0==p.c&&0==p.d)return c}}var x,m=e.Matrix.create();if(m.copyFrom(t.$getConcatenatedMatrix()),t.$parentDisplayList){var b,y=t.$parentDisplayList.root;y!==t.$stage&&t.$getConcatenatedMatrixAt(y,m)}if(v){var T=v.$getOriginalBounds();x=e.sys.Region.create();var w=e.Matrix.create();w.copyFrom(v.$getConcatenatedMatrix()),b&&b.$preMultiplyInto(w,w),x.updateRegion(T,w),e.Matrix.release(w)}var S;if(f&&(S=e.sys.Region.create(),S.updateRegion(f,m)),S&&x?(S.intersect(x),e.sys.Region.release(x)):!S&&x&&(S=x),S){if(S.isEmpty()||h&&!h.intersects(S))return e.sys.Region.release(S),e.Matrix.release(m),c}else S=e.sys.Region.create(),T=t.$getOriginalBounds(),S.updateRegion(T,m);var E=!1;if(s){for(var R=s.length,_=0;R>_;_++)if(S.intersects(s[_])){E=!0;break}}else E=!0;if(!E)return e.sys.Region.release(S),e.Matrix.release(m),c;if(v||t.$children&&0!=t.$children.length){var C=this.createRenderBuffer(S.width,S.height);C.context.pushBuffer(C),C.setTransform(1,0,0,1,-S.minX,-S.minY);var L=e.Matrix.create().setTo(1,0,0,1,-S.minX,-S.minY);if(c+=this.drawDisplayObject(t,C,s,L,t.$displayList,S,u),v){var D=this.createRenderBuffer(S.width,S.height);D.context.pushBuffer(D),D.setTransform(1,0,0,1,-S.minX,-S.minY),L=e.Matrix.create().setTo(1,0,0,1,-S.minX,-S.minY);var $=this.drawDisplayObject(v,D,s,L,v.$displayList,S,u);if(D.context.popBuffer(),$>0){c+=$,C.context.setGlobalCompositeOperation("destination-in"),C.setTransform(1,0,0,-1,0,D.height),C.globalAlpha=1;var F=D.rootRenderTarget.width,M=D.rootRenderTarget.height;C.context.drawTexture(D.rootRenderTarget.texture,0,0,F,M,0,0,F,M,F,M),C.context.setGlobalCompositeOperation("source-over")}a.push(D)}if(e.Matrix.release(L),C.context.setGlobalCompositeOperation(i),C.context.popBuffer(),c>0){if(c++,l&&n.context.setGlobalCompositeOperation(d),f){var w=m;C.setTransform(w.a,w.b,w.c,w.d,w.tx-S.minX,w.ty-S.minY),C.context.pushMask(f)}n.globalAlpha=1,n.setTransform(1,0,0,-1,S.minX+o.tx,S.minY+o.ty+C.height);var A=C.rootRenderTarget.width,B=C.rootRenderTarget.height;n.context.drawTexture(C.rootRenderTarget.texture,0,0,A,B,0,0,A,B,A,B),f&&C.context.popMask(),l&&n.context.setGlobalCompositeOperation(i)}return a.push(C),e.sys.Region.release(S),e.Matrix.release(m),c}if(f){var w=m;n.setTransform(w.a,w.b,w.c,w.d,w.tx-S.minX,w.ty-S.minY),n.context.pushMask(f)}return l&&n.context.setGlobalCompositeOperation(d),c+=this.drawDisplayObject(t,n,s,o,t.$displayList,S,null),l&&n.context.setGlobalCompositeOperation(i),f&&n.context.popMask(),e.sys.Region.release(S),e.Matrix.release(m),c},o.drawWithScrollRect=function(t,r,i,a,n,s){var o=0,h=t.$scrollRect?t.$scrollRect:t.$maskRect;if(0==h.width||0==h.height)return o;var u=e.Matrix.create();if(u.copyFrom(t.$getConcatenatedMatrix()),s)t.$getConcatenatedMatrixAt(s,u);else if(t.$parentDisplayList){var c=t.$parentDisplayList.root;c!==t.$stage&&t.$getConcatenatedMatrixAt(c,u)}var l=e.sys.Region.create();if(h.isEmpty()||l.updateRegion(h,u),l.isEmpty()||n&&!n.intersects(l))return e.sys.Region.release(l),e.Matrix.release(u),o;var d=!1;if(i){for(var f=i.length,v=0;f>v;v++)if(l.intersects(i[v])){d=!0;break}}else d=!0;if(!d)return e.sys.Region.release(l),e.Matrix.release(u),o;r.setTransform(u.a,u.b,u.c,u.d,u.tx+a.tx,u.ty+a.ty);var g=r.context,p=!1;if(r.$hasScissor||0!=u.b||0!=u.c)g.pushMask(h);else{var x=h.x,m=h.y,b=h.width,y=h.height;x=x*u.a+u.tx+a.tx,m=m*u.d+u.ty+a.ty,b*=u.a,y*=u.d,g.enableScissor(x,-m-y+r.height,b,y),p=!0}return o+=this.drawDisplayObject(t,r,i,a,t.$displayList,l,s),r.setTransform(u.a,u.b,u.c,u.d,u.tx+a.tx,u.ty+a.ty),p?g.disableScissor():g.popMask(),e.sys.Region.release(l),e.Matrix.release(u),o},o.drawNodeToBuffer=function(e,t,r,i){var a=t;a.context.pushBuffer(a),a.setTransform(r.a,r.b,r.c,r.d,r.tx,r.ty),this.renderNode(e,t,i),a.context.$drawWebGL(),a.onRenderFinish(),a.context.popBuffer()},o.renderNode=function(e,t,r){switch(e.type){case 1:this.renderBitmap(e,t);break;case 2:this.renderText(e,t);break;case 3:this.renderGraphics(e,t,r);break;case 4:this.renderGroup(e,t);break;case 6:t.globalAlpha=e.drawData[0];break;case 7:this.renderMesh(e,t)}},o.renderBitmap=function(e,t){var a=e.image;if(a){var n=e.drawData,s=n.length,o=0,h=e.matrix,u=e.blendMode,c=e.alpha;if(h&&(t.saveTransform(),t.transform(h.a,h.b,h.c,h.d,h.tx,h.ty)),u&&t.context.setGlobalCompositeOperation(r[u]),c==c){var l=t.globalAlpha;t.globalAlpha*=c}if(e.filter){for(t.context.$filter=e.filter;s>o;)t.context.drawImage(a,n[o++],n[o++],n[o++],n[o++],n[o++],n[o++],n[o++],n[o++],e.imageWidth,e.imageHeight);t.context.$filter=null}else for(;s>o;)t.context.drawImage(a,n[o++],n[o++],n[o++],n[o++],n[o++],n[o++],n[o++],n[o++],e.imageWidth,e.imageHeight);u&&t.context.setGlobalCompositeOperation(i),c==c&&(t.globalAlpha=l),h&&t.restoreTransform()}},o.renderMesh=function(e,t){var r=e.image,i=e.drawData,a=i.length,n=0,s=e.matrix;for(s&&(t.saveTransform(),t.transform(s.a,s.b,s.c,s.d,s.tx,s.ty));a>n;)t.context.drawMesh(r,i[n++],i[n++],i[n++],i[n++],i[n++],i[n++],i[n++],i[n++],e.imageWidth,e.imageHeight,e.uvs,e.vertices,e.indices,e.bounds);s&&t.restoreTransform()},o.renderText=function(e,t){return},o.renderGraphics=function(e,t,r){return},o.renderGroup=function(e,t){for(var r=e.drawData,i=r.length,a=0;i>a;a++){var n=r[a];this.renderNode(n,t)}},o.createRenderBuffer=function(e,r){var i=a.pop();return i?i.resize(e,r):(i=new t.WebGLRenderBuffer(e,r),i.$computeDrawCall=!1),i},n}();t.WebGLRenderer=n,e.registerClass(n,"egret.native2.WebGLRenderer",["egret.sys.SystemRenderer"])}(t=e.native2||(e.native2={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var r=function(){function e(e){this.gl=null,this.maxAttibs=10,this.attribState=[],this.tempAttribState=[],this.currentShader=null,this.defaultShader=null,this.primitiveShader=null,this.colorTransformShader=null,this.blurShader=null,this.glowShader=null;
for(var t=0;t<this.maxAttibs;t++)this.attribState[t]=!1;this.setContext(e)}var r=(__define,e),i=r.prototype;return i.setContext=function(e){this.gl=e,this.primitiveShader=new t.PrimitiveShader(e),this.defaultShader=new t.TextureShader(e),this.colorTransformShader=new t.ColorTransformShader(e),this.glowShader=new t.GlowShader(e),this.blurShader=new t.BlurShader(e),this.primitiveShader.init(),this.defaultShader.init(),this.colorTransformShader.init(),this.blurShader.init(),this.glowShader.init()},i.activateShader=function(e,t){this.currentShader!=e&&(this.gl.useProgram(e.program),this.setAttribs(e.attributes),e.setAttribPointer(t),this.currentShader=e)},i.setAttribs=function(e){var t,r;for(r=this.tempAttribState.length,t=0;r>t;t++)this.tempAttribState[t]=!1;for(r=e.length,t=0;r>t;t++){var i=e[t];this.tempAttribState[i]=!0}var a=this.gl;for(r=this.attribState.length,t=0;r>t;t++)this.attribState[t]!==this.tempAttribState[t]&&(this.attribState[t]=this.tempAttribState[t],this.tempAttribState[t]?a.enableVertexAttribArray(t):a.disableVertexAttribArray(t))},e}();t.WebGLShaderManager=r,e.registerClass(r,"egret.native2.WebGLShaderManager")}(t=e.native2||(e.native2={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var r=function(){function t(){}var r=(__define,t);r.prototype;return t.compileProgram=function(r,i,a){var n=t.compileFragmentShader(r,a),s=t.compileVertexShader(r,i),o=r.createProgram();return r.attachShader(o,s),r.attachShader(o,n),r.linkProgram(o),r.getProgramParameter(o,r.LINK_STATUS)||e.$warn(1020),o},t.compileFragmentShader=function(e,r){return t._compileShader(e,r,e.FRAGMENT_SHADER)},t.compileVertexShader=function(e,r){return t._compileShader(e,r,e.VERTEX_SHADER)},t._compileShader=function(e,t,r){var i=e.createShader(r);return e.shaderSource(i,t),e.compileShader(i),e.getShaderParameter(i,e.COMPILE_STATUS)?i:null},t.checkCanUseWebGL=function(){if(void 0==t.canUseWebGL)try{var e=document.createElement("canvas");t.canUseWebGL=!(!window.WebGLRenderingContext||!e.getContext("webgl")&&!e.getContext("experimental-webgl"))}catch(r){t.canUseWebGL=!1}return t.canUseWebGL},t.deleteWebGLTexture=function(e){if(e){var t=e.glContext;t&&t.deleteTexture(e)}},t}();t.WebGLUtils=r,e.registerClass(r,"egret.native2.WebGLUtils"),e.WebGLUtils=r}(t=e.native2||(e.native2={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var r=function(){function e(){this.size=2e3,this.vertexMaxSize=4*this.size,this.indicesMaxSize=6*this.size,this.vertSize=5,this.vertices=null,this.indices=null,this.indicesForMesh=null,this.vertexIndex=0,this.indexIndex=0,this.hasMesh=!1;var e=this.vertexMaxSize*this.vertSize,t=this.indicesMaxSize;this.vertices=new Float32Array(e),this.indices=new Uint16Array(t),this.indicesForMesh=new Uint16Array(t);for(var r=0,i=0;t>r;r+=6,i+=4)this.indices[r+0]=i+0,this.indices[r+1]=i+1,this.indices[r+2]=i+2,this.indices[r+3]=i+0,this.indices[r+4]=i+2,this.indices[r+5]=i+3}var t=(__define,e),r=t.prototype;return r.reachMaxSize=function(e,t){return void 0===e&&(e=4),void 0===t&&(t=6),this.vertexIndex>this.vertexMaxSize-e||this.indexIndex>this.indicesMaxSize-t},r.getVertices=function(){var e=this.vertices.subarray(0,this.vertexIndex*this.vertSize);return e},r.getIndices=function(){return this.indices},r.getMeshIndices=function(){return this.indicesForMesh},r.changeToMeshIndices=function(){if(!this.hasMesh){for(var e=0,t=this.indexIndex;t>e;++e)this.indicesForMesh[e]=this.indices[e];this.hasMesh=!0}},r.isMesh=function(){return this.hasMesh},r.cacheArrays=function(e,t,r,i,a,n,s,o,h,u,c,l,d,f,v){var g=e,p=g.a,x=g.b,m=g.c,b=g.d,y=g.tx,T=g.ty;(0!=s||0!=o)&&g.append(1,0,0,1,s,o),(a/h!=1||n/u!=1)&&g.append(h/a,0,0,u/n,0,0);var w=g.a,S=g.b,E=g.c,R=g.d,_=g.tx,C=g.ty;if(g.a=p,g.b=x,g.c=m,g.d=b,g.tx=y,g.ty=T,f){var L=this.vertices,D=this.vertexIndex*this.vertSize,$=0,F=0,M=0,A=0,B=0,O=0,P=0;for($=0,M=d.length;M>$;$+=2)F=5*$/2,O=f[$],P=f[$+1],A=d[$],B=d[$+1],L[D+F+0]=w*O+E*P+_,L[D+F+1]=S*O+R*P+C,L[D+F+2]=(r+A*a)/c,L[D+F+3]=(i+B*n)/l,L[D+F+4]=t;if(this.hasMesh)for(var $=0,M=v.length;M>$;++$)this.indicesForMesh[this.indexIndex+$]=v[$]+this.vertexIndex;this.vertexIndex+=d.length/2,this.indexIndex+=v.length}else{var I=c,G=l,N=a,W=n;r/=I,i/=G,a/=I,n/=G;var L=this.vertices,D=this.vertexIndex*this.vertSize;if(L[D++]=_,L[D++]=C,L[D++]=r,L[D++]=i,L[D++]=t,L[D++]=w*N+_,L[D++]=S*N+C,L[D++]=a+r,L[D++]=i,L[D++]=t,L[D++]=w*N+E*W+_,L[D++]=R*W+S*N+C,L[D++]=a+r,L[D++]=n+i,L[D++]=t,L[D++]=E*W+_,L[D++]=R*W+C,L[D++]=r,L[D++]=n+i,L[D++]=t,this.hasMesh){var k=this.indicesForMesh;k[this.indexIndex+0]=0+this.vertexIndex,k[this.indexIndex+1]=1+this.vertexIndex,k[this.indexIndex+2]=2+this.vertexIndex,k[this.indexIndex+3]=0+this.vertexIndex,k[this.indexIndex+4]=2+this.vertexIndex,k[this.indexIndex+5]=3+this.vertexIndex}this.vertexIndex+=4,this.indexIndex+=6}},r.clear=function(){this.hasMesh=!1,this.vertexIndex=0,this.indexIndex=0},e}();t.WebGLVertexArrayObject=r,e.registerClass(r,"egret.native2.WebGLVertexArrayObject")}(t=e.native2||(e.native2={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var r=function(){function e(e){this.defaultVertexSrc="attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec2 aColor;\nuniform vec2 projectionVector;\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nconst vec2 center = vec2(-1.0, 1.0);\nvoid main(void) {\n   gl_Position = vec4( (aVertexPosition / projectionVector) + center , 0.0, 1.0);\n   vTextureCoord = aTextureCoord;\n   vColor = vec4(aColor.x, aColor.x, aColor.x, aColor.x);\n}",this.fragmentSrc="",this.gl=null,this.program=null,this.uniforms={projectionVector:{type:"2f",value:{x:0,y:0},dirty:!0}},this.gl=e}var r=(__define,e),i=r.prototype;return i.init=function(){var e=this.gl,r=t.WebGLUtils.compileProgram(e,this.defaultVertexSrc,this.fragmentSrc);e.useProgram(r),this.aVertexPosition=e.getAttribLocation(r,"aVertexPosition"),this.aTextureCoord=e.getAttribLocation(r,"aTextureCoord"),this.colorAttribute=e.getAttribLocation(r,"aColor"),-1===this.colorAttribute&&(this.colorAttribute=2),this.attributes=[this.aVertexPosition,this.aTextureCoord,this.colorAttribute];for(var i in this.uniforms)this.uniforms[i].uniformLocation=e.getUniformLocation(r,i);this.initUniforms(),this.program=r},i.initUniforms=function(){if(this.uniforms){var e,t=this.gl;for(var r in this.uniforms){e=this.uniforms[r],e.dirty=!0;var i=e.type;"mat2"===i||"mat3"===i||"mat4"===i?(e.glMatrix=!0,e.glValueLength=1,"mat2"===i?e.glFunc=t.uniformMatrix2fv:"mat3"===i?e.glFunc=t.uniformMatrix3fv:"mat4"===i&&(e.glFunc=t.uniformMatrix4fv)):(e.glFunc=t["uniform"+i],"2f"===i||"2i"===i?e.glValueLength=2:"3f"===i||"3i"===i?e.glValueLength=3:"4f"===i||"4i"===i?e.glValueLength=4:e.glValueLength=1)}}},i.syncUniforms=function(){if(this.uniforms){var e,t=this.gl;for(var r in this.uniforms)e=this.uniforms[r],e.dirty&&(1===e.glValueLength?e.glMatrix===!0?e.glFunc.call(t,e.uniformLocation,e.transpose,e.value):e.glFunc.call(t,e.uniformLocation,e.value):2===e.glValueLength?e.glFunc.call(t,e.uniformLocation,e.value.x,e.value.y):3===e.glValueLength?e.glFunc.call(t,e.uniformLocation,e.value.x,e.value.y,e.value.z):4===e.glValueLength&&e.glFunc.call(t,e.uniformLocation,e.value.x,e.value.y,e.value.z,e.value.w),e.dirty=!1)}},i.setProjection=function(e,t){var r=this.uniforms.projectionVector;(r.value.x!=e||r.value.y!=t)&&(r.value.x=e,r.value.y=t,r.dirty=!0)},i.setAttribPointer=function(e){var t=this.gl;t.vertexAttribPointer(this.aVertexPosition,2,t.FLOAT,!1,e,0),t.vertexAttribPointer(this.aTextureCoord,2,t.FLOAT,!1,e,8),t.vertexAttribPointer(this.colorAttribute,1,t.FLOAT,!1,e,16)},e}();t.EgretShader=r,e.registerClass(r,"egret.native2.EgretShader")}(t=e.native2||(e.native2={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var r=function(e){function t(){e.apply(this,arguments),this.fragmentSrc="precision lowp float;\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nuniform sampler2D uSampler;\nvoid main(void) {\ngl_FragColor = texture2D(uSampler, vTextureCoord) * vColor;\n}"}__extends(t,e);var r=(__define,t);r.prototype;return t}(t.EgretShader);t.TextureShader=r,e.registerClass(r,"egret.native2.TextureShader")}(t=e.native2||(e.native2={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var r=function(e){function t(){e.apply(this,arguments),this.fragmentSrc="precision mediump float;uniform vec2 blur;uniform sampler2D uSampler;varying vec2 vTextureCoord;uniform vec2 uTextureSize;void main(){const int sampleRadius = 5;const int samples = sampleRadius * 2 + 1;vec2 blurUv = blur / uTextureSize;vec4 color = vec4(0, 0, 0, 0);vec2 uv = vec2(0.0, 0.0);blurUv /= float(sampleRadius);for (int i = -sampleRadius; i <= sampleRadius; i++) {uv.x = vTextureCoord.x + float(i) * blurUv.x;uv.y = vTextureCoord.y + float(i) * blurUv.y;color += texture2D(uSampler, uv);}color /= float(samples);gl_FragColor = color;}",this.uniforms={projectionVector:{type:"2f",value:{x:0,y:0},dirty:!0},blur:{type:"2f",value:{x:2,y:2},dirty:!0},uTextureSize:{type:"2f",value:{x:100,y:100},dirty:!0}}}__extends(t,e);var r=(__define,t),i=r.prototype;return i.setBlur=function(e,t){var r=this.uniforms.blur;(r.value.x!=e||r.value.y!=t)&&(r.value.x=e,r.value.y=t,r.dirty=!0)},i.setTextureSize=function(e,t){var r=this.uniforms.uTextureSize;(e!=r.value.x||t!=r.value.y)&&(r.value.x=e,r.value.y=t,r.dirty=!0)},t}(t.TextureShader);t.BlurShader=r,e.registerClass(r,"egret.native2.BlurShader")}(t=e.native2||(e.native2={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var r=function(e){function t(){e.apply(this,arguments),this.fragmentSrc="precision mediump float;\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nuniform mat4 matrix;\nuniform vec4 colorAdd;\nuniform sampler2D uSampler;\nvoid main(void) {\nvec4 texColor = texture2D(uSampler, vTextureCoord);\nif(texColor.a > 0.) {texColor = vec4(texColor.rgb / texColor.a, texColor.a);\n}vec4 locColor = clamp(texColor * matrix + colorAdd, 0., 1.);\ngl_FragColor = vColor * vec4(locColor.rgb * locColor.a, locColor.a);\n}",this.uniforms={projectionVector:{type:"2f",value:{x:0,y:0},dirty:!0},matrix:{type:"mat4",value:new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),dirty:!0},colorAdd:{type:"4f",value:{x:0,y:0,z:0,w:0},dirty:!0}}}__extends(t,e);var r=(__define,t),i=r.prototype;return i.setMatrix=function(e){var t=this.uniforms.matrix;(t.value[0]!=e[0]||t.value[0]!=e[0]||t.value[1]!=e[1]||t.value[2]!=e[2]||t.value[3]!=e[3]||t.value[4]!=e[5]||t.value[5]!=e[6]||t.value[6]!=e[7]||t.value[7]!=e[8]||t.value[8]!=e[10]||t.value[9]!=e[11]||t.value[10]!=e[12]||t.value[11]!=e[13]||t.value[12]!=e[15]||t.value[13]!=e[16]||t.value[14]!=e[17]||t.value[15]!=e[18])&&(t.value[0]=e[0],t.value[1]=e[1],t.value[2]=e[2],t.value[3]=e[3],t.value[4]=e[5],t.value[5]=e[6],t.value[6]=e[7],t.value[7]=e[8],t.value[8]=e[10],t.value[9]=e[11],t.value[10]=e[12],t.value[11]=e[13],t.value[12]=e[15],t.value[13]=e[16],t.value[14]=e[17],t.value[15]=e[18],t.dirty=!0);var r=this.uniforms.colorAdd;(r.value.x!=e[4]/255||r.value.y!=e[9]/255||r.value.z!=e[14]/255||r.value.w!=e[19]/255)&&(r.value.x=e[4]/255,r.value.y=e[9]/255,r.value.z=e[14]/255,r.value.w=e[19]/255,r.dirty=!0)},t}(t.TextureShader);t.ColorTransformShader=r,e.registerClass(r,"egret.native2.ColorTransformShader")}(t=e.native2||(e.native2={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var r=function(e){function t(){e.apply(this,arguments),this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","uniform sampler2D uSampler;","uniform float distance;","uniform float angle;","uniform vec4 color;","uniform float alpha;","uniform float blurX;","uniform float blurY;","uniform float strength;","uniform float inner;","uniform float knockout;","uniform float hideObject;","uniform vec2 uTextureSize;vec2 px = vec2(1.0 / uTextureSize.x, 1.0 / uTextureSize.y);","float random(vec3 scale, float seed)","{","return fract(sin(dot(gl_FragCoord.xyz + seed, scale)) * 43758.5453 + seed);","}","void main(void) {","const float linearSamplingTimes = 7.0;","const float circleSamplingTimes = 12.0;","vec4 ownColor = texture2D(uSampler, vTextureCoord);","vec4 curColor;","float totalAlpha = 0.0;","float maxTotalAlpha = 0.0;","float curDistanceX = 0.0;","float curDistanceY = 0.0;","float offsetX = distance * cos(angle) * px.x;","float offsetY = distance * sin(angle) * px.y;","const float PI = 3.14159265358979323846264;","float cosAngle;","float sinAngle;","float offset = PI * 2.0 / circleSamplingTimes * random(vec3(12.9898, 78.233, 151.7182), 0.0);","float stepX = blurX * px.x / linearSamplingTimes;","float stepY = blurY * px.y / linearSamplingTimes;","for (float a = 0.0; a <= PI * 2.0; a += PI * 2.0 / circleSamplingTimes) {","cosAngle = cos(a + offset);","sinAngle = sin(a + offset);","for (float i = 1.0; i <= linearSamplingTimes; i++) {","curDistanceX = i * stepX * cosAngle;","curDistanceY = i * stepY * sinAngle;","curColor = texture2D(uSampler, vec2(vTextureCoord.x + curDistanceX - offsetX, vTextureCoord.y + curDistanceY + offsetY));","totalAlpha += (linearSamplingTimes - i) * curColor.a;","maxTotalAlpha += (linearSamplingTimes - i);","}","}","ownColor.a = max(ownColor.a, 0.0001);","ownColor.rgb = ownColor.rgb / ownColor.a;","float outerGlowAlpha = (totalAlpha / maxTotalAlpha) * strength * alpha * (1. - inner) * max(min(hideObject, knockout), 1. - ownColor.a);","float innerGlowAlpha = ((maxTotalAlpha - totalAlpha) / maxTotalAlpha) * strength * alpha * inner * ownColor.a;","ownColor.a = max(ownColor.a * knockout * (1. - hideObject), 0.0001);","vec3 mix1 = mix(ownColor.rgb, color.rgb, innerGlowAlpha / (innerGlowAlpha + ownColor.a));","vec3 mix2 = mix(mix1, color.rgb, outerGlowAlpha / (innerGlowAlpha + ownColor.a + outerGlowAlpha));","float resultAlpha = min(ownColor.a + outerGlowAlpha + innerGlowAlpha, 1.);","gl_FragColor = vec4(mix2 * resultAlpha, resultAlpha);","}"].join("\n"),this.uniforms={projectionVector:{type:"2f",value:{x:0,y:0},dirty:!0},distance:{type:"1f",value:15,dirty:!0},angle:{type:"1f",value:1,dirty:!0},color:{type:"4f",value:{x:1,y:0,z:0,w:0},dirty:!0},alpha:{type:"1f",value:1,dirty:!0},blurX:{type:"1f",value:1,dirty:!0},blurY:{type:"1f",value:1,dirty:!0},strength:{type:"1f",value:1,dirty:!0},inner:{type:"1f",value:1,dirty:!0},knockout:{type:"1f",value:1,dirty:!0},hideObject:{type:"1f",value:0,dirty:!0},uTextureSize:{type:"2f",value:{x:100,y:100},dirty:!0}}}__extends(t,e);var r=(__define,t),i=r.prototype;return i.setDistance=function(e){var t=this.uniforms.distance;t.value!=e&&(t.value=e,t.dirty=!0)},i.setAngle=function(e){var t=this.uniforms.angle;t.value!=e&&(t.value=e,t.dirty=!0)},i.setColor=function(e,t,r){var i=this.uniforms.color;(i.value.x!=e||i.value.y!=t||i.value.z!=r)&&(i.value.x=e,i.value.y=t,i.value.z=r,i.dirty=!0)},i.setAlpha=function(e){var t=this.uniforms.alpha;t.value!=e&&(t.value=e,t.dirty=!0)},i.setBlurX=function(e){var t=this.uniforms.blurX;t.value!=e&&(t.value=e,t.dirty=!0)},i.setBlurY=function(e){var t=this.uniforms.blurY;t.value!=e&&(t.value=e,t.dirty=!0)},i.setStrength=function(e){var t=this.uniforms.strength;t.value!=e&&(t.value=e,t.dirty=!0)},i.setInner=function(e){var t=this.uniforms.inner;t.value!=e&&(t.value=e,t.dirty=!0)},i.setKnockout=function(e){var t=this.uniforms.knockout;t.value!=e&&(t.value=e,t.dirty=!0)},i.setHideObject=function(e){var t=this.uniforms.hideObject;t.value!=e&&(t.value=e,t.dirty=!0)},i.setTextureSize=function(e,t){var r=this.uniforms.uTextureSize;(e!=r.value.x||t!=r.value.y)&&(r.value.x=e,r.value.y=t,r.dirty=!0)},t}(t.TextureShader);t.GlowShader=r,e.registerClass(r,"egret.native2.GlowShader")}(t=e.native2||(e.native2={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var r=function(e){function t(){e.apply(this,arguments),this.fragmentSrc="precision lowp float;\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nvoid main(void) {\ngl_FragColor = vColor;\n}"}__extends(t,e);var r=(__define,t);r.prototype;return t}(t.EgretShader);t.PrimitiveShader=r,e.registerClass(r,"egret.native2.PrimitiveShader")}(t=e.native2||(e.native2={}))}(egret||(egret={}));