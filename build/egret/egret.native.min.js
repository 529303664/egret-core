var __reflect=this&&this.__reflect||function(e,t,r){e.__class__=t,r?r.push(t):r=[t],e.__types__=e.__types__?r.concat(e.__types__):r},__extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},egret;!function(e){var t;!function(e){var t=function(){function t(e){this.defaultVertexSrc="attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec2 aColor;\nuniform vec2 projectionVector;\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nconst vec2 center = vec2(-1.0, 1.0);\nvoid main(void) {\n   gl_Position = vec4( (aVertexPosition / projectionVector) + center , 0.0, 1.0);\n   vTextureCoord = aTextureCoord;\n   vColor = vec4(aColor.x, aColor.x, aColor.x, aColor.x);\n}",this.fragmentSrc="",this.gl=null,this.program=null,this.uniforms={projectionVector:{type:"2f",value:{x:0,y:0},dirty:!0}},this.gl=e}return t.prototype.init=function(){var t=this.gl,r=e.WebGLUtils.compileProgram(t,this.defaultVertexSrc,this.fragmentSrc);t.useProgram(r),this.aVertexPosition=t.getAttribLocation(r,"aVertexPosition"),this.aTextureCoord=t.getAttribLocation(r,"aTextureCoord"),this.colorAttribute=t.getAttribLocation(r,"aColor"),-1===this.colorAttribute&&(this.colorAttribute=2),this.attributes=[this.aVertexPosition,this.aTextureCoord,this.colorAttribute];for(var i in this.uniforms)this.uniforms[i].uniformLocation=t.getUniformLocation(r,i);this.initUniforms(),this.program=r},t.prototype.initUniforms=function(){if(this.uniforms){var e,t=this.gl;for(var r in this.uniforms){e=this.uniforms[r],e.dirty=!0;var i=e.type;"mat2"===i||"mat3"===i||"mat4"===i?(e.glMatrix=!0,e.glValueLength=1,"mat2"===i?e.glFunc=t.uniformMatrix2fv:"mat3"===i?e.glFunc=t.uniformMatrix3fv:"mat4"===i&&(e.glFunc=t.uniformMatrix4fv)):(e.glFunc=t["uniform"+i],"2f"===i||"2i"===i?e.glValueLength=2:"3f"===i||"3i"===i?e.glValueLength=3:"4f"===i||"4i"===i?e.glValueLength=4:e.glValueLength=1)}}},t.prototype.syncUniforms=function(){if(this.uniforms){var e,t=this.gl;for(var r in this.uniforms)e=this.uniforms[r],e.dirty&&(1===e.glValueLength?e.glMatrix===!0?e.glFunc.call(t,e.uniformLocation,e.transpose,e.value):e.glFunc.call(t,e.uniformLocation,e.value):2===e.glValueLength?e.glFunc.call(t,e.uniformLocation,e.value.x,e.value.y):3===e.glValueLength?e.glFunc.call(t,e.uniformLocation,e.value.x,e.value.y,e.value.z):4===e.glValueLength&&e.glFunc.call(t,e.uniformLocation,e.value.x,e.value.y,e.value.z,e.value.w),e.dirty=!1)}},t.prototype.setProjection=function(e,t){var r=this.uniforms.projectionVector;(r.value.x!=e||r.value.y!=t)&&(r.value.x=e,r.value.y=t,r.dirty=!0)},t.prototype.setAttribPointer=function(e){var t=this.gl;t.vertexAttribPointer(this.aVertexPosition,2,t.FLOAT,!1,e,0),t.vertexAttribPointer(this.aTextureCoord,2,t.FLOAT,!1,e,8),t.vertexAttribPointer(this.colorAttribute,1,t.FLOAT,!1,e,16)},t}();e.EgretShader=t,__reflect(t.prototype,"egret.native2.EgretShader")}(t=e.native2||(e.native2={}))}(egret||(egret={}));var egret;!function(e){var t;!function(e){var t=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.fragmentSrc="precision lowp float;\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nuniform sampler2D uSampler;\nvoid main(void) {\ngl_FragColor = texture2D(uSampler, vTextureCoord) * vColor;\n}",t}return __extends(t,e),t}(e.EgretShader);e.TextureShader=t,__reflect(t.prototype,"egret.native2.TextureShader")}(t=e.native2||(e.native2={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var r=function(t){function r(){var e=t.call(this)||this;return e.textValue="",e.colorValue=16777215,e.isFinishDown=!1,e.textValue="",e}return __extends(r,t),r.prototype.$getText=function(){return this.textValue||(this.textValue=""),this.textValue},r.prototype.$setText=function(e){return this.textValue=e,!0},r.prototype.$setColor=function(e){return this.colorValue=e,!0},r.prototype.$onBlur=function(){},r.prototype.showScreenKeyboard=function(){var t=this;t.dispatchEvent(new e.Event("focus")),e.Event.dispatchEvent(t,"focus",!1,{showing:!0}),egret_native.EGT_TextInput=function(r){t.$textfield.multiline?(t.textValue=r,t.dispatchEvent(new e.Event("updateText")),t.isFinishDown&&(t.isFinishDown=!1,t.dispatchEvent(new e.Event("blur")))):(t.textValue=r.replace(/[\n|\r]/,""),egret_native.TextInputOp.setKeybordOpen(!1),t.dispatchEvent(new e.Event("updateText")),t.dispatchEvent(new e.Event("blur")))},egret_native.EGT_keyboardFinish=function(){t.$textfield.multiline&&(t.isFinishDown=!0)}},r.prototype.$show=function(){var t=this,r=this.$textfield,i=r.$TextField;egret_native.TextInputOp.setKeybordOpen(!1),egret_native.EGT_getTextEditerContentText=function(){return t.$getText()},egret_native.EGT_keyboardDidShow=function(){t.showScreenKeyboard(),egret_native.EGT_keyboardDidShow=function(){},egret_native.TextInputOp.updateConfig&&egret_native.TextInputOp.updateConfig(JSON.stringify({font_color:i[2]}))},egret_native.EGT_keyboardDidHide=function(){},egret_native.EGT_deleteBackward=function(){};var n=i[37],a=i[30]?0:6,o=-1;n==e.TextFieldInputType.PASSWORD?o=0:n==e.TextFieldInputType.TEL&&(a=3);var s=1,u=i[21]<=0?-1:i[21],h=(r.$getRenderNode(),this.$textfield.localToGlobal(0,0));egret_native.TextInputOp.setKeybordOpen(!0,JSON.stringify({inputMode:a,inputFlag:o,returnType:s,maxLength:u,x:h.x,y:h.y,width:r.width,height:r.height,font_size:i[0],font_color:i[2],textAlign:i[9],verticalAlign:i[10]}))},r.prototype.$hide=function(){egret_native.TextInputOp.setKeybordOpen(!1),this.dispatchEvent(new e.Event("blur"))},r.prototype.$resetStageText=function(){},r.prototype.$addToStage=function(){},r.prototype.$removeFromStage=function(){},r.prototype.$setTextField=function(e){return this.$textfield=e,!0},r}(e.EventDispatcher);t.NativeStageText=r,__reflect(r.prototype,"egret.native2.NativeStageText",["egret.StageText"]),e.StageText=r}(t=e.native2||(e.native2={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var r=function(r){function i(){var e=r.call(this)||this;return e.init(i.option),e}return __extends(i,r),i.prototype.init=function(r){r.showPaintRect=!1;var i=new e.Stage;i.$screen=this,i.$scaleMode=r.scaleMode,i.$maxTouches=r.maxTouches,i.textureScaleFactor=r.textureScaleFactor,i.frameRate=r.frameRate;var n=new e.sys.RenderBuffer(void 0,void 0,!0),a=n.surface;this.attachCanvas(a);var o=new t.NativeTouchHandler(i),s=new e.sys.Player(n,i,r.entryClassName);if(new t.NativeHideHandler(i),s.showPaintRect(r.showPaintRect),r.showFPS||r.showLog){for(var u=r.fpsStyles||"",h=u.split(","),l={},c=0;c<h.length;c++){var d=h[c].split(":");l[d[0]]=d[1]}r.fpsStyles=l,s.displayFPS(r.showFPS,r.showLog,r.logFilter,r.fpsStyles)}this.playerOption=r,this.$stage=i,this.player=s,this.nativeTouch=o,this.updateScreenSize(),this.updateMaxTouches(),s.start()},i.prototype.updateScreenSize=function(){var t=this.playerOption,r=egret_native.getDeviceWidth(),i=egret_native.getDeviceHeight();e.Capabilities.$boundingClientWidth=r,e.Capabilities.$boundingClientHeight=i;var n=e.sys.screenAdapter.calculateStageSize(this.$stage.$scaleMode,r,i,t.contentWidth,t.contentHeight),a=n.stageWidth,o=n.stageHeight,s=n.displayWidth,u=n.displayHeight,h=(i-u)/2,l=(r-s)/2;egret_native.setVisibleRect(l,h,s,u),egret_native.setDesignSize(a,o),this.player.updateStageSize(a,o)},i.prototype.setContentSize=function(e,t){var r=this.playerOption;r.contentWidth=e,r.contentHeight=t,this.updateScreenSize()},i.prototype.attachCanvas=function(e){egret_native.setScreenCanvas(e)},i.prototype.updateMaxTouches=function(){this.nativeTouch.$updateMaxTouches()},i}(e.HashObject);t.NativePlayer=r,__reflect(r.prototype,"egret.native2.NativePlayer",["egret.sys.Screen"])}(t=e.native2||(e.native2={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var r=function(t){function r(){var e=null!==t&&t.apply(this,arguments)||this;return e._downCount=0,e._path=null,e._bytesTotal=0,e}return __extends(r,t),r.prototype.load=function(e,t){this._downCount=0,this._path=e,this._bytesTotal=t,this.reload()},r.prototype.reload=function(){if(this._downCount>=3)return void this.downloadFileError();this._downCount++;var t=e.PromiseObject.create(),r=this;t.onSuccessFunc=function(){r.loadOver()},t.onErrorFunc=function(){r.reload()},t.downloadingSizeFunc=function(e){r.downloadingProgress(e)},egret_native.download(this._path,this._path,t)},r.prototype.downloadingProgress=function(t){e.ProgressEvent.dispatchProgressEvent(this,e.ProgressEvent.PROGRESS,t,this._bytesTotal)},r.prototype.downloadFileError=function(){this.dispatchEvent(new e.Event(e.IOErrorEvent.IO_ERROR))},r.prototype.loadOver=function(){this.dispatchEvent(new e.Event(e.Event.COMPLETE))},r}(e.EventDispatcher);t.NativeResourceLoader=r,__reflect(r.prototype,"egret.native2.NativeResourceLoader"),e.NativeResourceLoader=r}(t=e.native2||(e.native2={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){function r(t,r){var i=e.sys.canvasHitTestBuffer,n=i.surface;return n}function i(t,i){try{var n=r(this,i),a=n.toDataURL(t);return a}catch(o){return e.$error(1033),null}}function n(t,i,n){try{var a=r(this,n);a.saveToFile(t,i)}catch(o){e.$error(1033)}}function a(t,r){return e.$error(1035),null}e.Texture.prototype.toDataURL=i,e.Texture.prototype.saveToFile=n,e.Texture.prototype.getPixel32=a}(t=e.native2||(e.native2={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var r=function(t){function r(r){var i=t.call(this)||this;i.$touch=new e.sys.TouchHandler(r);var n=i;return egret_native.touchDown=function(e,t,r,i){n.$executeTouchCallback(e,t,r,i,n.$touch.onTouchBegin)},egret_native.touchMove=function(e,t,r,i){n.$executeTouchCallback(e,t,r,i,n.$touch.onTouchMove)},egret_native.touchUp=function(e,t,r,i){n.$executeTouchCallback(e,t,r,i,n.$touch.onTouchEnd)},egret_native.touchCancel=function(e,t,r,i){},i}return __extends(r,t),r.prototype.$executeTouchCallback=function(e,t,r,i,n){for(var a=0;e>a;a++){var o=t[a],s=r[a],u=i[a];n.call(this.$touch,s,u,o)}},r.prototype.$updateMaxTouches=function(){this.$touch.$initMaxTouches()},r}(e.HashObject);t.NativeTouchHandler=r,__reflect(r.prototype,"egret.native2.NativeTouchHandler")}(t=e.native2||(e.native2={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){function r(e){var t=egret_native.xmlStr2JsonStr(e);t=t.replace(/\n/g,"\\n");var r=JSON.parse(t);return i(r,null)}function i(e,t){if("parsererror"==e.localName)throw new Error(e.textContent);var r=new a(e.localName,t,e.prefix,e.namespace,e.name),n=e.attributes,s=r.attributes;for(var u in n)s[u]=r["$"+u]=n[u];for(var h=e.children,l=h.length,c=r.children,d=0;l>d;d++){var p=h[d],f=p.nodeType,v=null;if(1==f)v=i(p,r);else if(3==f){var g=p.text.trim();g&&(v=new o(g,r))}v&&c.push(v)}return r}var n=function(){function e(e,t){this.nodeType=e,this.parent=t}return e}();t.XMLNode=n,__reflect(n.prototype,"egret.native2.XMLNode");var a=function(e){function t(t,r,i,n,a){var o=e.call(this,1,r)||this;return o.attributes={},o.children=[],o.localName=t,o.prefix=i,o.namespace=n,o.name=a,o}return __extends(t,e),t}(n);t.XML=a,__reflect(a.prototype,"egret.native2.XML");var o=function(e){function t(t,r){var i=e.call(this,3,r)||this;return i.text=t,i}return __extends(t,e),t}(n);t.XMLText=o,__reflect(o.prototype,"egret.native2.XMLText"),e.XML={parse:r}}(t=e.native2||(e.native2={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var r=function(){function t(){this.onSuccessFunc=null,this.onSuccessThisObject=null,this.onErrorFunc=null,this.onErrorThisObject=null,this.downloadingSizeFunc=null,this.downloadingSizeThisObject=null,this.onResponseHeaderFunc=null,this.onResponseHeaderThisObject=null}return t.create=function(){return t.promiseObjectList.length?t.promiseObjectList.pop():new e.PromiseObject},t.prototype.onSuccess=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.onSuccessFunc&&this.onSuccessFunc.apply(this.onSuccessThisObject,e),this.destroy()},t.prototype.onError=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.onErrorFunc&&this.onErrorFunc.apply(this.onErrorThisObject,e),this.destroy()},t.prototype.downloadingSize=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.downloadingSizeFunc&&this.downloadingSizeFunc.apply(this.downloadingSizeThisObject,e)},t.prototype.onResponseHeader=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.onResponseHeaderFunc&&this.onResponseHeaderFunc.apply(this.onResponseHeaderThisObject,e)},t.prototype.destroy=function(){this.onSuccessFunc=void 0,this.onSuccessThisObject=void 0,this.onErrorFunc=void 0,this.onErrorThisObject=void 0,this.downloadingSizeFunc=void 0,this.downloadingSizeThisObject=void 0,this.onResponseHeaderFunc=void 0,this.onResponseHeaderThisObject=void 0,t.promiseObjectList.push(this)},t}();r.promiseObjectList=[],t.PromiseObject=r,__reflect(r.prototype,"egret.native2.PromiseObject"),e.PromiseObject=r}(t=e.native2||(e.native2={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){function r(t){var r=JSON.parse(t),n=r.functionName,a=i[n];if(a){var o=r.value;a.call(null,o)}else e.$warn(1050,n)}var i={},n=function(){function e(){}return e.call=function(e,t){var r={};r.functionName=e,r.value=t,egret_native.sendInfoToPlugin(JSON.stringify(r))},e.addCallback=function(e,t){i[e]=t},e}();t.NativeExternalInterface=n,__reflect(n.prototype,"egret.native2.NativeExternalInterface",["egret.ExternalInterface"]),e.ExternalInterface=n,egret_native.receivedPluginInfo=r}(t=e.native2||(e.native2={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var r;!function(r){function i(e){return h[e]}function n(t,r){r=void 0===r?"undefined":null===r?"null":r.toString(),h[t]=r;try{return s(),!0}catch(i){return e.$warn(1018,t,r),!1}}function a(e){delete h[e],s()}function o(){for(var e in h)delete h[e];s()}function s(){}var u="LocalStorage.local",h={};if(egret_native.isRecordExists(u)){var l=egret_native.loadRecord(u);try{h=JSON.parse(l)}catch(c){h={}}}else h={};t.getItem=i,t.setItem=n,t.removeItem=a,t.clear=o}(r=t.native2||(t.native2={}))}(t=e.localStorage||(e.localStorage={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var r=function(r){function i(){var e=r.call(this)||this;return e.loaded=!1,e}return __extends(i,r),Object.defineProperty(i.prototype,"length",{get:function(){throw new Error("sound length not supported")},enumerable:!0,configurable:!0}),i.prototype.load=function(r){function i(){var i=t.PromiseObject.create();i.onSuccessFunc=n,i.onErrorFunc=function(){e.IOErrorEvent.dispatchIOErrorEvent(a)},egret_native.download(r,r,i)}function n(){a.loaded=!0,a.preload()}var a=this;this.url=r,egret_native.isFileExists(r)?__global.setTimeout?__global.setTimeout(n,0):e.$callAsync(n,a):i()},i.prototype.preload=function(){var t=this;if(t.type==e.Sound.EFFECT){var r=new e.PromiseObject;r.onSuccessFunc=function(r){t.dispatchEventWith(e.Event.COMPLETE)},egret_native.Audio.preloadEffectAsync(t.url,r)}else t.dispatchEventWith(e.Event.COMPLETE)},i.prototype.play=function(r,i){r=+r||0,i=+i||0;var n=new t.NaSoundChannel;return n.$url=this.url,n.$loops=i,n.$type=this.type,n.$startTime=r,n.$play(),e.sys.$pushSoundChannel(n),n},i.prototype.close=function(){},i}(e.EventDispatcher);r.MUSIC="music",r.EFFECT="effect",t.NaSound=r,__reflect(r.prototype,"egret.native2.NaSound",["egret.Sound"]),__global.Audio||(e.Sound=r)}(t=e.native2||(e.native2={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var r=function(t){function r(){var e=t.call(this)||this;return e.$startTime=0,e.isStopped=!1,e._startTime=0,e}return __extends(r,t),r.prototype.$play=function(){this.isStopped=!1,this.$type==e.Sound.EFFECT?this._effectId=egret_native.Audio.playEffect(this.$url,1!=this.$loops):(r.currentPath=this.$url,egret_native.Audio.playBackgroundMusic(this.$url,1!=this.$loops)),this._startTime=Date.now()},r.prototype.stop=function(){this.isStopped||e.sys.$popSoundChannel(this),this.isStopped=!0,this.$type==e.Sound.EFFECT?this._effectId&&(egret_native.Audio.stopEffect(this._effectId),this._effectId=null):this.$url==r.currentPath&&egret_native.Audio.stopBackgroundMusic(!1)},Object.defineProperty(r.prototype,"volume",{get:function(){return this.$type==e.Sound.EFFECT?egret_native.Audio.getEffectsVolume():egret_native.Audio.getBackgroundMusicVolume()},set:function(t){this.$type==e.Sound.EFFECT?egret_native.Audio.setEffectsVolume(t):egret_native.Audio.setBackgroundMusicVolume(t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"position",{get:function(){return(Date.now()-this._startTime)/1e3},enumerable:!0,configurable:!0}),r}(e.EventDispatcher);t.NaSoundChannel=r,__reflect(r.prototype,"egret.native2.NaSoundChannel",["egret.SoundChannel","egret.IEventDispatcher"])}(t=e.native2||(e.native2={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var r=function(r){function i(){var e=r.call(this)||this;return e.loaded=!1,e}return __extends(i,r),Object.defineProperty(i.prototype,"length",{get:function(){if(this.originAudio)return this.originAudio.duration;throw new Error("sound not loaded!")},enumerable:!0,configurable:!0}),i.prototype.load=function(t){var r=this;return r.loaded=!0,void r.dispatchEventWith(e.Event.COMPLETE)},i.prototype.play=function(r,i){r=+r||0,i=+i||0;var n=new t.NativeSoundChannel(null);return n.$url=this.url,n.$loops=i,n.$startTime=r,n.$play(),e.sys.$pushSoundChannel(n),n},i.prototype.close=function(){0==this.loaded&&this.originAudio&&(this.originAudio.src=""),this.originAudio&&(this.originAudio=null),i.$clear(this.url)},i.$clear=function(e){var t=i.audios[e];t&&(t.length=0)},i.$pop=function(e){var t=i.audios[e];return t&&t.length>0?t.pop():null},i.$recycle=function(e,t){var r=i.audios[e];null==i.audios[e]&&(r=i.audios[e]=[]),r.push(t)},i}(e.EventDispatcher);r.MUSIC="music",r.EFFECT="effect",r.audios={},t.NativeSound=r,__reflect(r.prototype,"egret.native2.NativeSound",["egret.Sound"]),__global.Audio&&(e.Sound=r)}(t=e.native2||(e.native2={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var r=function(t){function r(r){var i=t.call(this)||this;return i.$startTime=0,i.audio=null,i.isStopped=!1,i.onPlayEnd=function(){return 1==i.$loops?(i.stop(),void i.dispatchEventWith(e.Event.SOUND_COMPLETE)):(i.$loops>0&&i.$loops--,void i.$play())},i.$volume=1,i}return __extends(r,t),r.prototype.$play=function(){},r.prototype.stop=function(){return},Object.defineProperty(r.prototype,"volume",{get:function(){return 1},set:function(e){},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"position",{get:function(){return 0},enumerable:!0,configurable:!0}),r}(e.EventDispatcher);t.NativeSoundChannel=r,__reflect(r.prototype,"egret.native2.NativeSoundChannel",["egret.SoundChannel","egret.IEventDispatcher"])}(t=e.native2||(e.native2={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var r=function(r){function i(t,i){void 0===i&&(i=!0);var n=r.call(this)||this;return n.loaded=!1,n.loading=!1,n.loop=!1,n.isPlayed=!1,n.firstPlay=!0,n.src="",n._fullscreen=!0,n._bitmapData=null,n.paused=!1,n.isAddToStage=!1,n.heightSet=0,n.widthSet=0,n.$renderNode=new e.sys.BitmapNode,n.cache=i,__global.Video||e.$error(1044),t&&n.load(t,i),n}return __extends(i,r),i.prototype.load=function(t,r){if(void 0===r&&(r=!0),!this.loading)if(0==t.indexOf("/")&&(t=t.slice(1,t.length)),this.src=t,this.loading=!0,this.loaded=!1,r&&!egret_native.isFileExists(t)){var i=this,n=e.PromiseObject.create();n.onSuccessFunc=function(){i.loadEnd()},n.onErrorFunc=function(){e.$warn(1048),i.dispatchEventWith(e.IOErrorEvent.IO_ERROR)},egret_native.download(t,t,n)}else this.loadEnd()},i.prototype.loadEnd=function(){function t(){a.setVideoRect(0,0,1,1),a.play()}function r(){a.setVideoRect(0,0,1,1),__global.setTimeout(function(){a.pause(),o._fullscreen&&(a.fullScreen=!0),a.currentTime=0,o.originVideo=a,o.loaded=!0,o.loading=!1,n(),o.dispatchEventWith(e.Event.COMPLETE),a.addEventListener("pause",function(){o.paused=!0}),a.addEventListener("playing",function(){o.paused=!1}),a.addEventListener("ended",function(){o.dispatchEventWith(e.Event.ENDED),o.loop&&o.play(0,!0)})},1)}function i(){n(),o.dispatchEventWith(e.IOErrorEvent.IO_ERROR)}function n(){a.removeEventListener("canplaythrough",t),a.removeEventListener("error",i),a.removeEventListener("playing",r)}var a=new __global.Video(this.src);a.setVideoRect(0,0,1,1),a.setKeepRatio(!1),a.addEventListener("canplaythrough",t),a.addEventListener("error",i),a.addEventListener("playing",r),a.load();var o=this},i.prototype.play=function(t,r){var i=this;if(void 0===r&&(r=!1),this.loop=r,!this.loaded)return this.load(this.src),void this.once(e.Event.COMPLETE,function(e){return i.play(t,r)},this);var n=!1;void 0!=t&&t!=this.originVideo.currentTime&&(this.originVideo.currentTime=t||0,n=!0),this.startPlay(n)},i.prototype.startPlay=function(t){void 0===t&&(t=!1),this.isAddToStage&&this.loaded&&(this.firstPlay=!1,this.setVideoSize(),this.isPlayed=!0,!t&&this.paused&&0!=this.position?this.originVideo.resume():this.originVideo.play(),e.startTick(this.markDirty,this))},i.prototype.stopPlay=function(){e.stopTick(this.markDirty,this),this.isPlayed&&(this.isPlayed=!1,this.originVideo.pause())},i.prototype.close=function(){this.originVideo&&this.originVideo.destroy(),this.loaded=!1,this.loading=!1,this.originVideo=null,this.loop=!1,this.src=null},Object.defineProperty(i.prototype,"poster",{get:function(){return this.posterUrl},set:function(r){var i=this;this.posterUrl=r;var n=new t.NativeImageLoader;n.load(r),n.addEventListener(e.Event.COMPLETE,function(){i.posterData=n.data,i.markDirty(),i.$invalidateContentBounds()},this)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"fullscreen",{get:function(){return this.originVideo?this.originVideo.fullScreen:this._fullscreen},set:function(e){this._fullscreen=e,this.originVideo&&(this.originVideo.fullScreen=e)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"volume",{get:function(){return this.loaded?this.originVideo.volume:0},set:function(e){this.loaded&&(this.originVideo.volume=e)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"position",{get:function(){return this.originVideo.currentTime},set:function(e){this.loaded&&(this.originVideo.currentTime=e)},enumerable:!0,configurable:!0}),i.prototype.pause=function(){this.originVideo.pause()},Object.defineProperty(i.prototype,"bitmapData",{get:function(){return this._bitmapData},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"length",{get:function(){if(this.loaded)return this.originVideo.duration;throw new Error("Video not loaded!")},enumerable:!0,configurable:!0}),i.prototype.$onAddToStage=function(e,t){this.isAddToStage=!0,this.originVideo&&this.originVideo.setVideoVisible(!0),this.$invalidate(),this.$invalidateContentBounds(),r.prototype.$onAddToStage.call(this,e,t)},i.prototype.$onRemoveFromStage=function(){this.isAddToStage=!1,this.originVideo&&(this.stopPlay(),this.originVideo.setVideoVisible(!1)),r.prototype.$onRemoveFromStage.call(this)},i.prototype.getPlayWidth=function(){return isNaN(this.widthSet)?this.bitmapData?this.bitmapData.width:this.posterData?this.posterData.width:0/0:this.widthSet},i.prototype.getPlayHeight=function(){return isNaN(this.heightSet)?this.bitmapData?this.bitmapData.height:this.posterData?this.posterData.height:0/0:this.heightSet},i.prototype.$setHeight=function(e){return this.heightSet=+e||0,this.setVideoSize(),this.$invalidate(),this.$invalidateContentBounds(),r.prototype.$setHeight.call(this,e)},i.prototype.$setWidth=function(e){return this.widthSet=+e||0,this.setVideoSize(),this.$invalidate(),this.$invalidateContentBounds(),r.prototype.$setWidth.call(this,e)},i.prototype.$setX=function(e){var t=r.prototype.$setX.call(this,e);return this.setVideoSize(),t},i.prototype.$setY=function(e){var t=r.prototype.$setY.call(this,e);return this.setVideoSize(),t},i.prototype.setVideoSize=function(){var e=this.originVideo;e&&!this.fullscreen&&(this.firstPlay?e.setVideoRect(this.x,this.y,0,0):e.setVideoRect(this.x,this.y,this.widthSet,this.heightSet))},i.prototype.$measureContentBounds=function(e){var t=this.posterData;t?e.setTo(0,0,this.getPlayWidth(),this.getPlayHeight()):e.setEmpty()},i.prototype.$render=function(){var e=this.$renderNode,t=this.posterData,r=this.getPlayWidth(),i=this.getPlayHeight();0>=r||0>=i||(!this.isPlayed&&t?(e.image=t,e.drawImage(0,0,t.width,t.height,0,0,r,i)):this.isPlayed&&this.setVideoSize())},i.prototype.markDirty=function(){return this.$invalidate(),!0},i}(e.DisplayObject);t.NativeVideo=r,__reflect(r.prototype,"egret.native2.NativeVideo",["egret.Video","egret.DisplayObject"])}(t=e.native2||(e.native2={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var r=function(r){function i(){var e=r.call(this)||this;return e._url="",e._method="",e.urlData={},e.responseHeader="",e}return __extends(i,r),Object.defineProperty(i.prototype,"response",{get:function(){return this._response},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"responseType",{get:function(){return this._responseType},set:function(e){this._responseType=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"withCredentials",{get:function(){return this._withCredentials},set:function(e){this._withCredentials=e},enumerable:!0,configurable:!0}),i.prototype.open=function(e,t){void 0===t&&(t="GET"),this._url=e,this._method=t},i.prototype.send=function(r){function i(){var t=new e.PromiseObject;t.onSuccessFunc=function(t){a._response=t,e.Event.dispatchEvent(a,e.Event.COMPLETE)},t.onErrorFunc=function(){e.Event.dispatchEvent(a,e.IOErrorEvent.IO_ERROR)},a._responseType==e.HttpResponseType.ARRAY_BUFFER?egret_native.readFileAsync(a._url,t,"ArrayBuffer"):egret_native.readFileAsync(a._url,t)}function n(){var r=t.PromiseObject.create();r.onSuccessFunc=i,r.onErrorFunc=function(){e.Event.dispatchEvent(a,e.IOErrorEvent.IO_ERROR)},r.onResponseHeaderFunc=this.onResponseHeader,r.onResponseHeaderThisObject=this,egret_native.download(a._url,a._url,r)}var a=this;if(a.isNetUrl(a._url)){a.urlData.type=a._method,a._method==e.HttpMethod.POST&&r?r instanceof ArrayBuffer?a.urlData.data=r:a.urlData.data=r.toString():delete a.urlData.data,a._responseType==e.HttpResponseType.ARRAY_BUFFER?a.urlData.binary=!0:a.urlData.header=!1,this.headerObj?a.urlData.header=JSON.stringify(this.headerObj):delete a.urlData.header;var o=t.PromiseObject.create();o.onSuccessFunc=function(t){a._response=t,e.$callAsync(e.Event.dispatchEvent,e.Event,a,e.Event.COMPLETE)},o.onErrorFunc=function(t){e.$warn(1019,t),e.Event.dispatchEvent(a,e.IOErrorEvent.IO_ERROR)},o.onResponseHeaderFunc=this.onResponseHeader,o.onResponseHeaderThisObject=this,egret_native.requireHttp(a._url,a.urlData,o)}else egret_native.isFileExists(a._url)?i():n()},i.prototype.isNetUrl=function(e){return-1!=e.indexOf("http://")||-1!=e.indexOf("HTTP://")||-1!=e.indexOf("https://")||-1!=e.indexOf("HTTPS://")},i.prototype.abort=function(){},i.prototype.onResponseHeader=function(e){this.responseHeader="";var t=JSON.parse(e);for(var r in t)this.responseHeader+=r+": "+t[r]+"\r\n"},i.prototype.getAllResponseHeaders=function(){return this.responseHeader},i.prototype.setRequestHeader=function(e,t){this.headerObj||(this.headerObj={}),this.headerObj[e]=t},i.prototype.getResponseHeader=function(e){return""},i}(e.EventDispatcher);t.NativeHttpRequest=r,__reflect(r.prototype,"egret.native2.NativeHttpRequest",["egret.HttpRequest"]),e.HttpRequest=r}(t=e.native2||(e.native2={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var r=function(t){function r(){var e=null!==t&&t.apply(this,arguments)||this;return e.data=null,e._crossOrigin=null,e}return __extends(r,t),Object.defineProperty(r.prototype,"crossOrigin",{get:function(){return this._crossOrigin},set:function(e){this._crossOrigin=e},enumerable:!0,configurable:!0}),r.prototype.load=function(e){this.check(e)},r.prototype.check=function(e){var t=this;t.isNetUrl(e)?t.download(e):egret_native.isFileExists(e)?t.loadTexture(e):t.download(e)},r.prototype.download=function(t){var r=this,i=e.PromiseObject.create();i.onSuccessFunc=function(){r.loadTexture(t)},i.onErrorFunc=function(){r.dispatchEventWith(e.IOErrorEvent.IO_ERROR)},egret_native.download(t,t,i)},r.prototype.loadTexture=function(t){var r=this,i=new e.PromiseObject;i.onSuccessFunc=function(t){r.data=new e.BitmapData(t),r.dispatchEventWith(e.Event.COMPLETE)},i.onErrorFunc=function(){r.dispatchEventWith(e.IOErrorEvent.IO_ERROR)},egret_native.createRawImage(t,i)},r.prototype.isNetUrl=function(e){return-1!=e.indexOf("http://")||-1!=e.indexOf("HTTP://")||-1!=e.indexOf("https://")||-1!=e.indexOf("HTTPS://")},r}(e.EventDispatcher);r.crossOrigin=null,t.NativeImageLoader=r,__reflect(r.prototype,"egret.native2.NativeImageLoader",["egret.ImageLoader"]),e.ImageLoader=r}(t=e.native2||(e.native2={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var r=function(t){function r(r,i,n,a,o){var s=t.call(this)||this;return s.arrFps=[],s.arrLog=[],(i||n)&&(s.panelX=void 0===o.x?0:parseInt(o.x),s.panelY=void 0===o.y?0:parseInt(o.y),s._stage=r,s.showFps=i,s.showLog=n,s.fontColor=void 0===o.textColor?16777215:parseInt(o.textColor),s.fontSize=void 0===o.size?24:parseInt(o.size),s.bgAlpha=o.bgAlpha||.9,s.shape=new e.Shape,s.addChild(s.shape),i&&s.addFps(),n&&s.addLog()),s}return __extends(r,t),r.prototype.addFps=function(){var t=new e.TextField;t.x=t.y=4,this.textFps=t,this.addChild(t),t.lineSpacing=2,t.size=this.fontSize,t.textColor=this.fontColor,t.textFlow=[{text:"0 FPS "+e.Capabilities.renderMode+"\n"},{text:"Draw: 0\nDirty: 0%\n"},{text:"Cost: "},{text:"0 ",style:{textColor:1638142}},{text:"0 ",style:{textColor:16776960}},{text:"0 ",style:{textColor:16711680}}]},r.prototype.addLog=function(){var t=new e.TextField;t.size=this.fontSize,t.textColor=this.fontColor,t.x=4,this.addChild(t),this.textLog=t},r.prototype.update=function(t){this.arrFps.push(t.fps);var r=0,i=this.arrFps.length;i>101&&(i=101,this.arrFps.shift());for(var n=this.arrFps[0],a=this.arrFps[0],o=0;i>o;o++){var s=this.arrFps[o];r+=s,n>s?n=s:s>a&&(a=s)}this.textFps.textFlow=[{text:t.fps+" FPS "+e.Capabilities.renderMode+"\n"},{text:"min"+n+" max"+a+" avg"+Math.floor(r/i)+"\n"},{text:"Draw: "+t.draw+"\nDirty: "+t.dirty+"%\n"},{text:"Cost: "},{text:t.costTicker+" ",style:{textColor:1638142}},{text:t.costDirty+" ",style:{textColor:16776960}},{text:t.costRender+" ",style:{textColor:16711680}}],this.updateLayout()},r.prototype.updateInfo=function(e){var t=0;if(this.showFps&&(t=this.textFps.height,this.textLog.y=t+4),this.arrLog.push(e),this.textLog.text=this.arrLog.join("\n"),this._stage.stageHeight>0)for(this.textLog.textWidth>this._stage.stageWidth-20-this.panelX&&(this.textLog.width=this._stage.stageWidth-20-this.panelX);this.textLog.textHeight>this._stage.stageHeight-t-20-this.panelY;)this.arrLog.shift(),this.textLog.text=this.arrLog.join("\n");this.updateLayout()},r.prototype.updateLayout=function(){if(e.Capabilities.runtimeType!=e.RuntimeType.NATIVE){var t=this.shape.$graphics;t.clear(),t.beginFill(0,this.bgAlpha),t.drawRect(0,0,this.width+8,this.height+8),t.endFill()}},r}(e.Sprite);t.NativeFps=r,__reflect(r.prototype,"egret.native2.NativeFps",["egret.FPSDisplay","egret.DisplayObject"]),e.FPSDisplay=r}(t=e.native2||(e.native2={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){function r(t,r,i,n,a){var o,s;if(-1!=r.indexOf(", ")?s=r.split(", "):-1!=r.indexOf(",")&&(s=r.split(",")),s)for(var u=s.length,h=0;u>h;h++){var l=s[h];if(e.fontMapping[l]){o=e.fontMapping[l];break}}else o=e.fontMapping[r];return o||(o="/system/fonts/DroidSansFallback.ttf"),egret_native.Label.createLabel(o,i,"",0),egret_native.Label.getTextSize(t)[0]}e.sys.measureText=r}(t=e.native2||(e.native2={}))}(egret||(egret={}));var egret;!function(e){var t;!function(e){}(t=e.native2||(e.native2={}))}(egret||(egret={}));var egret;!function(e){var t;!function(e){function t(e,t){var r=document.createElement("canvas");
isNaN(e)||isNaN(t)||(r.width=e,r.height=t);var i=r.getContext("2d");if(void 0===i.imageSmoothingEnabled){for(var n,a=["webkitImageSmoothingEnabled","mozImageSmoothingEnabled","msImageSmoothingEnabled"],o=a.length-1;o>=0&&(n=a[o],void 0===i[n]);o--);try{Object.defineProperty(i,"imageSmoothingEnabled",{get:function(){return this[n]},set:function(e){this[n]=e}})}catch(s){i.imageSmoothingEnabled=i[n]}}return r}var r,i=function(){function e(e,t,r){}return Object.defineProperty(e.prototype,"width",{get:function(){return this.surface.width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this.surface.height},enumerable:!0,configurable:!0}),e.prototype.resize=function(e,t,r){var i=this.surface;if(r){var n=!1;i.width<e&&(i.width=e,n=!0),i.height<t&&(i.height=t,n=!0),n||(this.context.globalCompositeOperation="source-over",this.context.setTransform(1,0,0,1,0,0),this.context.globalAlpha=1)}else i.width!=e&&(i.width=e),i.height!=t&&(i.height=t);this.clear()},e.prototype.resizeTo=function(e,i,n,a){r||(r=t());var o=(this.context,this.surface),s=r,u=s.getContext("2d");r=o,this.context=u,this.surface=s,s.width=Math.max(e,257),s.height=Math.max(i,257),u.setTransform(1,0,0,1,0,0),u.drawImage(o,n,a),o.height=1,o.width=1},e.prototype.setDirtyRegionPolicy=function(e){},e.prototype.beginClip=function(e,t,r){t=+t||0,r=+r||0;var i=this.context;i.save(),i.beginPath(),i.setTransform(1,0,0,1,t,r);for(var n=e.length,a=0;n>a;a++){var o=e[a];i.clearRect(o.minX,o.minY,o.width,o.height),i.rect(o.minX,o.minY,o.width,o.height)}i.clip()},e.prototype.endClip=function(){this.context.restore()},e.prototype.getPixels=function(e,t,r,i){return void 0===r&&(r=1),void 0===i&&(i=1),this.context.getImageData(e,t,r,i).data},e.prototype.toDataURL=function(e,t){return this.surface.toDataURL(e,t)},e.prototype.clear=function(){this.context.setTransform(1,0,0,1,0,0),this.context.clearRect(0,0,this.surface.width,this.surface.height)},e.prototype.destroy=function(){this.surface.width=this.surface.height=0},e}();e.CanvasRenderBuffer=i,__reflect(i.prototype,"egret.native2.CanvasRenderBuffer",["egret.sys.RenderBuffer"])}(t=e.native2||(e.native2={}))}(egret||(egret={}));var egret;!function(e){var t;!function(e){var t=function(){function e(){this.drawData=[],this.drawDataLen=0}return e.prototype.pushDrawRect=function(){if(0==this.drawDataLen||1!=this.drawData[this.drawDataLen-1].type){var e=this.drawData[this.drawDataLen]||{};e.type=1,e.count=0,this.drawData[this.drawDataLen]=e,this.drawDataLen++}this.drawData[this.drawDataLen-1].count+=2},e.prototype.pushDrawTexture=function(e,t,r,i,n){if(void 0===t&&(t=2),r){var a=this.drawData[this.drawDataLen]||{};a.type=0,a.texture=e,a.filter=r,a.count=t,a.textureWidth=i,a.textureHeight=n,this.drawData[this.drawDataLen]=a,this.drawDataLen++}else{if(0==this.drawDataLen||0!=this.drawData[this.drawDataLen-1].type||e!=this.drawData[this.drawDataLen-1].texture||this.drawData[this.drawDataLen-1].filter){var a=this.drawData[this.drawDataLen]||{};a.type=0,a.texture=e,a.count=0,this.drawData[this.drawDataLen]=a,this.drawDataLen++}this.drawData[this.drawDataLen-1].count+=t}},e.prototype.pushDrawText=function(e,t,r,i,n,a){var o=this.drawData[this.drawDataLen]||{};o.type=10,o.texture=e,o.count=t,o.textColor=r,o.stroke=i,o.strokeColor=n,o.texturesInfo=a,this.drawData[this.drawDataLen]=o,this.drawDataLen++},e.prototype.pushPushMask=function(e){void 0===e&&(e=1);var t=this.drawData[this.drawDataLen]||{};t.type=2,t.count=2*e,this.drawData[this.drawDataLen]=t,this.drawDataLen++},e.prototype.pushPopMask=function(e){void 0===e&&(e=1);var t=this.drawData[this.drawDataLen]||{};t.type=3,t.count=2*e,this.drawData[this.drawDataLen]=t,this.drawDataLen++},e.prototype.pushSetBlend=function(e){for(var t=this.drawDataLen,r=!1,i=t-1;i>=0;i--){var n=this.drawData[i];if(n){if((0==n.type||1==n.type)&&(r=!0),!r&&4==n.type){this.drawData.splice(i,1),this.drawDataLen--;continue}if(4==n.type){if(n.value==e)return;break}}}var a=this.drawData[this.drawDataLen]||{};a.type=4,a.value=e,this.drawData[this.drawDataLen]=a,this.drawDataLen++},e.prototype.pushResize=function(e,t,r){var i=this.drawData[this.drawDataLen]||{};i.type=5,i.buffer=e,i.width=t,i.height=r,this.drawData[this.drawDataLen]=i,this.drawDataLen++},e.prototype.pushClearColor=function(){var e=this.drawData[this.drawDataLen]||{};e.type=6,this.drawData[this.drawDataLen]=e,this.drawDataLen++},e.prototype.pushActivateBuffer=function(e){for(var t=this.drawDataLen,r=!1,i=t-1;i>=0;i--){var n=this.drawData[i];!n||(4!=n.type&&7!=n.type&&(r=!0),r||7!=n.type)||(this.drawData.splice(i,1),this.drawDataLen--)}var a=this.drawData[this.drawDataLen]||{};a.type=7,a.buffer=e,a.width=e.rootRenderTarget.width,a.height=e.rootRenderTarget.height,this.drawData[this.drawDataLen]=a,this.drawDataLen++},e.prototype.pushEnableScissor=function(e,t,r,i){var n=this.drawData[this.drawDataLen]||{};n.type=8,n.x=e,n.y=t,n.width=r,n.height=i,this.drawData[this.drawDataLen]=n,this.drawDataLen++},e.prototype.pushDisableScissor=function(){var e=this.drawData[this.drawDataLen]||{};e.type=9,this.drawData[this.drawDataLen]=e,this.drawDataLen++},e.prototype.clear=function(){for(var e=0;e<this.drawDataLen;e++){var t=this.drawData[e];t.type=0,t.count=0,t.texture=null,t.filter=null,t.uv=null,t.value="",t.buffer=null,t.width=0,t.height=0}this.drawDataLen=0},e}();e.WebGLDrawCmdManager=t,__reflect(t.prototype,"egret.native2.WebGLDrawCmdManager")}(t=e.native2||(e.native2={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var r=function(r){function n(i,n,a){var o=r.call(this)||this;if(o.globalAlpha=1,o.stencilState=!1,o.$stencilList=[],o.stencilHandleCount=0,o.$scissorState=!1,o.scissorRect=new e.Rectangle,o.$hasScissor=!1,o.dirtyRegionPolicy=!0,o._dirtyRegionPolicy=!0,o.$drawCalls=0,o.$computeDrawCall=!1,o.globalMatrix=new e.Matrix,o.savedGlobalMatrix=new e.Matrix,o.context=t.WebGLRenderContext.getInstance(i,n),o.rootRenderTarget=new t.WebGLRenderTarget(o.context.context,3,3),i&&n&&o.resize(i,n),o.root=a,o.root)o.context.pushBuffer(o),o.surface=o.context.surface;else{var s=o.context.activatedBuffer;s&&s.rootRenderTarget.activate(),o.surface=o.rootRenderTarget}return o}return __extends(n,r),n.prototype.enableStencil=function(){this.stencilState||(this.context.enableStencilTest(),this.stencilState=!0)},n.prototype.disableStencil=function(){this.stencilState&&(this.context.disableStencilTest(),this.stencilState=!1)},n.prototype.restoreStencil=function(){this.stencilState?this.context.enableStencilTest():this.context.disableStencilTest()},n.prototype.enableScissor=function(e,t,r,i){this.$scissorState||(this.$scissorState=!0,this.scissorRect.setTo(e,t,r,i),this.context.enableScissorTest(this.scissorRect))},n.prototype.disableScissor=function(){this.$scissorState&&(this.$scissorState=!1,this.scissorRect.setEmpty(),this.context.disableScissorTest())},n.prototype.restoreScissor=function(){this.$scissorState?this.context.enableScissorTest(this.scissorRect):this.context.disableScissorTest()},Object.defineProperty(n.prototype,"width",{get:function(){return this.rootRenderTarget.width},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"height",{get:function(){return this.rootRenderTarget.height},enumerable:!0,configurable:!0}),n.prototype.resize=function(e,t,r){this.context.pushBuffer(this),e=e||1,t=t||1,(e!=this.rootRenderTarget.width||t!=this.rootRenderTarget.height)&&(this.context.drawCmdManager.pushResize(this,e,t),this.rootRenderTarget.width=e,this.rootRenderTarget.height=t),this.root&&this.context.resize(e,t,r),this.context.clear(),this.context.popBuffer()},n.prototype.resizeTo=function(e,t,r,i){this.context.pushBuffer(this);var a=this.rootRenderTarget.width,o=this.rootRenderTarget.height,s=n.create(a,o);this.context.pushBuffer(s),this.context.drawImage(this.rootRenderTarget,0,0,a,o,0,0,a,o,a,o),this.context.popBuffer(),this.resize(e,t),this.setTransform(1,0,0,1,0,0),this.context.drawImage(s.rootRenderTarget,0,0,a,o,r,i,a,o,a,o),n.release(s),this.context.popBuffer()},n.prototype.setDirtyRegionPolicy=function(e){this.dirtyRegionPolicy="on"==e},n.prototype.beginClip=function(e,t,r){this.context.pushBuffer(this),this.root&&(this._dirtyRegionPolicy?(this.rootRenderTarget.useFrameBuffer=!0,this.rootRenderTarget.activate()):(this.rootRenderTarget.useFrameBuffer=!1,this.rootRenderTarget.activate(),n.autoClear&&this.context.clear())),t=+t||0,r=+r||0,this.setTransform(1,0,0,1,t,r);var i=e.length;if(1==i&&0==e[0].minX&&0==e[0].minY&&e[0].width==this.rootRenderTarget.width&&e[0].height==this.rootRenderTarget.height)return this.maskPushed=!1,this.rootRenderTarget.useFrameBuffer&&this.context.clear(),void this.context.popBuffer();for(var a=0;i>a;a++){var o=e[a];this.context.clearRect(o.minX,o.minY,o.width,o.height)}if(i>0){if(this.$hasScissor||1!=i)this.scissorEnabled=!1;else{var o=e[0];e=e.slice(1);var s=o.minX+t,u=o.minY+r,h=o.width,l=o.height;this.context.enableScissor(s,-u-l+this.height,h,l),this.scissorEnabled=!0}e.length>0?(this.context.pushMask(e),this.maskPushed=!0):this.maskPushed=!1,this.offsetX=t,this.offsetY=r}else this.maskPushed=!1;this.context.popBuffer()},n.prototype.endClip=function(){(this.maskPushed||this.scissorEnabled)&&(this.context.pushBuffer(this),this.maskPushed&&(this.setTransform(1,0,0,1,this.offsetX,this.offsetY),this.context.popMask()),this.scissorEnabled&&this.context.disableScissor(),this.context.popBuffer())},n.prototype.getPixels=function(e,t,r,i){void 0===r&&(r=1),void 0===i&&(i=1);var n=new Uint8Array(4*r*i),a=this.rootRenderTarget.useFrameBuffer;this.rootRenderTarget.useFrameBuffer=!0,this.rootRenderTarget.activate(),this.context.getPixels(e,t,r,i,n),this.rootRenderTarget.useFrameBuffer=a,this.rootRenderTarget.activate();for(var o=new Uint8Array(4*r*i),s=0;i>s;s++)for(var u=0;r>u;u++)o[4*(r*(i-s-1)+u)]=n[4*(r*s+u)],o[4*(r*(i-s-1)+u)+1]=n[4*(r*s+u)+1],o[4*(r*(i-s-1)+u)+2]=n[4*(r*s+u)+2],o[4*(r*(i-s-1)+u)+3]=n[4*(r*s+u)+3];return o},n.prototype.toDataURL=function(e,t){return this.context.surface.toDataURL(e,t)},n.prototype.destroy=function(){this.context.destroy()},n.prototype.onRenderFinish=function(){this.$drawCalls=0,this.root&&(!this._dirtyRegionPolicy&&this.dirtyRegionPolicy&&this.drawSurfaceToFrameBuffer(0,0,this.rootRenderTarget.width,this.rootRenderTarget.height,0,0,this.rootRenderTarget.width,this.rootRenderTarget.height,!0),this._dirtyRegionPolicy&&this.drawFrameBufferToSurface(0,0,this.rootRenderTarget.width,this.rootRenderTarget.height,0,0,this.rootRenderTarget.width,this.rootRenderTarget.height),this._dirtyRegionPolicy=this.dirtyRegionPolicy)},n.prototype.drawFrameBufferToSurface=function(e,t,r,i,n,a,o,s,u){void 0===u&&(u=!1),this.rootRenderTarget.useFrameBuffer=!1,this.rootRenderTarget.activate(),this.context.disableStencilTest(),this.context.disableScissorTest(),this.setTransform(1,0,0,1,0,0),this.globalAlpha=1,this.context.setGlobalCompositeOperation("source-over"),u&&this.context.clear(),this.context.drawImage(this.rootRenderTarget,e,t,r,i,n,a,o,s,r,i),this.context.$drawWebGL(),this.rootRenderTarget.useFrameBuffer=!0,this.rootRenderTarget.activate(),this.restoreStencil(),this.restoreScissor()},n.prototype.drawSurfaceToFrameBuffer=function(e,t,r,i,n,a,o,s,u){void 0===u&&(u=!1),this.rootRenderTarget.useFrameBuffer=!0,this.rootRenderTarget.activate(),this.context.disableStencilTest(),this.context.disableScissorTest(),this.setTransform(1,0,0,1,0,0),this.globalAlpha=1,this.context.setGlobalCompositeOperation("source-over"),u&&this.context.clear(),this.context.drawImage(this.context.surface,e,t,r,i,n,a,o,s,r,i),this.context.$drawWebGL(),this.rootRenderTarget.useFrameBuffer=!1,this.rootRenderTarget.activate(),this.restoreStencil(),this.restoreScissor()},n.prototype.clear=function(){this.context.clear()},n.prototype.setTransform=function(e,t,r,i,n,a){var o=this.globalMatrix;o.a=e,o.b=t,o.c=r,o.d=i,o.tx=n,o.ty=a},n.prototype.transform=function(e,t,r,i,n,a){var o=this.globalMatrix,s=o.a,u=o.b,h=o.c,l=o.d;(1!=e||0!=t||0!=r||1!=i)&&(o.a=e*s+t*h,o.b=e*u+t*l,o.c=r*s+i*h,o.d=r*u+i*l),o.tx=n*s+a*h+o.tx,o.ty=n*u+a*l+o.ty},n.prototype.translate=function(e,t){var r=this.globalMatrix;r.tx+=e,r.ty+=t},n.prototype.saveTransform=function(){var e=this.globalMatrix,t=this.savedGlobalMatrix;t.a=e.a,t.b=e.b,t.c=e.c,t.d=e.d,t.tx=e.tx,t.ty=e.ty},n.prototype.restoreTransform=function(){var e=this.globalMatrix,t=this.savedGlobalMatrix;e.a=t.a,e.b=t.b,e.c=t.c,e.d=t.d,e.tx=t.tx,e.ty=t.ty},n.create=function(e,t){var r=i.pop();if(r){r.resize(e,t);var a=r.globalMatrix;a.a=1,a.b=0,a.c=0,a.d=1,a.tx=0,a.ty=0}else r=new n(e,t),r.$computeDrawCall=!1;return r},n.release=function(e){i.push(e)},n}(e.HashObject);r.autoClear=!0,t.WebGLRenderBuffer=r,__reflect(r.prototype,"egret.native2.WebGLRenderBuffer",["egret.sys.RenderBuffer"]);var i=[]}(t=e.native2||(e.native2={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){function r(e,t){e=isNaN(e)?480:e,t=isNaN(t)?800:t;var r=new egret_native.Canvas(e,t);return r}var i=function(){function i(e,i){this.glID=null,this.projectionX=0/0,this.projectionY=0/0,this.shaderManager=null,this.contextLost=!1,this.$scissorState=!1,this.drawPushText=function(e,t){for(var r=this.context,i=0,n=0;n<e.texturesInfo.length;n++)egret_native.Label.bindTexture(n),r.drawElements(r.TRIANGLES,6*e.texturesInfo[n],r.UNSIGNED_SHORT,2*(t+i)),i+=6*e.texturesInfo[n];return i},this.vertSize=5,this.blurFilter=null,this.surface=r(e,i),this.initWebGL(),this.$bufferStack=[];var n=this.context;this.vertexBuffer=n.createBuffer(),this.indexBuffer=n.createBuffer(),n.bindBuffer(n.ARRAY_BUFFER,this.vertexBuffer),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,this.indexBuffer),this.drawCmdManager=new t.WebGLDrawCmdManager,this.vao=new t.WebGLVertexArrayObject,this.setGlobalCompositeOperation("source-over")}return i.getInstance=function(e,t){return this.instance?this.instance:(this.instance=new i(e,t),this.instance)},i.prototype.pushBuffer=function(e){this.$bufferStack.push(e),e!=this.currentBuffer&&(this.currentBuffer,this.drawCmdManager.pushActivateBuffer(e)),this.currentBuffer=e},i.prototype.popBuffer=function(){if(!(this.$bufferStack.length<=1)){var e=this.$bufferStack.pop(),t=this.$bufferStack[this.$bufferStack.length-1];e!=t&&this.drawCmdManager.pushActivateBuffer(t),this.currentBuffer=t}},i.prototype.activateBuffer=function(e){e.rootRenderTarget.activate(),this.bindIndices||(this.uploadIndicesArray(this.vao.getIndices()),this.bindIndices=!0),e.restoreStencil(),e.restoreScissor(),this.onResize(e.width,e.height)},i.prototype.uploadVerticesArray=function(e){var t=this.context;t.bufferData(t.ARRAY_BUFFER,e,t.STREAM_DRAW)},i.prototype.uploadIndicesArray=function(e){var t=this.context;t.bufferData(t.ELEMENT_ARRAY_BUFFER,e,t.STATIC_DRAW)},i.prototype.destroy=function(){this.surface.width=this.surface.height=0},i.prototype.onResize=function(e,t){e=e||this.surface.width,t=t||this.surface.height,this.projectionX=e/2,this.projectionY=-t/2,this.context&&this.context.viewport(0,0,e,t)},i.prototype.resize=function(e,t,r){var i=this.surface;r?(i.width<e&&(i.width=e),i.height<t&&(i.height=t)):(i.width!=e&&(i.width=e),i.height!=t&&(i.height=t)),this.onResize()},i.prototype.initWebGL=function(){this.onResize(),this.getWebGLContext(),this.shaderManager=new t.WebGLShaderManager(this.context)},i.prototype.handleContextLost=function(){this.contextLost=!0},i.prototype.handleContextRestored=function(){this.initWebGL(),this.contextLost=!1},i.prototype.getWebGLContext=function(){for(var t,r={antialias:i.antialias,stencil:!0},n=["webgl","experimental-webgl"],a=0;a<n.length;a++){try{t=this.surface.getContext(n[a],r)}catch(o){}if(t)break}t||e.$error(1021),this.setContext(t)},i.prototype.setContext=function(e){this.context=e,e.id=i.glContextId++,this.glID=e.id,e.disable(e.DEPTH_TEST),e.disable(e.CULL_FACE),e.enable(e.BLEND),e.colorMask(!0,!0,!0,!0),e.activeTexture(e.TEXTURE0)},i.prototype.enableStencilTest=function(){var e=this.context;e.enable(e.STENCIL_TEST)},i.prototype.disableStencilTest=function(){var e=this.context;e.disable(e.STENCIL_TEST)},i.prototype.enableScissorTest=function(e){var t=this.context;t.enable(t.SCISSOR_TEST),t.scissor(e.x,e.y,e.width,e.height)},i.prototype.disableScissorTest=function(){var e=this.context;e.disable(e.SCISSOR_TEST)},i.prototype.getPixels=function(e,t,r,i,n){var a=this.context;a.readPixels(e,t,r,i,a.RGBA,a.UNSIGNED_BYTE,n)},i.prototype.createTexture=function(e){var t=this.context,r=t.createTexture();return r?(r.glContext=t,t.bindTexture(t.TEXTURE_2D,r),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),r):void(this.contextLost=!0)},i.prototype.createTextureFromCompressedData=function(e,t,r,i,n){return null},i.prototype.updateTexture=function(e,t){var r=this.context;r.bindTexture(r.TEXTURE_2D,e),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,t)},i.prototype.getWebGLTexture=function(e){return e.webGLTexture||("image"==e.format?e.webGLTexture=this.createTexture(e.source):"pvr"==e.format&&(e.webGLTexture=this.createTextureFromCompressedData(e.source.pvrtcData,e.width,e.height,e.source.mipmapsCount,e.source.format)),e.$deleteSource&&e.webGLTexture&&(e.source&&e.source.dispose&&e.source.dispose(),e.source=null)),e.webGLTexture},i.prototype.clearRect=function(e,t,r,i){if(0!=e||0!=t||r!=this.surface.width||i!=this.surface.height){var n=this.currentBuffer;if(n.$hasScissor)this.setGlobalCompositeOperation("destination-out"),this.drawRect(e,t,r,i),this.setGlobalCompositeOperation("source-over");else{var a=n.globalMatrix;0==a.b&&0==a.c?(e=e*a.a+a.tx,t=t*a.d+a.ty,r*=a.a,i*=a.d,this.enableScissor(e,-t-i+n.height,r,i),this.clear(),this.disableScissor()):(this.setGlobalCompositeOperation("destination-out"),this.drawRect(e,t,r,i),this.setGlobalCompositeOperation("source-over"))}}else this.clear()},i.prototype.setGlobalCompositeOperation=function(e){this.drawCmdManager.pushSetBlend(e)},i.prototype.drawImage=function(e,t,r,i,n,a,o,s,u,h,l){var c=this.currentBuffer;if(!this.contextLost&&e&&c){var d;if(e.texture||e.source&&e.source.texture)d=e.texture||e.source.texture,c.saveTransform(),c.transform(1,0,0,-1,0,u+2*o);else{if(!e.source&&!e.webGLTexture)return;d=this.getWebGLTexture(e)}d&&(this.drawTexture(d,t,r,i,n,a,o,s,u,h,l),e.source&&e.source.texture&&c.restoreTransform())}},i.prototype.drawMesh=function(e,t,r,i,n,a,o,s,u,h,l,c,d,p,f){var v=this.currentBuffer;if(!this.contextLost&&e&&v){var g;if(e.texture||e.source&&e.source.texture)g=e.texture||e.source.texture,v.saveTransform(),v.transform(1,0,0,-1,0,u+2*o);else{if(!e.source&&!e.webGLTexture)return;g=this.getWebGLTexture(e)}g&&this.drawTexture(g,t,r,i,n,a,o,s,u,h,l,c,d,p,f)}},i.prototype.drawTexture=function(e,t,r,i,n,a,o,s,u,h,l,c,d,p,f){var v=this.currentBuffer;if(!this.contextLost&&e&&v){d&&p?this.vao.reachMaxSize(d.length/2,p.length)&&this.$drawWebGL():this.vao.reachMaxSize()&&this.$drawWebGL(),c&&this.vao.changeToMeshIndices();var g=v.globalMatrix,y=v.globalAlpha,x=p?p.length/3:2;this.drawCmdManager.pushDrawTexture(e,x,this.$filter),this.vao.cacheArrays(g,y,t,r,i,n,a,o,s,u,h,l,c,d,p)}},i.prototype.drawText=function(e,t,r,i,n,a,o){var s=this.currentBuffer;if(!this.contextLost&&s){for(var u=egret_native.Label.setupTextQuads(e,e.length,r,i),h=new Float32Array(u),l=0;l<e.length;l++);var c=2*e.length,d=s.globalMatrix,p=s.globalAlpha,f={};f.isForLabel=!0;var v=egret_native.Label.getTextureInfo(),g=new Int32Array(v);this.drawCmdManager.pushDrawText(f,c,n,a,o,g),this.vao.cacheArraysForText(d,p,h,e.length,t),this.$drawWebGL()}},i.prototype.drawRect=function(e,t,r,i){var n=this.currentBuffer;!this.contextLost&&n&&(this.vao.reachMaxSize()&&this.$drawWebGL(),this.drawCmdManager.pushDrawRect(),this.vao.cacheArrays(n.globalMatrix,n.globalAlpha,0,0,r,i,e,t,r,i,r,i))},i.prototype.pushMask=function(e){var t=this.currentBuffer;if(!this.contextLost&&t){t.$stencilList.push(e),this.vao.reachMaxSize()&&this.$drawWebGL();var r=e.length;if(r){this.drawCmdManager.pushPushMask(r);for(var i=0;r>i;i++){var n=e[i];this.vao.cacheArrays(t.globalMatrix,t.globalAlpha,0,0,n.width,n.height,n.minX,n.minY,n.width,n.height,n.width,n.height)}}else this.drawCmdManager.pushPushMask(),this.vao.cacheArrays(t.globalMatrix,t.globalAlpha,0,0,e.width,e.height,e.x,e.y,e.width,e.height,e.width,e.height)}},i.prototype.popMask=function(){var e=this.currentBuffer;if(!this.contextLost&&e){var t=e.$stencilList.pop();this.vao.reachMaxSize()&&this.$drawWebGL();var r=t.length;if(r){this.drawCmdManager.pushPopMask(r);for(var i=0;r>i;i++){var n=t[i];this.vao.cacheArrays(e.globalMatrix,e.globalAlpha,0,0,n.width,n.height,n.minX,n.minY,n.width,n.height,n.width,n.height)}}else this.drawCmdManager.pushPopMask(),this.vao.cacheArrays(e.globalMatrix,e.globalAlpha,0,0,t.width,t.height,t.x,t.y,t.width,t.height,t.width,t.height)}},i.prototype.clear=function(){this.drawCmdManager.pushClearColor()},i.prototype.enableScissor=function(e,t,r,i){var n=this.currentBuffer;this.drawCmdManager.pushEnableScissor(e,t,r,i),n.$hasScissor=!0},i.prototype.disableScissor=function(){var e=this.currentBuffer;this.drawCmdManager.pushDisableScissor(),e.$hasScissor=!1},i.prototype.$drawWebGL=function(){if(0!=this.drawCmdManager.drawDataLen&&!this.contextLost){this.uploadVerticesArray(this.vao.getVertices()),this.vao.isMesh()&&this.uploadIndicesArray(this.vao.getMeshIndices());for(var e=this.drawCmdManager.drawDataLen,t=0,r=0;e>r;r++){var i=this.drawCmdManager.drawData[r];t=this.drawData(i,t),7==i.type&&(this.activatedBuffer=i.buffer),(0==i.type||1==i.type||2==i.type||3==i.type)&&this.activatedBuffer&&this.activatedBuffer.$computeDrawCall&&this.activatedBuffer.$drawCalls++}this.vao.isMesh()&&this.uploadIndicesArray(this.vao.getIndices()),this.drawCmdManager.clear(),this.vao.clear()}},i.prototype.drawData=function(e,t){if(e){var r;switch(e.type){case 0:var i=e.filter;i?"colorTransform"==i.type?(r=this.shaderManager.colorTransformShader,r.setMatrix(i.$matrix)):"blur"==i.type?(r=this.shaderManager.blurShader,r.setBlur(i.$blurX,i.$blurY),r.setTextureSize(e.textureWidth,e.textureHeight)):"glow"==i.type&&(r=this.shaderManager.glowShader,r.setDistance(i.$distance||0),r.setAngle(i.$angle?i.$angle/180*Math.PI:0),r.setColor(i.$red/255,i.$green/255,i.$blue/255),r.setAlpha(i.$alpha),r.setBlurX(i.$blurX),r.setBlurY(i.$blurY),r.setStrength(i.$strength),r.setInner(i.$inner?1:0),r.setKnockout(i.$knockout?0:1),r.setHideObject(i.$hideObject?1:0),r.setTextureSize(e.textureWidth,e.textureHeight)):r=this.shaderManager.defaultShader,r.setProjection(this.projectionX,this.projectionY),this.shaderManager.activateShader(r,4*this.vertSize),r.syncUniforms(),t+=this.drawTextureElements(e,t);break;case 1:r=this.shaderManager.primitiveShader,r.setProjection(this.projectionX,this.projectionY),this.shaderManager.activateShader(r,4*this.vertSize),r.syncUniforms(),t+=this.drawRectElements(e,t);break;case 2:r=this.shaderManager.primitiveShader,r.setProjection(this.projectionX,this.projectionY),this.shaderManager.activateShader(r,4*this.vertSize),r.syncUniforms(),t+=this.drawPushMaskElements(e,t);break;case 3:r=this.shaderManager.primitiveShader,r.setProjection(this.projectionX,this.projectionY),this.shaderManager.activateShader(r,4*this.vertSize),r.syncUniforms(),t+=this.drawPopMaskElements(e,t);break;case 4:this.setBlendMode(e.value);break;case 5:e.buffer.rootRenderTarget.resize(e.width,e.height),this.onResize(e.width,e.height);break;case 6:if(this.activatedBuffer){var n=this.activatedBuffer.rootRenderTarget;(0!=n.width||0!=n.height)&&n.clear()}break;case 7:this.activateBuffer(e.buffer);break;case 8:var a=this.activatedBuffer;a&&a.enableScissor(e.x,e.y,e.width,e.height);break;case 9:a=this.activatedBuffer,a&&a.disableScissor();break;case 10:r=this.shaderManager.fontShader;var o,s,u,h,l=e.textColor;if(l>16777215?(h=255&l,l>>>=8,u=255&l,l>>>=8,s=255&l,l>>>=8,o=255&l):(h=255,u=255&l,l>>>=8,s=255&l,l>>>=8,o=255&l),r.setTextColor(o/255,s/255,u/255,h/255),e.stroke){var o,s,u,h,l=e.strokeColor;l>16777215?(h=255&l,l>>>=8,u=255&l,l>>>=8,s=255&l,l>>>=8,o=255&l):(h=255,u=255&l,l>>>=8,s=255&l,l>>>=8,o=255&l),r.setStrokeColor(o/255,s/255,u/255,h/255)}r.setProjection(this.projectionX,this.projectionY),this.shaderManager.activateShader(r,4*this.vertSize),r.syncUniforms(),t+=this.drawPushText(e,t)}return t}},i.prototype.drawTextureElements=function(e,t){var r=this.context;r.bindTexture(r.TEXTURE_2D,e.texture);var i=3*e.count;return r.drawElements(r.TRIANGLES,i,r.UNSIGNED_SHORT,2*t),i},i.prototype.drawRectElements=function(e,t){var r=this.context,i=3*e.count;return r.drawElements(r.TRIANGLES,i,r.UNSIGNED_SHORT,2*t),i},i.prototype.drawPushMaskElements=function(e,t){var r=this.context,i=3*e.count,n=this.activatedBuffer;if(n){0==n.stencilHandleCount&&(n.enableStencil(),r.clear(r.STENCIL_BUFFER_BIT));var a=n.stencilHandleCount;n.stencilHandleCount++,r.colorMask(!1,!1,!1,!1),r.stencilFunc(r.EQUAL,a,255),r.stencilOp(r.KEEP,r.KEEP,r.INCR),r.drawElements(r.TRIANGLES,i,r.UNSIGNED_SHORT,2*t),r.stencilFunc(r.EQUAL,a+1,255),r.colorMask(!0,!0,!0,!0),r.stencilOp(r.KEEP,r.KEEP,r.KEEP)}return i},i.prototype.drawPopMaskElements=function(e,t){var r=this.context,i=3*e.count,n=this.activatedBuffer;if(n)if(n.stencilHandleCount--,0==n.stencilHandleCount)n.disableStencil();else{var a=n.stencilHandleCount;r.colorMask(!1,!1,!1,!1),r.stencilFunc(r.EQUAL,a+1,255),r.stencilOp(r.KEEP,r.KEEP,r.DECR),r.drawElements(r.TRIANGLES,i,r.UNSIGNED_SHORT,2*t),r.stencilFunc(r.EQUAL,a,255),r.colorMask(!0,!0,!0,!0),r.stencilOp(r.KEEP,r.KEEP,r.KEEP)}return i},i.prototype.setBlendMode=function(e){var t=this.context,r=i.blendModesForGL[e];r&&t.blendFunc(r[0],r[1])},i.prototype.drawTargetWidthFilters=function(e,r){var i,n=r,a=e.length;if(a>1)for(var o=0;a-1>o;o++){var s=e[o],u=r.rootRenderTarget.width,h=r.rootRenderTarget.height;i=t.WebGLRenderBuffer.create(u,h),i.setTransform(1,0,0,1,0,0),i.globalAlpha=1,this.drawToRenderTarget(s,r,i),r!=n&&t.WebGLRenderBuffer.release(r),r=i}var l=e[a-1];this.drawToRenderTarget(l,r,this.currentBuffer),r!=n&&t.WebGLRenderBuffer.release(r)},i.prototype.drawToRenderTarget=function(r,i,n){if(!this.contextLost){this.vao.reachMaxSize()&&this.$drawWebGL(),this.pushBuffer(n);var a,o=i,s=i.rootRenderTarget.width,u=i.rootRenderTarget.height;"blur"==r.type&&(this.blurFilter||(this.blurFilter=new e.BlurFilter(2,2)),0!=r.blurX&&0!=r.blurY?(this.blurFilter.blurX=r.blurX,this.blurFilter.blurY=0,a=t.WebGLRenderBuffer.create(s,u),a.setTransform(1,0,0,1,0,0),a.globalAlpha=1,this.drawToRenderTarget(this.blurFilter,i,a),i!=o&&t.WebGLRenderBuffer.release(i),i=a,this.blurFilter.blurX=0,this.blurFilter.blurY=r.blurY):(this.blurFilter.blurX=r.blurX,this.blurFilter.blurY=r.blurY),r=this.blurFilter),n.saveTransform(),n.transform(1,0,0,-1,0,u),this.vao.cacheArrays(n.globalMatrix,n.globalAlpha,0,0,s,u,0,0,s,u,s,u),n.restoreTransform();var h;h="blur"==r.type?{type:"blur",$blurX:r.$blurX,$blurY:r.$blurY}:r,this.drawCmdManager.pushDrawTexture(i.rootRenderTarget.texture,2,h,s,u),i!=o&&t.WebGLRenderBuffer.release(i),this.popBuffer()}},i.initBlendMode=function(){i.blendModesForGL={},i.blendModesForGL["source-over"]=[1,771],i.blendModesForGL.lighter=[1,1],i.blendModesForGL["lighter-in"]=[770,771],i.blendModesForGL["destination-out"]=[0,771],i.blendModesForGL["destination-in"]=[0,770]},i}();i.glContextId=0,i.blendModesForGL=null,t.WebGLRenderContext=i,__reflect(i.prototype,"egret.native2.WebGLRenderContext"),i.initBlendMode()}(t=e.native2||(e.native2={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var r=["source-over","lighter","destination-out"],i="source-over",n=[],a=function(){function a(){this.nestLevel=0}return a.prototype.render=function(e,t,r,i,a){this.nestLevel++;var o=t,s=o.context,u=a?e:null;s.pushBuffer(o),this.drawDisplayObject(e,o,i,r,null,null,u),s.$drawWebGL();var h=o.$drawCalls;if(o.onRenderFinish(),s.popBuffer(),this.nestLevel--,0===this.nestLevel){n.length>6&&(n.length=6);for(var l=n.length,c=0;l>c;c++)n[c].resize(0,0)}return h},a.prototype.drawDisplayObject=function(t,r,i,n,a,o,s){var u,h=0;if(a&&!s?(a.isDirty&&(h+=a.drawToSurface()),u=a.$renderNode):u=t.$getRenderNode(),u){if(i){var l=u.renderRegion;if(o&&!o.intersects(l))u.needRedraw=!1;else if(!u.needRedraw)for(var c=i.length,d=0;c>d;d++)if(l.intersects(i[d])){u.needRedraw=!0;break}}else u.needRedraw=!0;if(u.needRedraw){h++;var p=void 0,f=void 0;s?(p=t.$getConcatenatedAlphaAt(s,t.$getConcatenatedAlpha()),f=e.Matrix.create().copyFrom(t.$getConcatenatedMatrix()),t.$getConcatenatedMatrixAt(s,f),n.$preMultiplyInto(f,f),r.setTransform(f.a,f.b,f.c,f.d,f.tx,f.ty),e.Matrix.release(f)):(p=u.renderAlpha,f=u.renderMatrix,r.setTransform(f.a,f.b,f.c,f.d,f.tx+n.tx,f.ty+n.ty)),r.globalAlpha=p,this.renderNode(u,r),u.needRedraw=!1}}if(a&&!s)return h;var v=t.$children;if(v)for(var g=v.length,y=0;g>y;y++){var x=v[y];if(!(!x.$visible||x.$alpha<=0||x.$maskedObject)){var m=x.$getFilters();m&&m.length>0?h+=this.drawWithFilter(x,r,i,n,o,s):0!==x.$blendMode||x.$mask&&(x.$mask.$parentDisplayList||s)?h+=this.drawWithClip(x,r,i,n,o,s):x.$scrollRect||x.$maskRect?h+=this.drawWithScrollRect(x,r,i,n,o,s):x.isFPS?(r.context.$drawWebGL(),r.$computeDrawCall=!1,this.drawDisplayObject(x,r,i,n,x.$displayList,o,s),r.context.$drawWebGL(),r.$computeDrawCall=!0):h+=this.drawDisplayObject(x,r,i,n,x.$displayList,o,s)}}return h},a.prototype.drawWithFilter=function(t,a,o,s,u,h){var l,c=0,d=t.$getFilters(),p=0!==t.$blendMode;if(p&&(l=r[t.$blendMode],l||(l=i)),1==d.length&&"colorTransform"==d[0].type&&!t.$children)return p&&a.context.setGlobalCompositeOperation(l),a.context.$filter=d[0],c+=t.$mask&&(t.$mask.$parentDisplayList||h)?this.drawWithClip(t,a,o,s,u,h):t.$scrollRect||t.$maskRect?this.drawWithScrollRect(t,a,o,s,u,h):this.drawDisplayObject(t,a,o,s,t.$displayList,u,h),a.context.$filter=null,p&&a.context.setGlobalCompositeOperation(i),c;var f=e.Matrix.create();f.copyFrom(t.$getConcatenatedMatrix()),h&&t.$getConcatenatedMatrixAt(h,f);var v;v=e.sys.Region.create();var g=t.$getOriginalBounds();v.updateRegion(g,f);var y=this.createRenderBuffer(v.width,v.height);y.context.pushBuffer(y),y.setTransform(1,0,0,1,-v.minX,-v.minY);var x=e.Matrix.create().setTo(1,0,0,1,-v.minX,-v.minY);return c+=t.$mask&&(t.$mask.$parentDisplayList||h)?this.drawWithClip(t,y,o,x,v,h):t.$scrollRect||t.$maskRect?this.drawWithScrollRect(t,y,o,x,v,h):this.drawDisplayObject(t,y,o,x,t.$displayList,v,h),e.Matrix.release(x),y.context.popBuffer(),c>0&&(p&&a.context.setGlobalCompositeOperation(l),c++,a.globalAlpha=1,a.setTransform(1,0,0,1,v.minX+s.tx,v.minY+s.ty),a.context.drawTargetWidthFilters(d,y),p&&a.context.setGlobalCompositeOperation(i)),n.push(y),e.sys.Region.release(v),e.Matrix.release(f),c},a.prototype.drawWithClip=function(t,a,o,s,u,h){var l,c=0,d=0!==t.$blendMode;d&&(l=r[t.$blendMode],l||(l=i));var p=t.$scrollRect?t.$scrollRect:t.$maskRect,f=t.$mask;if(f){var v=f.$getRenderNode();if(v){var g=v.renderMatrix;if(0==g.a&&0==g.b||0==g.c&&0==g.d)return c}}var y,x=e.Matrix.create();if(x.copyFrom(t.$getConcatenatedMatrix()),t.$parentDisplayList){var m=t.$parentDisplayList.root;m!==t.$stage&&t.$getConcatenatedMatrixAt(m,x)}var b;if(f){b=f.$getOriginalBounds(),y=e.sys.Region.create();var T=e.Matrix.create();T.copyFrom(f.$getConcatenatedMatrix()),y.updateRegion(b,T),e.Matrix.release(T)}var w;if(p&&(w=e.sys.Region.create(),w.updateRegion(p,x)),w&&y?(w.intersect(y),e.sys.Region.release(y)):!w&&y&&(w=y),w){if(w.isEmpty()||u&&!u.intersects(w))return e.sys.Region.release(w),e.Matrix.release(x),c}else w=e.sys.Region.create(),b=t.$getOriginalBounds(),w.updateRegion(b,x);var S=!1;if(o){for(var E=o.length,R=0;E>R;R++)if(w.intersects(o[R])){S=!0;break}}else S=!0;if(!S)return e.sys.Region.release(w),e.Matrix.release(x),c;if(f||t.$children&&0!=t.$children.length){var _=this.createRenderBuffer(w.width,w.height);
_.context.pushBuffer(_),_.setTransform(1,0,0,1,-w.minX,-w.minY);var C=e.Matrix.create().setTo(1,0,0,1,-w.minX,-w.minY);if(c+=this.drawDisplayObject(t,_,o,C,t.$displayList,w,h),f){var L=this.createRenderBuffer(w.width,w.height);L.context.pushBuffer(L),L.setTransform(1,0,0,1,-w.minX,-w.minY),C=e.Matrix.create().setTo(1,0,0,1,-w.minX,-w.minY),c+=this.drawDisplayObject(f,L,o,C,f.$displayList,w,h),L.context.popBuffer(),_.context.setGlobalCompositeOperation("destination-in"),_.setTransform(1,0,0,-1,0,L.height),_.globalAlpha=1;var D=L.rootRenderTarget.width,A=L.rootRenderTarget.height;_.context.drawTexture(L.rootRenderTarget.texture,0,0,D,A,0,0,D,A,D,A),_.context.setGlobalCompositeOperation("source-over"),n.push(L)}if(e.Matrix.release(C),_.context.setGlobalCompositeOperation(i),_.context.popBuffer(),c>0){if(c++,d&&a.context.setGlobalCompositeOperation(l),p){var T=x;_.setTransform(T.a,T.b,T.c,T.d,T.tx-w.minX,T.ty-w.minY),_.context.pushMask(p)}a.globalAlpha=1,a.setTransform(1,0,0,-1,w.minX+s.tx,w.minY+s.ty+_.height);var $=_.rootRenderTarget.width,F=_.rootRenderTarget.height;a.context.drawTexture(_.rootRenderTarget.texture,0,0,$,F,0,0,$,F,$,F),p&&_.context.popMask(),d&&a.context.setGlobalCompositeOperation(i)}return n.push(_),e.sys.Region.release(w),e.Matrix.release(x),c}if(p){var T=x;a.setTransform(T.a,T.b,T.c,T.d,T.tx-w.minX,T.ty-w.minY),a.context.pushMask(p)}return d&&a.context.setGlobalCompositeOperation(l),c+=this.drawDisplayObject(t,a,o,s,t.$displayList,u,h),d&&a.context.setGlobalCompositeOperation(i),p&&a.context.popMask(),e.sys.Region.release(w),e.Matrix.release(x),c},a.prototype.drawWithScrollRect=function(t,r,i,n,a,o){var s=0,u=t.$scrollRect?t.$scrollRect:t.$maskRect;if(u.isEmpty())return s;var h=e.Matrix.create();if(h.copyFrom(t.$getConcatenatedMatrix()),o)t.$getConcatenatedMatrixAt(o,h);else if(t.$parentDisplayList){var l=t.$parentDisplayList.root;l!==t.$stage&&t.$getConcatenatedMatrixAt(l,h)}var c=e.sys.Region.create();if(c.updateRegion(u,h),c.isEmpty()||a&&!a.intersects(c))return e.sys.Region.release(c),e.Matrix.release(h),s;var d=!1;if(i){for(var p=i.length,f=0;p>f;f++)if(c.intersects(i[f])){d=!0;break}}else d=!0;if(!d)return e.sys.Region.release(c),e.Matrix.release(h),s;r.setTransform(h.a,h.b,h.c,h.d,h.tx+n.tx,h.ty+n.ty);var v=r.context,g=!1;if(r.$hasScissor||0!=h.b||0!=h.c)v.pushMask(u);else{var y=h.a,x=h.d,m=h.tx,b=h.ty,T=u.x,w=u.y,S=T+u.width,E=w+u.height,R=void 0,_=void 0,C=void 0,L=void 0;if(1==y&&1==x)R=T+m,_=w+b,C=S+m,L=E+b;else{var D=y*T+m,A=x*w+b,$=y*S+m,F=x*w+b,M=y*S+m,O=x*E+b,B=y*T+m,P=x*E+b,I=0;D>$&&(I=D,D=$,$=I),M>B&&(I=M,M=B,B=I),R=M>D?D:M,C=$>B?$:B,A>F&&(I=A,A=F,F=I),O>P&&(I=O,O=P,P=I),_=O>A?A:O,L=F>P?F:P}v.enableScissor(R+n.tx,-n.ty-L+r.height,C-R,L-_),g=!0}return s+=this.drawDisplayObject(t,r,i,n,t.$displayList,c,o),r.setTransform(h.a,h.b,h.c,h.d,h.tx+n.tx,h.ty+n.ty),g?v.disableScissor():v.popMask(),e.sys.Region.release(c),e.Matrix.release(h),s},a.prototype.drawNodeToBuffer=function(e,t,r,i){var n=t;n.context.pushBuffer(n),n.setTransform(r.a,r.b,r.c,r.d,r.tx,r.ty),this.renderNode(e,t,i),n.context.$drawWebGL(),n.onRenderFinish(),n.context.popBuffer()},a.prototype.renderNode=function(e,t,r){switch(e.type){case 1:this.renderBitmap(e,t);break;case 2:this.renderText(e,t);break;case 3:this.renderGraphics(e,t,r);break;case 4:this.renderGroup(e,t);break;case 6:t.globalAlpha=e.drawData[0];break;case 7:this.renderMesh(e,t)}},a.prototype.renderBitmap=function(e,t){var n=e.image;if(n){var a=e.drawData,o=a.length,s=0,u=e.matrix,h=e.blendMode,l=e.alpha;u&&(t.saveTransform(),t.transform(u.a,u.b,u.c,u.d,u.tx,u.ty)),h&&t.context.setGlobalCompositeOperation(r[h]);var c;if(l==l&&(c=t.globalAlpha,t.globalAlpha*=l),e.filter){for(t.context.$filter=e.filter;o>s;)t.context.drawImage(n,a[s++],a[s++],a[s++],a[s++],a[s++],a[s++],a[s++],a[s++],e.imageWidth,e.imageHeight);t.context.$filter=null}else for(;o>s;)t.context.drawImage(n,a[s++],a[s++],a[s++],a[s++],a[s++],a[s++],a[s++],a[s++],e.imageWidth,e.imageHeight);h&&t.context.setGlobalCompositeOperation(i),l==l&&(t.globalAlpha=c),u&&t.restoreTransform()}},a.prototype.renderMesh=function(e,t){var r=e.image,i=e.drawData,n=i.length,a=0,o=e.matrix;for(o&&(t.saveTransform(),t.transform(o.a,o.b,o.c,o.d,o.tx,o.ty));n>a;)t.context.drawMesh(r,i[a++],i[a++],i[a++],i[a++],i[a++],i[a++],i[a++],i[a++],e.imageWidth,e.imageHeight,e.uvs,e.vertices,e.indices,e.bounds);o&&t.restoreTransform()},a.prototype.renderText=function(e,t){for(var r=e.drawData,i=r.length,n=0;i>n;){var a=r[n++],o=r[n++],s=r[n++],u=r[n++],h=null==u.textColor?e.textColor:u.textColor,l=null==u.strokeColor?e.strokeColor:u.strokeColor,c=null==u.stroke?e.stroke:u.stroke,d=null==u.size?e.size:u.size;egret_native.Label.createLabel("",d,"",c);var p=!1;(0!=a||0!=o)&&(p=!0,t.saveTransform(),t.transform(1,0,0,1,a,o)),t.context.drawText(s,d,0,0,h,c,l),p&&t.restoreTransform()}},a.prototype.renderGraphics=function(e,t,r){return},a.prototype.renderGroup=function(e,t){var r=e.matrix;r&&(t.saveTransform(),t.transform(r.a,r.b,r.c,r.d,r.tx,r.ty));for(var i=e.drawData,n=i.length,a=0;n>a;a++){var o=i[a];this.renderNode(o,t)}r&&t.restoreTransform()},a.prototype.createRenderBuffer=function(e,r){var i=n.pop();return i?i.resize(e,r):(i=new t.WebGLRenderBuffer(e,r),i.$computeDrawCall=!1),i},a}();t.WebGLRenderer=a,__reflect(a.prototype,"egret.native2.WebGLRenderer",["egret.sys.SystemRenderer"])}(t=e.native2||(e.native2={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var r=function(e){function t(t,r,i){var n=e.call(this)||this;return n.clearColor=[0,0,0,0],n.useFrameBuffer=!0,n.gl=t,n.width=r||1,n.height=i||1,n.texture=n.createTexture(),n.frameBuffer=t.createFramebuffer(),t.bindFramebuffer(t.FRAMEBUFFER,n.frameBuffer),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,n.texture,0),n.stencilBuffer=t.createRenderbuffer(),t.bindRenderbuffer(t.RENDERBUFFER,n.stencilBuffer),t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_STENCIL,n.width,n.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.RENDERBUFFER,n.stencilBuffer),n}return __extends(t,e),t.prototype.resize=function(e,t){var r=this.gl;r.bindTexture(r.TEXTURE_2D,this.texture),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,e,t,0,r.RGBA,r.UNSIGNED_BYTE,null),r.bindFramebuffer(r.FRAMEBUFFER,this.frameBuffer),r.deleteRenderbuffer(this.stencilBuffer),this.stencilBuffer=r.createRenderbuffer(),r.bindRenderbuffer(r.RENDERBUFFER,this.stencilBuffer),r.renderbufferStorage(r.RENDERBUFFER,r.DEPTH_STENCIL,e,t),this.width=e,this.height=t},t.prototype.activate=function(){var e=this.gl;e.bindFramebuffer(e.FRAMEBUFFER,this.getFrameBuffer())},t.prototype.getFrameBuffer=function(){return this.useFrameBuffer?this.frameBuffer:null},t.prototype.createTexture=function(){var e=this.gl,t=e.createTexture();return e.bindTexture(e.TEXTURE_2D,t),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,this.width,this.height,0,e.RGBA,e.UNSIGNED_BYTE,null),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),t},t.prototype.clear=function(e){var t=this.gl;e&&this.activate(),t.colorMask(!0,!0,!0,!0),t.clearColor(this.clearColor[0],this.clearColor[1],this.clearColor[2],this.clearColor[3]),t.clear(t.COLOR_BUFFER_BIT)},t}(e.HashObject);t.WebGLRenderTarget=r,__reflect(r.prototype,"egret.native2.WebGLRenderTarget")}(t=e.native2||(e.native2={}))}(egret||(egret={}));var egret;!function(e){var t;!function(e){var t=function(){function t(e){this.gl=null,this.maxAttibs=10,this.attribState=[],this.tempAttribState=[],this.currentShader=null,this.defaultShader=null,this.primitiveShader=null,this.colorTransformShader=null,this.blurShader=null,this.glowShader=null,this.fontShader=null;for(var t=0;t<this.maxAttibs;t++)this.attribState[t]=!1;this.setContext(e)}return t.prototype.setContext=function(t){this.gl=t,this.primitiveShader=new e.PrimitiveShader(t),this.defaultShader=new e.TextureShader(t),this.colorTransformShader=new e.ColorTransformShader(t),this.glowShader=new e.GlowShader(t),this.blurShader=new e.BlurShader(t),this.fontShader=new e.FontShader(t),this.primitiveShader.init(),this.defaultShader.init(),this.colorTransformShader.init(),this.blurShader.init(),this.glowShader.init(),this.fontShader.init()},t.prototype.activateShader=function(e,t){this.currentShader!=e&&(this.gl.useProgram(e.program),this.setAttribs(e.attributes),e.setAttribPointer(t),this.currentShader=e)},t.prototype.setAttribs=function(e){var t,r;for(r=this.tempAttribState.length,t=0;r>t;t++)this.tempAttribState[t]=!1;for(r=e.length,t=0;r>t;t++){var i=e[t];this.tempAttribState[i]=!0}var n=this.gl;for(r=this.attribState.length,t=0;r>t;t++)this.attribState[t]!==this.tempAttribState[t]&&(this.attribState[t]=this.tempAttribState[t],this.tempAttribState[t]?n.enableVertexAttribArray(t):n.disableVertexAttribArray(t))},t}();e.WebGLShaderManager=t,__reflect(t.prototype,"egret.native2.WebGLShaderManager")}(t=e.native2||(e.native2={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var r=function(){function t(){}return t.compileProgram=function(r,i,n){var a=t.compileFragmentShader(r,n),o=t.compileVertexShader(r,i),s=r.createProgram();return r.attachShader(s,o),r.attachShader(s,a),r.linkProgram(s),r.getProgramParameter(s,r.LINK_STATUS)||e.$warn(1020),s},t.compileFragmentShader=function(e,r){return t._compileShader(e,r,e.FRAGMENT_SHADER)},t.compileVertexShader=function(e,r){return t._compileShader(e,r,e.VERTEX_SHADER)},t._compileShader=function(e,t,r){var i=e.createShader(r);return e.shaderSource(i,t),e.compileShader(i),e.getShaderParameter(i,e.COMPILE_STATUS)?i:null},t.checkCanUseWebGL=function(){if(void 0==t.canUseWebGL)try{var e=document.createElement("canvas");t.canUseWebGL=!(!window.WebGLRenderingContext||!e.getContext("webgl")&&!e.getContext("experimental-webgl"))}catch(r){t.canUseWebGL=!1}return t.canUseWebGL},t.deleteWebGLTexture=function(e){if(e){var t=e.glContext;t&&t.deleteTexture(e)}},t}();t.WebGLUtils=r,__reflect(r.prototype,"egret.native2.WebGLUtils")}(t=e.native2||(e.native2={}))}(egret||(egret={}));var egret;!function(e){var t;!function(e){var t=function(){function e(){this.size=2e3,this.vertexMaxSize=4*this.size,this.indicesMaxSize=6*this.size,this.vertSize=5,this.vertices=null,this.indices=null,this.indicesForMesh=null,this.vertexIndex=0,this.indexIndex=0,this.hasMesh=!1;var e=this.vertexMaxSize*this.vertSize,t=this.indicesMaxSize;this.vertices=new Float32Array(e),this.indices=new Uint16Array(t),this.indicesForMesh=new Uint16Array(t);for(var r=0,i=0;t>r;r+=6,i+=4)this.indices[r+0]=i+0,this.indices[r+1]=i+1,this.indices[r+2]=i+2,this.indices[r+3]=i+0,this.indices[r+4]=i+2,this.indices[r+5]=i+3}return e.prototype.reachMaxSize=function(e,t){return void 0===e&&(e=4),void 0===t&&(t=6),this.vertexIndex>this.vertexMaxSize-e||this.indexIndex>this.indicesMaxSize-t},e.prototype.getVertices=function(){var e=this.vertices.subarray(0,this.vertexIndex*this.vertSize);return e},e.prototype.getIndices=function(){return this.indices},e.prototype.getMeshIndices=function(){return this.indicesForMesh},e.prototype.changeToMeshIndices=function(){if(!this.hasMesh){for(var e=0,t=this.indexIndex;t>e;++e)this.indicesForMesh[e]=this.indices[e];this.hasMesh=!0}},e.prototype.isMesh=function(){return this.hasMesh},e.prototype.cacheArrays=function(e,t,r,i,n,a,o,s,u,h,l,c,d,p,f){var v=e,g=v.a,y=v.b,x=v.c,m=v.d,b=v.tx,T=v.ty;(0!=o||0!=s)&&v.append(1,0,0,1,o,s),(n/u!=1||a/h!=1)&&v.append(u/n,0,0,h/a,0,0);var w=v.a,S=v.b,E=v.c,R=v.d,_=v.tx,C=v.ty;if(v.a=g,v.b=y,v.c=x,v.d=m,v.tx=b,v.ty=T,p){var L=this.vertices,D=this.vertexIndex*this.vertSize,A=0,$=0,F=0,M=0,O=0,B=0,P=0;for(A=0,F=d.length;F>A;A+=2)$=5*A/2,B=p[A],P=p[A+1],M=d[A],O=d[A+1],L[D+$+0]=w*B+E*P+_,L[D+$+1]=S*B+R*P+C,L[D+$+2]=(r+M*n)/l,L[D+$+3]=(i+O*a)/c,L[D+$+4]=t;if(this.hasMesh)for(var I=0,G=f.length;G>I;++I)this.indicesForMesh[this.indexIndex+I]=f[I]+this.vertexIndex;this.vertexIndex+=d.length/2,this.indexIndex+=f.length}else{var N=l,k=c,j=n,W=a;r/=N,i/=k,n/=N,a/=k;var L=this.vertices,D=this.vertexIndex*this.vertSize;if(L[D++]=_,L[D++]=C,L[D++]=r,L[D++]=i,L[D++]=t,L[D++]=w*j+_,L[D++]=S*j+C,L[D++]=n+r,L[D++]=i,L[D++]=t,L[D++]=w*j+E*W+_,L[D++]=R*W+S*j+C,L[D++]=n+r,L[D++]=a+i,L[D++]=t,L[D++]=E*W+_,L[D++]=R*W+C,L[D++]=r,L[D++]=a+i,L[D++]=t,this.hasMesh){var z=this.indicesForMesh;z[this.indexIndex+0]=0+this.vertexIndex,z[this.indexIndex+1]=1+this.vertexIndex,z[this.indexIndex+2]=2+this.vertexIndex,z[this.indexIndex+3]=0+this.vertexIndex,z[this.indexIndex+4]=2+this.vertexIndex,z[this.indexIndex+5]=3+this.vertexIndex}this.vertexIndex+=4,this.indexIndex+=6}},e.prototype.cacheArraysForText=function(e,t,r,i,n){var a=e,o=a.a,s=a.b,u=a.c,h=a.d,l=a.tx,c=a.ty,d=a.a,p=a.b,f=a.c,v=a.d,g=a.tx-2,y=a.ty-2;a.a=o,a.b=s,a.c=u,a.d=h,a.tx=l,a.ty=c;for(var x=0,m=0,b=0;i>b;b++){var T=this.vertices,w=this.vertexIndex*this.vertSize,S=16*b;if(T[w++]=g+r[S++],T[w++]=y+r[S++],T[w++]=r[S++],T[w++]=r[S++],T[w++]=t,T[w++]=d*x+g+r[S++],T[w++]=p*x+y+r[S++],T[w++]=r[S++],T[w++]=r[S++],T[w++]=t,T[w++]=d*x+f*m+g+r[S++],T[w++]=v*m+p*x+y+r[S++],T[w++]=r[S++],T[w++]=r[S++],T[w++]=t,T[w++]=f*m+g+r[S++],T[w++]=v*m+y+r[S++],T[w++]=r[S++],T[w++]=r[S++],T[w++]=t,this.hasMesh){var E=this.indicesForMesh;E[this.indexIndex+0]=0+this.vertexIndex,E[this.indexIndex+1]=1+this.vertexIndex,E[this.indexIndex+2]=2+this.vertexIndex,E[this.indexIndex+3]=0+this.vertexIndex,E[this.indexIndex+4]=2+this.vertexIndex,E[this.indexIndex+5]=3+this.vertexIndex}this.vertexIndex+=4,this.indexIndex+=6}},e.prototype.clear=function(){this.hasMesh=!1,this.vertexIndex=0,this.indexIndex=0},e}();e.WebGLVertexArrayObject=t,__reflect(t.prototype,"egret.native2.WebGLVertexArrayObject")}(t=e.native2||(e.native2={}))}(egret||(egret={}));var egret;!function(e){var t;!function(e){var t=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.fragmentSrc="precision mediump float;uniform vec2 blur;uniform sampler2D uSampler;varying vec2 vTextureCoord;uniform vec2 uTextureSize;void main(){const int sampleRadius = 5;const int samples = sampleRadius * 2 + 1;vec2 blurUv = blur / uTextureSize;vec4 color = vec4(0, 0, 0, 0);vec2 uv = vec2(0.0, 0.0);blurUv /= float(sampleRadius);for (int i = -sampleRadius; i <= sampleRadius; i++) {uv.x = vTextureCoord.x + float(i) * blurUv.x;uv.y = vTextureCoord.y + float(i) * blurUv.y;color += texture2D(uSampler, uv);}color /= float(samples);gl_FragColor = color;}",t.uniforms={projectionVector:{type:"2f",value:{x:0,y:0},dirty:!0},blur:{type:"2f",value:{x:2,y:2},dirty:!0},uTextureSize:{type:"2f",value:{x:100,y:100},dirty:!0}},t}return __extends(t,e),t.prototype.setBlur=function(e,t){var r=this.uniforms.blur;(r.value.x!=e||r.value.y!=t)&&(r.value.x=e,r.value.y=t,r.dirty=!0)},t.prototype.setTextureSize=function(e,t){var r=this.uniforms.uTextureSize;(e!=r.value.x||t!=r.value.y)&&(r.value.x=e,r.value.y=t,r.dirty=!0)},t}(e.TextureShader);e.BlurShader=t,__reflect(t.prototype,"egret.native2.BlurShader")}(t=e.native2||(e.native2={}))}(egret||(egret={}));var egret;!function(e){var t;!function(e){var t=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.fragmentSrc="precision mediump float;\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nuniform mat4 matrix;\nuniform vec4 colorAdd;\nuniform sampler2D uSampler;\nvoid main(void) {\nvec4 texColor = texture2D(uSampler, vTextureCoord);\nif(texColor.a > 0.) {texColor = vec4(texColor.rgb / texColor.a, texColor.a);\n}vec4 locColor = clamp(texColor * matrix + colorAdd, 0., 1.);\ngl_FragColor = vColor * vec4(locColor.rgb * locColor.a, locColor.a);\n}",t.uniforms={projectionVector:{type:"2f",value:{x:0,y:0},dirty:!0},matrix:{type:"mat4",value:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],dirty:!0},colorAdd:{type:"4f",value:{x:0,y:0,z:0,w:0},dirty:!0}},t}return __extends(t,e),t.prototype.setMatrix=function(e){var t=this.uniforms.matrix;(t.value[0]!=e[0]||t.value[0]!=e[0]||t.value[1]!=e[1]||t.value[2]!=e[2]||t.value[3]!=e[3]||t.value[4]!=e[5]||t.value[5]!=e[6]||t.value[6]!=e[7]||t.value[7]!=e[8]||t.value[8]!=e[10]||t.value[9]!=e[11]||t.value[10]!=e[12]||t.value[11]!=e[13]||t.value[12]!=e[15]||t.value[13]!=e[16]||t.value[14]!=e[17]||t.value[15]!=e[18])&&(t.value[0]=e[0],t.value[1]=e[1],t.value[2]=e[2],t.value[3]=e[3],t.value[4]=e[5],t.value[5]=e[6],t.value[6]=e[7],t.value[7]=e[8],t.value[8]=e[10],t.value[9]=e[11],t.value[10]=e[12],t.value[11]=e[13],t.value[12]=e[15],t.value[13]=e[16],t.value[14]=e[17],t.value[15]=e[18],t.dirty=!0);var r=this.uniforms.colorAdd;(r.value.x!=e[4]/255||r.value.y!=e[9]/255||r.value.z!=e[14]/255||r.value.w!=e[19]/255)&&(r.value.x=e[4]/255,r.value.y=e[9]/255,r.value.z=e[14]/255,r.value.w=e[19]/255,r.dirty=!0)},t}(e.TextureShader);e.ColorTransformShader=t,__reflect(t.prototype,"egret.native2.ColorTransformShader")}(t=e.native2||(e.native2={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){function r(e){e.onStart(u),s=e}function i(r){if(!h){h=!0,r||(r={}),n(r.renderMode);try{e.Capabilities.$setNativeCapabilities(egret_native.getVersion())}catch(i){}var a=e.sys.$ticker,o=function(){s&&s.onRender(u),a.update()};egret_native.setOnUpdate(o,a),e.sys.screenAdapter||(r.screenAdapter?e.sys.screenAdapter=r.screenAdapter:e.sys.screenAdapter=new e.sys.DefaultScreenAdapter);var c=new t.NativePlayer;l.push(c),c.$stage.dirtyRegionPolicy=e.DirtyRegionPolicy.OFF,e.sys.DisplayList.prototype.setDirtyRegionPolicy=function(){}}}function n(r){e.sys.CanvasRenderBuffer=t.WebGLRenderBuffer,e.sys.RenderBuffer=t.WebGLRenderBuffer,e.sys.systemRenderer=new t.WebGLRenderer,e.sys.canvasRenderer=new t.WebGLRenderer,e.sys.customHitTestBuffer=new t.WebGLRenderBuffer(3,3),e.sys.canvasHitTestBuffer=new t.WebGLRenderBuffer(3,3),e.Capabilities.$renderMode="webgl"}function a(){for(var e=l.length,t=0;e>t;t++)l[t].updateScreenSize()}function o(e){for(var t=[],r=0;r<e.length;r++)t.push(e[r]);return t}var s,u={setAutoClear:function(e){t.WebGLRenderBuffer.autoClear=e},save:function(){},restore:function(){var e=t.WebGLRenderContext.getInstance(0,0),r=e.context;r.bindBuffer(r.ARRAY_BUFFER,e.vertexBuffer),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,e.indexBuffer),r.activeTexture(r.TEXTURE0),e.shaderManager.currentShader=null,e.bindIndices=!1;var i=e.$bufferStack[1];e.activateBuffer(i),r.enable(r.BLEND),e.setBlendMode("source-over")}};e.setRendererContext=r,t.$supportCanvas=egret_native.Canvas?!0:!1;var h=!1,l=[];e.warn=function(){console.warn.apply(console,o(arguments))},e.error=function(){console.error.apply(console,o(arguments))},e.assert=function(){console.assert.apply(console,o(arguments))},e.log=function(){console.log.apply(console,o(arguments))},e.runEgret=i,e.updateAllScreens=a}(t=e.native2||(e.native2={}))}(egret||(egret={})),function(e){var t;!function(t){t.$supportCanvas=!0,e["native"].$supportCanvas=e.native2.$supportCanvas}(t=e["native"]||(e["native"]={}))}(egret||(egret={}));var egret;!function(e){var t;!function(e){var t=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","uniform sampler2D uSampler;","uniform float distance;","uniform float angle;","uniform vec4 color;","uniform float alpha;","uniform float blurX;","uniform float blurY;","uniform float strength;","uniform float inner;","uniform float knockout;","uniform float hideObject;","uniform vec2 uTextureSize;vec2 px = vec2(1.0 / uTextureSize.x, 1.0 / uTextureSize.y);","float random(vec3 scale, float seed)","{","return fract(sin(dot(gl_FragCoord.xyz + seed, scale)) * 43758.5453 + seed);","}","void main(void) {","const float linearSamplingTimes = 7.0;","const float circleSamplingTimes = 12.0;","vec4 ownColor = texture2D(uSampler, vTextureCoord);","vec4 curColor;","float totalAlpha = 0.0;","float maxTotalAlpha = 0.0;","float curDistanceX = 0.0;","float curDistanceY = 0.0;","float offsetX = distance * cos(angle) * px.x;","float offsetY = distance * sin(angle) * px.y;","const float PI = 3.14159265358979323846264;","float cosAngle;","float sinAngle;","float offset = PI * 2.0 / circleSamplingTimes * random(vec3(12.9898, 78.233, 151.7182), 0.0);","float stepX = blurX * px.x / linearSamplingTimes;","float stepY = blurY * px.y / linearSamplingTimes;","for (float a = 0.0; a <= PI * 2.0; a += PI * 2.0 / circleSamplingTimes) {","cosAngle = cos(a + offset);","sinAngle = sin(a + offset);","for (float i = 1.0; i <= linearSamplingTimes; i++) {","curDistanceX = i * stepX * cosAngle;","curDistanceY = i * stepY * sinAngle;","curColor = texture2D(uSampler, vec2(vTextureCoord.x + curDistanceX - offsetX, vTextureCoord.y + curDistanceY + offsetY));","totalAlpha += (linearSamplingTimes - i) * curColor.a;","maxTotalAlpha += (linearSamplingTimes - i);","}","}","ownColor.a = max(ownColor.a, 0.0001);","ownColor.rgb = ownColor.rgb / ownColor.a;","float outerGlowAlpha = (totalAlpha / maxTotalAlpha) * strength * alpha * (1. - inner) * max(min(hideObject, knockout), 1. - ownColor.a);","float innerGlowAlpha = ((maxTotalAlpha - totalAlpha) / maxTotalAlpha) * strength * alpha * inner * ownColor.a;","ownColor.a = max(ownColor.a * knockout * (1. - hideObject), 0.0001);","vec3 mix1 = mix(ownColor.rgb, color.rgb, innerGlowAlpha / (innerGlowAlpha + ownColor.a));","vec3 mix2 = mix(mix1, color.rgb, outerGlowAlpha / (innerGlowAlpha + ownColor.a + outerGlowAlpha));","float resultAlpha = min(ownColor.a + outerGlowAlpha + innerGlowAlpha, 1.);","gl_FragColor = vec4(mix2 * resultAlpha, resultAlpha);","}"].join("\n"),t.uniforms={projectionVector:{type:"2f",value:{x:0,y:0},dirty:!0},distance:{type:"1f",value:15,dirty:!0},angle:{type:"1f",value:1,dirty:!0},color:{type:"4f",value:{x:1,y:0,z:0,w:0},dirty:!0},alpha:{type:"1f",value:1,dirty:!0},blurX:{type:"1f",value:1,dirty:!0},blurY:{type:"1f",value:1,dirty:!0},strength:{type:"1f",value:1,dirty:!0},inner:{type:"1f",value:1,dirty:!0},knockout:{type:"1f",value:1,dirty:!0},hideObject:{type:"1f",value:0,dirty:!0},uTextureSize:{type:"2f",value:{x:100,y:100},dirty:!0}},t}return __extends(t,e),t.prototype.setDistance=function(e){var t=this.uniforms.distance;t.value!=e&&(t.value=e,t.dirty=!0)},t.prototype.setAngle=function(e){var t=this.uniforms.angle;t.value!=e&&(t.value=e,t.dirty=!0)},t.prototype.setColor=function(e,t,r){var i=this.uniforms.color;(i.value.x!=e||i.value.y!=t||i.value.z!=r)&&(i.value.x=e,i.value.y=t,i.value.z=r,i.dirty=!0)},t.prototype.setAlpha=function(e){var t=this.uniforms.alpha;t.value!=e&&(t.value=e,t.dirty=!0)},t.prototype.setBlurX=function(e){var t=this.uniforms.blurX;t.value!=e&&(t.value=e,t.dirty=!0)},t.prototype.setBlurY=function(e){var t=this.uniforms.blurY;t.value!=e&&(t.value=e,t.dirty=!0)},t.prototype.setStrength=function(e){var t=this.uniforms.strength;t.value!=e&&(t.value=e,t.dirty=!0)},t.prototype.setInner=function(e){var t=this.uniforms.inner;t.value!=e&&(t.value=e,t.dirty=!0)},t.prototype.setKnockout=function(e){var t=this.uniforms.knockout;t.value!=e&&(t.value=e,t.dirty=!0)},t.prototype.setHideObject=function(e){var t=this.uniforms.hideObject;t.value!=e&&(t.value=e,t.dirty=!0)},t.prototype.setTextureSize=function(e,t){var r=this.uniforms.uTextureSize;(e!=r.value.x||t!=r.value.y)&&(r.value.x=e,r.value.y=t,r.dirty=!0)},t}(e.TextureShader);e.GlowShader=t,__reflect(t.prototype,"egret.native2.GlowShader")}(t=e.native2||(e.native2={}))}(egret||(egret={}));var egret;!function(e){var t;!function(e){var t=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.fragmentSrc="precision lowp float;\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nvoid main(void) {\ngl_FragColor = vColor;\n}",t}return __extends(t,e),t}(e.EgretShader);e.PrimitiveShader=t,__reflect(t.prototype,"egret.native2.PrimitiveShader")}(t=e.native2||(e.native2={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var r=function(t){function r(r){var i=t.call(this)||this;return egret_native.pauseApp=function(){r.dispatchEvent(new e.Event(e.Event.DEACTIVATE)),egret_native.Audio.pauseBackgroundMusic(),egret_native.Audio.pauseAllEffects()},egret_native.resumeApp=function(){r.dispatchEvent(new e.Event(e.Event.ACTIVATE)),egret_native.Audio.resumeBackgroundMusic(),egret_native.Audio.resumeAllEffects()},i}return __extends(r,t),r}(e.HashObject);t.NativeHideHandler=r,__reflect(r.prototype,"egret.native2.NativeHideHandler")}(t=e.native2||(e.native2={}))}(egret||(egret={}));var egret;!function(e){var t;!function(e){var t=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.fragmentSrc="precision lowp float;\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nuniform sampler2D uSampler;\nuniform vec4 uTextColor;\nuniform vec4 uStrokeColor;\nvoid main(void) {\n   vec4 sample = texture2D(uSampler, vTextureCoord);\n   float fontAlpha = sample.a;\n   float outlineAlpha = sample.r;\n   if (fontAlpha + outlineAlpha > 0.0){\n       vec4 color = uTextColor * fontAlpha + uStrokeColor * outlineAlpha;\n       gl_FragColor = vColor * vec4(color.rgb, max(fontAlpha, outlineAlpha));\n   }\n   else {       discard;   }}\n",t.uniforms={projectionVector:{type:"2f",value:{x:0,y:0},dirty:!0},uTextColor:{type:"4f",value:{x:0,y:0,z:0,w:0},dirty:!0},uStrokeColor:{type:"4f",value:{x:0,y:0,z:0,w:0},dirty:!0}},t}return __extends(t,e),t.prototype.setTextColor=function(e,t,r,i){var n=this.uniforms.uTextColor;(e!=n.value.x||t!=n.value.y||r!=n.value.z||i!=n.value.w)&&(n.value.x=e,n.value.y=t,n.value.z=r,n.value.w=i,n.dirty=!0)},t.prototype.setStrokeColor=function(e,t,r,i){var n=this.uniforms.uStrokeColor;(e!=n.value.x||t!=n.value.y||r!=n.value.z||i!=n.value.w)&&(n.value.x=e,n.value.y=t,n.value.z=r,n.value.w=i,n.dirty=!0)},t}(e.EgretShader);e.FontShader=t,__reflect(t.prototype,"egret.native2.FontShader")}(t=e.native2||(e.native2={}))}(egret||(egret={}));